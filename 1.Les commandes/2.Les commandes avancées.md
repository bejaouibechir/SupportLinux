# Les commandes avancées (Ubuntu & Debian)

### **Exercice 1 : Gérer les permissions avec `chmod` et `chown`**

* **Objectif** : Modifier les permissions et le propriétaire d’un fichier.
* **Instructions** :

  1. `touch fichier_securise.txt`
  2. Donner lecture+exécution au propriétaire :

     ```bash
     chmod 500 fichier_securise.txt
     ```
  3. Changer le propriétaire :

     ```bash
     sudo chown utilisateur1:utilisateur1 fichier_securise.txt
     ```

**Solution :**

```bash
touch fichier_securise.txt
chmod 500 fichier_securise.txt
# créer l’utilisateur si besoin :
# Ubuntu : sudo adduser utilisateur1
# Debian sans sudo : su - -c 'adduser utilisateur1'
sudo chown utilisateur1:utilisateur1 fichier_securise.txt
ls -l fichier_securise.txt
```

**Nuances Debian/Ubuntu** : identique. Sur Debian minimal, remplacez `sudo …` par `su - -c '…'`.

---

### **Exercice 2 : Rediriger l’entrée/sortie avec `>` et `>>`**

* **Objectif** : Capturer ou ajouter une sortie dans un fichier.
* **Instructions** :
  1\.

  ```bash
  echo "Ceci est une sortie redirigée" > sortie.txt
  ```

  2. ```bash
     echo "Ligne supplémentaire" >> sortie.txt
     ```

**Solution :**

```bash
echo "Ceci est une sortie redirigée" > sortie.txt
echo "Ligne supplémentaire" >> sortie.txt
cat sortie.txt
```

**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 3 : Combiner des commandes avec des pipes `|`**

* **Objectif** : Chaîner `ls`, `grep`, `wc -l`.
* **Instructions** :

  ```bash
  ls -l | grep ".txt" | wc -l
  ```

**Solution (plus robuste) :**

```bash
ls -1 | grep -E "\.txt$" | wc -l
# ou sans grep : printf "%s\n" *.txt 2>/dev/null | wc -l
```

**Nuances Debian/Ubuntu** : identique (GNU grep).

---

### **Exercice 4 : Rechercher avec `find` et `grep`**

* **Objectif** : Chercher des fichiers puis du contenu.
* **Instructions** :

  1. `find . -name "*.txt"`
  2. `find . -name "*.log" -exec grep "erreur" {} \;`
     **Solution (performant) :**

```bash
find . -type f -name "*.txt"
find . -type f -name "*.log" -exec grep -Hn "erreur" {} +
# Alternative récursive : grep -Rni "erreur" --include="*.log" .
```

**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 5 : Compression avancée `tar` + `gzip`**

* **Objectif** : Compresser/décompresser un répertoire.
* **Instructions** :

  1. `tar cvf - MonDossier/ | gzip > mon_dossier.tar.gz`
  2. `gunzip -c mon_dossier.tar.gz | tar xvf -`
     **Solution (deux formes) :**

```bash
# forme pipeline (comme énoncé)
tar cvf - MonDossier | gzip > mon_dossier.tar.gz
gunzip -c mon_dossier.tar.gz | tar xvf -

# forme courte
tar -czvf mon_dossier.tar.gz MonDossier
tar -xzvf mon_dossier.tar.gz
```

**Nuances Debian/Ubuntu** : identique (GNU tar).

---

### **Exercice 6 : Infos système avec `top` et `htop`**

* **Objectif** : Surveiller les processus.
* **Instructions** :

  1. `top`
  2. Installer/ouvrir `htop`

     ```bash
     sudo apt install -y htop
     htop
     ```

**Solution :**

```bash
top          # q pour quitter
sudo apt install -y htop
htop
```

**Nuances Debian/Ubuntu** : identique. Sur Debian minimal, installez `sudo` ou utilisez `su - -c`.

---

### **Exercice 7 : Gérer des processus avec `ps`, `kill`, `nice`**

* **Objectif** : Lister, tuer proprement, lancer à faible priorité.
* **Instructions** :

  1. `ps aux`
  2. `kill -9 <PID>`
  3. `nice -n 10 <commande>`
     **Solution (bonnes pratiques) :**

````bash
ps aux | less
# Trouver un PID :
pgrep -fl <mot>      # liste avec nom de commande
# Tuer proprement (TERM), SIGKILL en dernier recours :
kill <PID>
# si ça ne suffit pas :
kill -9 <PID>

# Lancer à priorité plus “nice” (moins prioritaire) :
nice -n 10 sleep 60 &
# Changer la priorité d’un PID existant :
sudo renice +10 -p <PID>
``)
**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 8 : Analyser/filtrer avec `awk`**
- **Objectif** : Extraire colonnes CSV.
- **Instructions** :
  1.
     ```bash
     echo -e "Nom,Âge,Ville\nAlice,30,Paris\nBob,25,Lyon\nEve,22,Bordeaux" > personnes.csv
     ```
  2.
     ```bash
     awk -F',' '{print $1}' personnes.csv
     ```
**Solution :**
```bash
printf "Nom,Âge,Ville\nAlice,30,Paris\nBob,25,Lyon\nEve,22,Bordeaux\n" > personnes.csv
awk -F',' 'NR>1 {print $1}' personnes.csv
# NR>1 pour sauter l’en-tête
````

**Nuances Debian/Ubuntu** : identique (gawk par défaut).

---

### **Exercice 9 : Analyser des logs avec `grep` et `cut`**

* **Objectif** : Filtrer les erreurs et extraire l’heure.
* **Instructions** :

  1. `grep "error" /var/log/syslog`
  2. `grep "error" /var/log/syslog | cut -d' ' -f1-3`
     **Solution (Ubuntu & alternative Debian) :**

```bash
# Ubuntu (rsyslog présent) :
grep -i "error" /var/log/syslog | cut -d' ' -f1-3

# Debian “journald-only” (si /var/log/syslog absent) :
journalctl -p err -o short | cut -d' ' -f1-3
# ou
journalctl -p err | awk '{print $1,$2,$3}'
```

**Nuances Debian/Ubuntu** : Ubuntu → `/var/log/syslog`; Debian sans rsyslog → `journalctl`.

---

### **Exercice 10 : Répéter avec `watch` et planifier avec `cron`**

* **Objectif** : Répéter une commande & tâche périodique.
* **Instructions** :

  1. `watch -n 5 df -h`
  2. `crontab -e` puis :

     ```
     0 * * * * /bin/ls /home/utilisateur > /home/utilisateur/liste.txt
     ```

**Solution :**

```bash
watch -n 5 df -h
crontab -e
# Ajouter la ligne (adaptez le chemin HOME/utilisateur) :
# 0 * * * * /bin/ls $HOME > $HOME/liste.txt
```

**Nuances Debian/Ubuntu** : identique.
**Note** : Dans cron, utilisez des chemins **absolus** et un PATH explicite si nécessaire.

---

### **Exercice 11 : Synchroniser avec `rsync`**

* **Objectif** : Synchroniser source → destination.
* **Instructions** :
  1\.

  ```bash
  mkdir -p ~/source ~/destination
  touch ~/source/{fichier1.txt,fichier2.txt}
  ```

  2. ```bash
     rsync -av ~/source/ ~/destination/
     ```

**Solution :**

```bash
mkdir -p ~/source ~/destination
touch ~/source/{fichier1.txt,fichier2.txt}
rsync -av ~/source/ ~/destination/
rsync -av --delete ~/source/ ~/destination/   # optionnel : miroir strict
```

**Nuances Debian/Ubuntu** : identique. Installez `rsync` si absent : `sudo apt install -y rsync`.

---

### **Exercice 12 : `xargs` avec `find`**

* **Objectif** : Appliquer une commande à de nombreux résultats.
* **Instructions** :

  1. `find . -name "*.txt"`
  2. `find . -name "*.txt" | xargs rm`
     **Solution (sécurisé) :**

```bash
# Sécuriser les espaces/caractères spéciaux :
find . -type f -name "*.txt" -print0 | xargs -0 rm -f
# ou directement avec find :
find . -type f -name "*.txt" -exec rm -f {} +
```

**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 13 : Édition en flux avec `sed`**

* **Objectif** : Remplacer du texte.
* **Instructions** :

  1. `echo "Bonjour tout le monde" > message.txt`
  2. `sed -i 's/Bonjour/Salut/' message.txt`
     **Solution :**

```bash
echo "Bonjour tout le monde" > message.txt
sed -i 's/Bonjour/Salut/' message.txt
cat message.txt
# Option sauvegarde :
sed -i.bak 's/Salut/Hello/' message.txt
```

**Nuances Debian/Ubuntu** : identique (GNU sed accepte `-i` sans extension).

---

### **Exercice 14 : Créer un alias avec `alias`**

* **Objectif** : Raccourcir `ls -la`.
* **Instructions** :

  ```bash
  alias ll='ls -la'
  ll
  ```

**Solution (persistant) :**

```bash
echo "alias ll='ls -la'" >> ~/.bashrc
source ~/.bashrc
ll
```

**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 15 : Permissions avancées avec `setfacl`**

* **Objectif** : ACL utilisateur.
* **Instructions** :
  1\.

  ```bash
  touch fichier_acl.txt
  setfacl -m u:utilisateur1:rw fichier_acl.txt
  ```

  2. ```bash
     getfacl fichier_acl.txt
     ```

**Solution :**

```bash
# Paquet si besoin :
# sudo apt install -y acl
touch fichier_acl.txt
sudo setfacl -m u:utilisateur1:rw fichier_acl.txt
getfacl fichier_acl.txt
```

**Nuances Debian/Ubuntu** : identique, mais **assurez-vous** que le FS supporte les ACL (ext4 OK). Paquet `acl` parfois à installer.

---

### **Exercice 16 : Surveiller avec `inotifywait`**

* **Objectif** : Écouter les changements en temps réel.
* **Instructions** :

  1. Installer :

     ```bash
     sudo apt install -y inotify-tools
     ```
  2. Surveiller :

     ```bash
     inotifywait -m fichier.txt
     ```

**Solution :**

```bash
sudo apt install -y inotify-tools
touch fichier.txt
inotifywait -m fichier.txt
# Dans un autre terminal :
echo "nouvelle ligne" >> fichier.txt
```

**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 17 : Lister les fichiers ouverts avec `lsof`**

* **Objectif** : Fichiers ouverts par un utilisateur.
* **Instructions** :

  ```bash
  lsof -u utilisateur1
  ```

**Solution :**

```bash
# Installer si besoin :
sudo apt install -y lsof
lsof -u utilisateur1 | head
# Ports ouverts (bonus) :
sudo lsof -i -P -n | head
```

**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 18 : Partitions avec `fdisk`**

* **Objectif** : Lister les partitions (lecture seule).
* **Instructions** :

  ```bash
  sudo fdisk -l
  ```

**Solution (compléments sûrs) :**

```bash
sudo fdisk -l
lsblk -f
blkid
```

**Nuances Debian/Ubuntu** : identique. **Attention** à n’utiliser que la consultation si vous n’éditez pas le partitionnement.

---

### **Exercice 19 : Liens symboliques avec `ln -s`**

* **Objectif** : Créer un symlink.
* **Instructions** :

  ```bash
  ln -s /etc/passwd lien_vers_passwd
  ```

**Solution :**

```bash
ln -s /etc/passwd lien_vers_passwd
ls -l lien_vers_passwd
readlink -f lien_vers_passwd
```

**Nuances Debian/Ubuntu** : identique.

---

### **Exercice 20 : Surveiller l’espace disque avec `df` et `du`**

* **Objectif** : Espace global & par dossier.
* **Instructions** :

  1. `df -h`
  2. `du -sh /var/log`
     **Solution (plus d’options) :**

```bash
df -hT             # avec type de FS
du -sh /var/log
du -h --max-depth=1 ~   # répartition au 1er niveau
```

**Nuances Debian/Ubuntu** : identique.

---

## Notes rapides (sécurité & bonnes pratiques)

* **`kill -9`** (SIGKILL) seulement en **dernier recours**. Essayez `kill` (SIGTERM) d’abord.
* **`xargs rm`** : préférez `-print0 | xargs -0` ou `-exec … +` pour gérer espaces/caractères spéciaux.
* **Logs** : si `/var/log/syslog` absent (Debian journald-only), utilisez `journalctl`.
* **sudo sur Debian minimal** : pas toujours présent → `su - -c "<cmd>"` ou installez `sudo` et ajoutez votre user au groupe `sudo`.
