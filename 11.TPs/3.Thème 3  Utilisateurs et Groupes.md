\# üë• Th√®me 3 : Utilisateurs et Groupes



\*(30 exercices pratiques avec niveau ascendant)\*



---



\### \*\*Exercice 1 : Cr√©er un utilisateur basique\*\*



\*\*√ânonc√© :\*\* Cr√©ez un utilisateur `stagiaire1` avec r√©pertoire personnel.

\*\*D√©marche :\*\*



```bash

sudo useradd -m stagiaire1

sudo passwd stagiaire1

```



\*\*Conseils :\*\*



\* `-m` cr√©e automatiquement `/home/stagiaire1`.

\* `passwd` permet de fixer le mot de passe.

&nbsp; \*\*Astuce :\*\* utilisez `adduser` sur Debian, plus interactif.

&nbsp; \*\*Pi√®ge :\*\* sans `-m`, pas de home ‚Üí utilisateur inutilisable.



---



\### \*\*Exercice 2 : Cr√©er un utilisateur sans shell\*\*



\*\*√ânonc√© :\*\* Ajoutez un utilisateur `service\_app` qui ne doit pas se connecter.

\*\*D√©marche :\*\*



```bash

sudo useradd -M -s /usr/sbin/nologin service\_app

```



\*\*Astuce :\*\* utile pour services (ex: `www-data`).

\*\*Pi√®ge :\*\* certains admins oublient `-s nologin` ‚Üí faille de s√©curit√©.



---



\### \*\*Exercice 3 : V√©rifier un utilisateur\*\*



\*\*√ânonc√© :\*\* V√©rifiez les infos de `stagiaire1`.

\*\*D√©marche :\*\*



```bash

id stagiaire1

getent passwd stagiaire1

```



\*\*Astuce :\*\* `id` montre UID, GID et groupes.

\*\*Pi√®ge :\*\* ne pas modifier directement `/etc/passwd`.



---



\### \*\*Exercice 4 : Ajouter un utilisateur √† un groupe existant\*\*



\*\*√ânonc√© :\*\* Ajoutez `stagiaire1` au groupe `sudo`.

\*\*D√©marche :\*\*



```bash

sudo usermod -aG sudo stagiaire1

```



\*\*Astuce :\*\* `-a` indispensable (append).

\*\*Pi√®ge :\*\* sans `-a`, l‚Äôutilisateur perd ses autres groupes.



---



\### \*\*Exercice 5 : Cr√©er un groupe projet\*\*



\*\*√ânonc√© :\*\* Cr√©ez un groupe `devops` et ajoutez `stagiaire1` et `stagiaire2`.

\*\*D√©marche :\*\*



```bash

sudo groupadd devops

sudo usermod -aG devops stagiaire1

sudo usermod -aG devops stagiaire2

```



\*\*Astuce :\*\* regrouper les droits par projet.

\*\*Pi√®ge :\*\* `groupadd` sans `sudo` √©choue silencieusement si vous √™tes rootless.



---



\### \*\*Exercice 6 : D√©finir un shell par d√©faut\*\*



\*\*√ânonc√© :\*\* Fixez `/bin/bash` comme shell de `stagiaire1`.

\*\*D√©marche :\*\*



```bash

sudo usermod -s /bin/bash stagiaire1

```



\*\*Astuce :\*\* utile si l‚Äôutilisateur est sur `/bin/sh` limit√©.

\*\*Pi√®ge :\*\* un mauvais chemin = utilisateur bloqu√©.



---



\### \*\*Exercice 7 : Bloquer un utilisateur temporairement\*\*



\*\*√ânonc√© :\*\* D√©sactivez l‚Äôacc√®s de `stagiaire1` sans supprimer le compte.

\*\*D√©marche :\*\*



```bash

sudo usermod -L stagiaire1

```



\*\*Astuce :\*\* `passwd -l` a le m√™me effet.

\*\*Pi√®ge :\*\* `-L` ‚â† suppression ‚Üí le compte existe toujours.



---



\### \*\*Exercice 8 : Cr√©er un compte avec date d‚Äôexpiration\*\*



\*\*√ânonc√© :\*\* Cr√©ez `stagiaire2` qui expire dans 10 jours.

\*\*D√©marche :\*\*



```bash

sudo useradd -m -e $(date -d "+10 days" +%F) stagiaire2

```



\*\*Astuce :\*\* `chage -l user` v√©rifie l‚Äôexpiration.

\*\*Pi√®ge :\*\* format de date incorrect = erreur silencieuse.



---



\### \*\*Exercice 9 : D√©finir des politiques de mot de passe\*\*



\*\*√ânonc√© :\*\* Imposer une expiration de mot de passe pour `stagiaire2`.

\*\*D√©marche :\*\*



```bash

sudo chage -M 30 stagiaire2

```



\*\*Astuce :\*\* force un renouvellement tous les 30 jours.

\*\*Pi√®ge :\*\* si trop court, les utilisateurs se plaignent ‚Üí trouver √©quilibre.



---



\### \*\*Exercice 10 : Cr√©er un compte avec UID sp√©cifique\*\*



\*\*√ânonc√© :\*\* Cr√©ez `audit` avec UID 1500.

\*\*D√©marche :\*\*



```bash

sudo useradd -m -u 1500 audit

```



\*\*Astuce :\*\* utile pour uniformiser sur plusieurs serveurs.

\*\*Pi√®ge :\*\* UID d√©j√† utilis√© ‚Üí conflit.



---



\### \*\*Exercice 11 : Identifier les UID et GID\*\*



\*\*√ânonc√© :\*\* Listez tous les utilisateurs syst√®me (<1000) et normaux (>=1000).

\*\*D√©marche :\*\*



```bash

awk -F: '$3 < 1000 {print $1, $3}' /etc/passwd

awk -F: '$3 >= 1000 {print $1, $3}' /etc/passwd

```



\*\*Astuce :\*\* tr√®s utile pour audit.

\*\*Pi√®ge :\*\* certaines distros utilisent 500 comme limite.



---



\### \*\*Exercice 12 : Supprimer un utilisateur proprement\*\*



\*\*√ânonc√© :\*\* Supprimez `stagiaire2` et son home.

\*\*D√©marche :\*\*



```bash

sudo userdel -r stagiaire2

```



\*\*Astuce :\*\* `-r` supprime aussi le home.

\*\*Pi√®ge :\*\* sans `-r`, les fichiers restent.



---



\### \*\*Exercice 13 : D√©finir un umask sp√©cifique\*\*



\*\*√ânonc√© :\*\* Fixez `umask` de `stagiaire1` √† `027`.

\*\*D√©marche :\*\*



```bash

echo "umask 027" | sudo tee -a /home/stagiaire1/.bashrc

```



\*\*Astuce :\*\* `umask` d√©finit les permissions par d√©faut.

\*\*Pi√®ge :\*\* erreur de syntaxe dans `.bashrc` bloque la session.



---



\### \*\*Exercice 14 : Cr√©er un groupe projet multi-utilisateurs\*\*



\*\*√ânonc√© :\*\* Cr√©ez un groupe `projetX` et donnez-lui acc√®s partag√© √† `/srv/projetX`.

\*\*D√©marche :\*\*



```bash

sudo groupadd projetX

sudo mkdir -p /srv/projetX

sudo chgrp projetX /srv/projetX

sudo chmod 2775 /srv/projetX

```



\*\*Astuce :\*\* `2` (setgid) force la cr√©ation des fichiers avec le groupe.

\*\*Pi√®ge :\*\* sans `2775`, les fichiers n‚Äôont pas le bon groupe.



---



\### \*\*Exercice 15 : V√©rifier les sessions actives\*\*



\*\*√ânonc√© :\*\* Voyez combien d‚Äôutilisateurs sont connect√©s en parall√®le.

\*\*D√©marche :\*\*



```bash

w

who

```



\*\*Astuce :\*\* rep√©rer les connexions suspectes.

\*\*Pi√®ge :\*\* ne pas confondre TTY local vs SSH.



---



\### \*\*Exercice 16 : Changer le r√©pertoire personnel\*\*



\*\*√ânonc√© :\*\* D√©placez le home de `stagiaire1` vers `/data/stagiaire1`.

\*\*D√©marche :\*\*



```bash

sudo usermod -d /data/stagiaire1 -m stagiaire1

```



\*\*Astuce :\*\* `-m` d√©place les fichiers existants.

\*\*Pi√®ge :\*\* sans `-m`, les fichiers restent dans l‚Äôancien r√©pertoire.



---



\### \*\*Exercice 17 : D√©finir un quota disque (niveau admin)\*\*



\*\*√ânonc√© :\*\* Limitez `stagiaire1` √† 500 Mo.

\*\*D√©marche (simplifi√©e) :\*\*



```bash

sudo edquota -u stagiaire1

```



\*\*Astuce :\*\* utile pour environnements partag√©s.

\*\*Pi√®ge :\*\* n√©cessite `quota` activ√© sur la partition.



---



\### \*\*Exercice 18 : Cr√©er un groupe sans utilisateurs\*\*



\*\*√ânonc√© :\*\* Cr√©ez `testgroup` sans membres.

\*\*D√©marche :\*\*



```bash

sudo groupadd testgroup

getent group testgroup

```



\*\*Astuce :\*\* groupes ‚Äúplaceholder‚Äù sont utiles pour futurs droits.

\*\*Pi√®ge :\*\* oublier de supprimer ensuite ‚Üí pollution.



---



\### \*\*Exercice 19 : Auditer les utilisateurs inactifs\*\*



\*\*√ânonc√© :\*\* Listez les comptes inactifs depuis 60 jours.

\*\*D√©marche :\*\*



```bash

sudo lastlog -b 60

```



\*\*Astuce :\*\* permet de nettoyer les comptes dormants.

\*\*Pi√®ge :\*\* certains comptes syst√®me n‚Äôont jamais de login ‚Üí ignorer.



---



\### \*\*Exercice 20 : Bloquer un groupe entier\*\*



\*\*√ânonc√© :\*\* Rendez `stagiaire1` et `stagiaire2` inutilisables en d√©sactivant `devops`.

\*\*D√©marche :\*\*



```bash

sudo groupdel devops

```



\*\*Astuce :\*\* supprime le groupe, mais pas les utilisateurs.

\*\*Pi√®ge :\*\* perte de droits impr√©vue.



---



\### \*\*Exercice 21 : Ajouter plusieurs utilisateurs d‚Äôun coup\*\*



\*\*√ânonc√© :\*\* Cr√©ez 3 utilisateurs √† partir d‚Äôun fichier.

\*\*D√©marche :\*\*



```bash

for u in user1 user2 user3; do sudo useradd -m $u; done

```



\*\*Astuce :\*\* automatisation via script.

\*\*Pi√®ge :\*\* oublier de mettre un mot de passe.



---



\### \*\*Exercice 22 : Modifier le GID primaire\*\*



\*\*√ânonc√© :\*\* Changez le groupe principal de `stagiaire1` vers `projetX`.

\*\*D√©marche :\*\*



```bash

sudo usermod -g projetX stagiaire1

```



\*\*Astuce :\*\* chaque fichier cr√©√© appartient √† ce groupe par d√©faut.

\*\*Pi√®ge :\*\* perte des droits si mal configur√©.



---



\### \*\*Exercice 23 : V√©rifier les droits d‚Äôun utilisateur\*\*



\*\*√ânonc√© :\*\* Quelles commandes `sudo` peut ex√©cuter `stagiaire1` ?

\*\*D√©marche :\*\*



```bash

sudo -l -U stagiaire1

```



\*\*Astuce :\*\* tr√®s utile pour audits de s√©curit√©.

\*\*Pi√®ge :\*\* ne pas tester sous root ‚Üí donne de faux r√©sultats.



---



\### \*\*Exercice 24 : Cr√©er un utilisateur syst√®me\*\*



\*\*√ânonc√© :\*\* Cr√©ez un utilisateur `backup` avec UID < 1000.

\*\*D√©marche :\*\*



```bash

sudo useradd -r backup

```



\*\*Astuce :\*\* `-r` = compte syst√®me.

\*\*Pi√®ge :\*\* ne pas l‚Äôutiliser pour un humain.



---



\### \*\*Exercice 25 : Rechercher un utilisateur par UID\*\*



\*\*√ânonc√© :\*\* Trouvez l‚Äôutilisateur avec UID 1000.

\*\*D√©marche :\*\*



```bash

getent passwd 1000

```



\*\*Astuce :\*\* utile si vous avez perdu le login.

\*\*Pi√®ge :\*\* ne pas confondre avec GID.



---



\### \*\*Exercice 26 : Cr√©er un compte temporaire\*\*



\*\*√ânonc√© :\*\* Cr√©ez `guest` qui expire demain.

\*\*D√©marche :\*\*



```bash

sudo useradd -m -e $(date -d tomorrow +%F) guest

```



\*\*Astuce :\*\* id√©al pour consultants.

\*\*Pi√®ge :\*\* si l‚Äôexpiration tombe un week-end ‚Üí planifier plus large.



---



\### \*\*Exercice 27 : Cr√©er un compte partag√© avec setgid\*\*



\*\*√ânonc√© :\*\* Cr√©ez `/srv/shared` partag√© par `devops`.

\*\*D√©marche :\*\*



```bash

sudo mkdir /srv/shared

sudo chgrp devops /srv/shared

sudo chmod 2770 /srv/shared

```



\*\*Astuce :\*\* tous les fichiers appartiennent automatiquement au groupe.

\*\*Pi√®ge :\*\* sans `2`, perte de coh√©rence.



---



\### \*\*Exercice 28 : Changer mot de passe d‚Äôun utilisateur\*\*



\*\*√ânonc√© :\*\* Changez le mot de passe de `stagiaire1` sans le conna√Ætre.

\*\*D√©marche :\*\*



```bash

sudo passwd stagiaire1

```



\*\*Astuce :\*\* utilis√© en cas d‚Äôoubli.

\*\*Pi√®ge :\*\* ne pas r√©utiliser le m√™me mot de passe.



---



\### \*\*Exercice 29 : Suivre les logs d‚Äôauthentification\*\*



\*\*√ânonc√© :\*\* V√©rifiez les tentatives de connexion √©chou√©es.

\*\*D√©marche :\*\*



```bash

sudo grep "Failed password" /var/log/auth.log

```



\*\*Astuce :\*\* d√©tecter brute-force.

\*\*Pi√®ge :\*\* sur certains syst√®mes, journalctl est obligatoire.



---



\### \*\*Exercice 30 : D√©fi final\*\*



\*\*√ânonc√© :\*\* Automatisez la cr√©ation d‚Äôun utilisateur projet avec :



\* R√©pertoire `/srv/projet1/userX`.

\* Groupe `projet1`.

\* Expiration apr√®s 7 jours.

&nbsp; \*\*D√©marche :\*\*



```bash

sudo groupadd projet1

sudo useradd -m -d /srv/projet1/userX -g projet1 -e $(date -d "+7 days" +%F) userX

```



\*\*Astuce :\*\* combinaison de tout ce que vous avez appris.

\*\*Pi√®ge :\*\* oublier `-d` ‚Üí mauvais chemin home.




