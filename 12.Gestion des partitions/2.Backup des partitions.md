# Atlier 3: Backup des partitions

## ğŸ“š Sommaire

1. Contexte & objectif

2. PrÃ©paration de lâ€™environnement *(10 min)*

3. Exercices + solutions pas Ã  pas *(40 min)*

4. VÃ©rifications et rÃ©sultats attendus *(5 min)*

5. Nettoyage / rollback *(5 min)*

6. Astuces & piÃ¨ges *(5 min)*

7. Bonus : alternatives et tests avancÃ©s *(10 min)*

8. SchÃ©ma visuel

9. RÃ©fÃ©rences

---

## 1ï¸âƒ£ Contexte & objectif

Un administrateur doit effectuer une **sauvegarde complÃ¨te de la partition `/home`** avant une mise Ã  jour systÃ¨me critique.  
Lâ€™objectif est dâ€™obtenir une image fiable quâ€™il pourra **restaurer intÃ©gralement** en cas de problÃ¨me.

> ğŸ¯ Ã€ la fin de cet atelier, vous saurez :
> 
> - Sauvegarder une partition avec `dd` (mÃ©thode brute).
> 
> - Sauvegarder plus efficacement avec `partclone`.
> 
> - Sauvegarder la table de partitions (`sfdisk`).
> 
> - Restaurer et vÃ©rifier lâ€™intÃ©gritÃ©.
> 
> - Tester le backup dans un environnement isolÃ©.

âš ï¸ **SÃ©curitÃ© absolue** :

> - Ne jamais exÃ©cuter ces commandes sur la partition systÃ¨me `/`.
> 
> - Travailler sur une **VM de test** ou un **disque clone**.
> 
> - Toujours vÃ©rifier la destination avant dâ€™Ã©crire avec `dd`.

---

## 2ï¸âƒ£ PrÃ©paration de lâ€™environnement (â‰ˆ 10 min)

### ğŸ’¾ Ã‰tape 1 â€“ Identifier la partition

```bash
# Afficher les disques, partitions, systÃ¨mes de fichiers et points de montage
lsblk -f
```

**Exemple de sortie :**

```text
NAME   FSTYPE LABEL UUID                                 MOUNTPOINTS
sda
â”œâ”€sda1 ext4         84d7-25f1                             /
â”œâ”€sda2 ext4         a9f2-99b3                             /home
â””â”€sda3 swap         5a4f-ef11                             [SWAP]
sdb
```

ğŸ‘‰ Nous allons sauvegarder `/dev/sda2` vers un espace de backup montÃ© sur `/mnt/backup` (ou un disque `/dev/sdb` correctement prÃ©parÃ©).

#### ğŸ§  DÃ©cryptage

- `lsblk -f` :
  
  - `lsblk` liste les pÃ©riphÃ©riques bloc (disques, partitions).
  
  - `-f` ajoute le systÃ¨me de fichiers (FSTYPE), les labels et UUID â†’ trÃ¨s utile pour ne pas se tromper de partition.

- La colonne **MOUNTPOINTS** vous indique ce qui est montÃ© et oÃ¹.

- Toujours repÃ©rer :
  
  - La partition **source** (Ã  sauvegarder)
  
  - Le **support de backup** (disque externe / autre partition / partage NFS, etc.)

#### ğŸ’¡ Astuces & conseils

- Ajoutez un commentaire dans votre journal de labo avec le rÃ©sultat de `lsblk -f` avant toute manipulation.

- Prenez lâ€™habitude de **survoler rapidement** la sortie pour repÃ©rer :
  
  - `/` (racine), `/home`, `swap`, Ã©ventuellement `/boot` ou `/boot/efi`.

- Si vous avez un doute, **ne faites rien** et revenez plus tard : mieux vaut perdre 10 minutes que dâ€™Ã©craser un disque de prod.

---

### ğŸ’¡ Simulation (mode loop file)

Si vous ne disposez pas dâ€™un second disque, crÃ©ez un **fichier simulant une partition** :

```bash
# CrÃ©e un fichier de 1 Go rempli de zÃ©ros pour simuler un disque/partition
dd if=/dev/zero of=/tmp/loop_test.img bs=1M count=1024

# Formate ce "faux disque" en ext4
mkfs.ext4 /tmp/loop_test.img

# CrÃ©e un point de montage pour le "faux disque"
sudo mkdir /mnt/loop_test

# Monte le fichier comme un pÃ©riphÃ©rique loop
sudo mount -o loop /tmp/loop_test.img /mnt/loop_test
```

#### ğŸ§  DÃ©cryptage ligne par ligne

- `dd if=/dev/zero of=/tmp/loop_test.img bs=1M count=1024`
  
  - `if=/dev/zero` : lit des zÃ©ros (octets vides).
  
  - `of=/tmp/loop_test.img` : Ã©crit dans un fichier image.
  
  - `bs=1M` : copie par blocs de 1 Mo.
  
  - `count=1024` : 1024 blocs â†’ 1024 Mo â‰ˆ 1 Go.

- `mkfs.ext4 /tmp/loop_test.img` : crÃ©e un systÃ¨me de fichiers ext4 **Ã  lâ€™intÃ©rieur** du fichier.

- `sudo mkdir /mnt/loop_test` : crÃ©e le rÃ©pertoire oÃ¹ lâ€™on va monter lâ€™image.

- `sudo mount -o loop ...` : le noyau traite le fichier comme un vrai pÃ©riphÃ©rique disque (*loop device*).

#### ğŸ’¡ Astuces & conseils

- Ce scÃ©nario est **parfait pour sâ€™entraÃ®ner** sans risquer de casser un vrai disque.

- Vous pouvez refaire plusieurs fois lâ€™atelier en supprimant simplement `/tmp/loop_test.img`.

- Sur une machine lente, rÃ©duisez `count=512` (â‰ˆ 512 Mo) pour aller plus vite.

---

## 3ï¸âƒ£ Exercices et solutions pas Ã  pas (â‰ˆ 40 min)

---

### ğŸ§© Exercice 1 â€“ Sauvegarder la table de partitions

> Sauvegardez la structure du disque `/dev/sda` pour pouvoir la restaurer en cas de corruption.

#### âœ… Solution

```bash
# Sauvegarde la table de partitions de /dev/sda dans un fichier texte
sudo sfdisk -d /dev/sda > /mnt/backup/sda_table_backup.sfdisk

# VÃ©rifie que le fichier de sauvegarde existe bien
ls -l /mnt/backup/sda_table_backup.sfdisk
```

ğŸ’¡ Restauration possible :

```bash
# Restaure la table de partitions sur /dev/sda Ã  partir du fichier
sudo sfdisk /dev/sda < /mnt/backup/sda_table_backup.sfdisk
```

#### ğŸ§  Explications dÃ©taillÃ©es

- `sudo sfdisk -d /dev/sda` :
  
  - `-d` = *dump* â†’ exporte la table de partitions au format lisible et rÃ©importable.

- Redirection `>` :
  
  - Envoie le contenu dans un fichier (`sda_table_backup.sfdisk`).
  
  - Si le fichier existe, il sera Ã©crasÃ© â†’ mÃ©fiance.

- `ls -l` :
  
  - Permet de vÃ©rifier que le fichier existe, sa taille, ses permissions.

- Restauration :
  
  - `sfdisk /dev/sda < fichier` rÃ©injecte la structure.
  
  - Cela nâ€™Ã©crit pas les donnÃ©es, mais **modifie la carte des partitions** â†’ opÃ©ration trÃ¨s sensible.

#### ğŸ’¡ Astuces & conseils

- Conservez ce fichier sur un **support externe** (clÃ© USB, dÃ©pÃ´t Git privÃ©, etc.).

- Vous pouvez lâ€™ouvrir dans un Ã©diteur pour comprendre la structure du disque â†’ trÃ¨s pÃ©dagogique.

- Avant une grande refonte de partitionnement (LVM, passage Ã  GPT, etc.), **toujours** faire un dump `sfdisk -d`.

---

### ğŸ§© Exercice 2 â€“ Sauvegarde brute avec `dd`

> CrÃ©ez une image complÃ¨te bit-Ã -bit de la partition `/dev/sda2`.

#### âœ… Solution

```bash
sudo dd \
  if=/dev/sda2 \
  of=/mnt/backup/sda2_backup.img \
  bs=4M \
  status=progress \
  conv=fsync
```

**Sortie typique :**

```text
2147483648 bytes (2.1 GB) copied, 35 s, 61 MB/s
```

#### ğŸ§  Explications dÃ©taillÃ©es

- `if=/dev/sda2` : **input file** â†’ la partition source.

- `of=/mnt/backup/sda2_backup.img` : **output file** â†’ fichier image de sauvegarde.

- `bs=4M` : taille de bloc 4 Mo, bon compromis entre performance et stabilitÃ©.

- `status=progress` : affiche une barre de progression, trÃ¨s utile sur les gros disques.

- `conv=fsync` : force la synchronisation sur disque avant la fin de la commande â†’ Ã©vite les Ã©critures en retard dans le cache.

#### ğŸ’¡ Astuces & conseils

- Avant de lancer `dd`, vÃ©rifier **trois fois** :
  
  - La source (`if=`)
  
  - La destination (`of=`)
  
  - Lâ€™espace disponible (`df -h /mnt/backup`)

- Sur les disques trÃ¨s gros, prÃ©fÃ©rez lancer `dd` dans un `tmux` ou `screen` pour ne pas perdre la session.

- En cas dâ€™erreur de partition (if/of inversÃ©s), vous **dÃ©truisez** la source : ne jamais lancer `dd` sans Ãªtre 100 % sÃ»r.

---

### ğŸ§© Exercice 3 â€“ Sauvegarde optimisÃ©e avec `partclone`

> Ã‰vitez de copier les blocs vides pour gagner temps et espace.

#### âœ… Solution

Installation :

```bash
# Installe lâ€™outil partclone depuis les dÃ©pÃ´ts
sudo apt install -y partclone
```

Sauvegarde :

```bash
sudo partclone.ext4 \
  -c \
  -s /dev/sda2 \
  -o /mnt/backup/sda2_partclone.img
```

**Sortie typique :**

```text
Partclone v0.3.23  EXTFS
Reading block 0...100% (OK)
Completed: 100.00%
```

ğŸ’¡ **Comparatif :**

```bash
ls -lh /mnt/backup/sda2_*.img
```

â†’ `partclone` rÃ©duit souvent la taille de 60 % (ou plus) par rapport Ã  `dd` selon le taux dâ€™occupation de la partition.

#### ğŸ§  Explications dÃ©taillÃ©es

- `partclone.ext4` : version de `partclone` pour systÃ¨mes de fichiers ext4.

- `-c` : *clone* (mode sauvegarde).

- `-s` : *source* (partition).

- `-o` : *output* (fichier de sauvegarde).

- `ls -lh` : affiche la taille des fichiers de maniÃ¨re lisible (K, M, G).

#### ğŸ’¡ Astuces & conseils

- `partclone` est idÃ©al pour les partitions peu remplies (ex : disque de 100 Go, 20 Go utilisÃ©s).

- TrÃ¨s utile pour des **snapshots rapides** dâ€™une VM avant un gros changement.

- Pensez Ã  garder `dd` *et* `partclone` : `dd` ne dÃ©pend pas du type de FS, `partclone` oui (ext4, xfs, etc.).

---

### ğŸ§© Exercice 4 â€“ VÃ©rification dâ€™intÃ©gritÃ©

> Comparez la source et lâ€™image sauvegardÃ©e.

#### âœ… Solution

```bash
# Calcule le hash MD5 de la partition source
sudo md5sum /dev/sda2 | cut -d' ' -f1

# Calcule le hash MD5 du fichier image dd
sudo md5sum /mnt/backup/sda2_backup.img | cut -d' ' -f1
```

Les deux hash doivent Ãªtre **strictement identiques**.

ğŸ’¡ Autre mÃ©thode :

```bash
# Compare les 1er Mo de la partition et de lâ€™image
sudo cmp -n 1048576 /dev/sda2 /mnt/backup/sda2_backup.img
```

â†’ Aucune sortie = aucune diffÃ©rence dÃ©tectÃ©e.

#### ğŸ§  Explications dÃ©taillÃ©es

- `md5sum` : gÃ©nÃ¨re une empreinte MD5.

- `cut -d' ' -f1` : garde seulement le hash, plus lisible pour comparaison visuelle.

- `cmp -n 1048576` : compare les 1 048 576 premiers octets (1 Mo).
  
  - Utile pour vÃ©rifier rapidement la cohÃ©rence sans tout relire.

#### ğŸ’¡ Astuces & conseils

- Pour des sauvegardes critiques, stockez les hash dans un fichier texte avec date, ex :  
  `md5sum sda2_backup.img > sda2_backup.img.md5`.

- Sur de trÃ¨s gros volumes, prÃ©fÃ©rez MD5/sha256 sur lâ€™image plutÃ´t que directement sur le device (moins de risques dâ€™E/S concurrentes).

- Si les hash ne matchent pas : **ne jamais utiliser** lâ€™image en restauration.

---

### ğŸ§© Exercice 5 â€“ Monter une image sauvegardÃ©e pour inspection

> Montez lâ€™image pour vÃ©rifier le contenu sans restauration.

#### âœ… Solution

```bash
# CrÃ©e un point de montage pour lâ€™image
sudo mkdir -p /mnt/test_img

# Monte lâ€™image en tant que pÃ©riphÃ©rique loop
sudo mount -o loop /mnt/backup/sda2_backup.img /mnt/test_img

# Liste le contenu de lâ€™image
ls /mnt/test_img
```

âœ… Vous accÃ©dez au contenu sauvegardÃ©.

DÃ©montez ensuite :

```bash
sudo umount /mnt/test_img
```

#### ğŸ§  Explications dÃ©taillÃ©es

- `mkdir -p` : crÃ©e le rÃ©pertoire si besoin, sans erreur sâ€™il existe.

- `mount -o loop` : demande au noyau de considÃ©rer le fichier comme un disque.

- `ls /mnt/test_img` : vous permet de vÃ©rifier que vos fichiers sont lÃ .

- `umount` : libÃ¨re le montage pour pouvoir supprimer ou dÃ©placer lâ€™image.

#### ğŸ’¡ Astuces & conseils

- TrÃ¨s pratique pour **vÃ©rifier une sauvegarde avant une restauration**.

- Vous pouvez copier un fichier prÃ©cis depuis la sauvegarde sans tout restaurer (ex : un document supprimÃ©).

- Nâ€™oubliez pas de dÃ©monter, sinon vous risquez dâ€™avoir des soucis lors de la suppression de lâ€™image.

---

### ğŸ§© Exercice 6 â€“ Restauration dâ€™une partition (mÃ©thode 1 : `dd`)

> Simulez une panne et restaurez `/dev/sda2` depuis le backup.

#### âœ… Solution

```bash
# Restaure la partition depuis l'image dd (Ã©crase tout le contenu actuel)
sudo dd \
  if=/mnt/backup/sda2_backup.img \
  of=/dev/sda2 \
  bs=4M \
  status=progress \
  conv=fsync

# Restaure la table de partitions si nÃ©cessaire
sudo sfdisk /dev/sda < /mnt/backup/sda_table_backup.sfdisk

# Force le noyau Ã  relire la table de partitions
sudo partprobe
```

âš ï¸ Ã‰crase complÃ¨tement la partition existante : **ne jamais exÃ©cuter en production** sans certitude absolue.

#### ğŸ§  Explications dÃ©taillÃ©es

- Le `dd` inverse simplement le sens :
  
  - Sauvegarde : `if=/dev/sda2` â†’ `of=...img`
  
  - Restauration : `if=...img` â†’ `of=/dev/sda2`

- `sfdisk /dev/sda < ...` : nÃ©cessaire si la table a Ã©tÃ© corrompue ou modifiÃ©e.

- `partprobe` : avertit le noyau de relire la table â†’ Ã©vite un reboot immÃ©diat.

#### ğŸ’¡ Astuces & conseils

- Toujours tester cette procÃ©dure **dans une VM** avant dâ€™espÃ©rer lâ€™utiliser sur un vrai serveur.

- Faites une capture dâ€™Ã©cran ou conservez les logs pour documenter votre procÃ©dure de PRA (Plan de Reprise dâ€™ActivitÃ©).

- AprÃ¨s restauration, toujours monter la partition en lecture seule dâ€™abord (`mount -o ro`) pour vÃ©rifier.

---

### ğŸ§© Exercice 7 â€“ Restauration (mÃ©thode 2 : `partclone`)

> Restaurer plus rapidement la mÃªme partition.

#### âœ… Solution

```bash
sudo partclone.ext4 \
  -r \
  -s /mnt/backup/sda2_partclone.img \
  -o /dev/sda2
```

- `-r` = *restore mode*.

- Beaucoup plus rapide que `dd` et copie uniquement les blocs utiles.

#### ğŸ§  Explications dÃ©taillÃ©es

- `-s` : source = fichier sauvegardÃ© par `partclone`.

- `-o` : destination = partition cible.

- `-r` : indique que lâ€™on est en mode **restauration**, pas en mode sauvegarde.

#### ğŸ’¡ Astuces & conseils

- TrÃ¨s intÃ©ressant pour les environnements oÃ¹ le **temps de restauration** est critique (VDI, lab, salles de formation).

- Vous pouvez faire plusieurs templates (`partclone` diffÃ©rents) pour diffÃ©rents profils machines.

- Gardez en tÃªte que `partclone` dÃ©pend du type de FS : une conversion ext4 â†’ xfs implique une autre approche.

---

### ğŸ§© Exercice 8 â€“ Validation finale

> Montez la partition restaurÃ©e et vÃ©rifiez le contenu.

#### âœ… Solution

```bash
# CrÃ©e un point de montage pour tester la restauration
sudo mkdir -p /mnt/restore_test

# Monte la partition restaurÃ©e
sudo mount /dev/sda2 /mnt/restore_test

# VÃ©rifie que les donnÃ©es sont bien prÃ©sentes
ls /mnt/restore_test

# DÃ©monte aprÃ¨s contrÃ´le
sudo umount /mnt/restore_test
```

âœ… Les donnÃ©es dâ€™origine sont restaurÃ©es **intactes**.

#### ğŸ§  Explications dÃ©taillÃ©es

- On valide la restauration **comme un utilisateur** : on monte et on regarde les fichiers.

- Si la partition contient `/home`, vÃ©rifiez la prÃ©sence des dossiers utilisateurs, droits (`ls -l`), etc.

- En cas dâ€™erreur de montage (ex : `bad superblock`), la restauration est Ã  refaire ou le FS est rÃ©ellement endommagÃ©.

#### ğŸ’¡ Astuces & conseils

- Ajoutez un test simple : ouvrir un fichier texte, vÃ©rifier son contenu, comparer avec une copie prÃ©cÃ©dente.

- Vous pouvez automatiser ce test dans un petit script de validation aprÃ¨s restauration.

- Gardez une checklist *papier* ou *Markdown* Ã  suivre pas Ã  pas le jour oÃ¹ vous devrez vraiment restaurer.

---

## 4ï¸âƒ£ VÃ©rifications et rÃ©sultats attendus (â‰ˆ 5 min)

| Ã‰tape             | Commande                                | RÃ©sultat attendu   |
| ----------------- | --------------------------------------- | ------------------ |
| Table sauvegardÃ©e | `ls /mnt/backup/*.sfdisk`               | Fichier prÃ©sent    |
| Image brute       | `ls -lh /mnt/backup/sda2_backup.img`    | Taille â‰ˆ partition |
| Image optimisÃ©e   | `ls -lh /mnt/backup/sda2_partclone.img` | Taille rÃ©duite     |
| IntÃ©gritÃ©         | `md5sum` sur source & image             | Hash identiques    |
| Restauration      | `mount /dev/sda2 /mnt/restore_test`     | DonnÃ©es retrouvÃ©es |

ğŸ’¡ Vous pouvez ajouter ces vÃ©rifications dans un **script dâ€™audit** exÃ©cutÃ© aprÃ¨s chaque backup.

---

## 5ï¸âƒ£ Nettoyage / rollback (â‰ˆ 5 min)

```bash
# Tente de dÃ©monter les points de montage de test, ignore les erreurs
sudo umount /mnt/backup /mnt/restore_test 2>/dev/null || true

# Supprime les fichiers de backup crÃ©Ã©s pour lâ€™atelier
sudo rm -f \
  /mnt/backup/sda2_backup.img \
  /mnt/backup/sda2_partclone.img \
  /mnt/backup/sda_table_backup.sfdisk

# Supprime les rÃ©pertoires de test
sudo rm -rf /mnt/test_img /mnt/restore_test
```

#### ğŸ§  Explications dÃ©taillÃ©es

- `2>/dev/null || true` :
  
  - Redirige les erreurs vers le nÃ©ant â†’ Ã©vite dâ€™afficher un message si les points ne sont pas montÃ©s.
  
  - `|| true` empÃªche le script de sâ€™arrÃªter si `umount` Ã©choue.

- `rm -f` : supprime sans poser de questions, mÃªme si le fichier nâ€™existe pas.

- `rm -rf` : suppression rÃ©cursive de rÃ©pertoires â†’ toujours vÃ©rifier le chemin.

#### ğŸ’¡ Astuces & conseils

- Ne gardez pas trop dâ€™images de test sur le disque, vous risquez de saturer lâ€™espace.

- Sur un environnement de formation, prÃ©voyez un **script de reset** des labos qui exÃ©cute ces commandes.

- Sur un environnement rÃ©el, ne mettez pas `rm -rf` partout : prÃ©fÃ©rez des suppressions manuelles ou trÃ¨s encadrÃ©es.

---

## 6ï¸âƒ£ Astuces & piÃ¨ges (â‰ˆ 5 min)

| ProblÃ¨me                  | Cause                    | Solution                                    |
| ------------------------- | ------------------------ | ------------------------------------------- |
| `dd` trop lent            | Bloc `bs` trop petit     | Utiliser `bs=4M` ou `8M`                    |
| Image trop volumineuse    | Copie bloc Ã  bloc        | Utiliser `partclone`                        |
| Partition montÃ©e          | Risque dâ€™incohÃ©rence     | Lancer `sync` ou travailler depuis Live CD  |
| Espace disque insuffisant | Destination trop petite  | VÃ©rifier avec `df -h`                       |
| Mauvais pÃ©riphÃ©rique      | Erreur fatale dâ€™Ã©criture | Toujours confirmer avec `lsblk` avant `of=` |

ğŸ’¡ Conseils pÃ©dagogiques / pratiques :

- Avant dâ€™enseigner cet atelier, prÃ©voyez un **scÃ©nario de panne** clair (ex : corruption simulÃ©e).

- Faites toujours une **dÃ©mo complÃ¨te** (sauvegarde â†’ restauration â†’ validation) une fois avant la session.

- Insistez auprÃ¨s des stagiaires : *la vraie compÃ©tence nâ€™est pas de taper la commande, mais de savoir quand ne pas la taper*.

---

## 7ï¸âƒ£ Bonus : alternatives & tests avancÃ©s (â‰ˆ 10 min)

### ğŸ”¸ Sauvegarde logique (alternative)

```bash
# Copie logique du contenu de /home vers un rÃ©pertoire de backup
sudo rsync -aAXv /home/ /mnt/backup/home_rsync/
```

#### ğŸ§  Explications dÃ©taillÃ©es

- `-a` : mode archive (permissions, dates, liensâ€¦).

- `-A` : prÃ©serve les ACL.

- `-X` : prÃ©serve les attributs Ã©tendus.

- `-v` : verbose, affiche ce qui est copiÃ©.

#### ğŸ’¡ Astuces & conseils

- IdÃ©al pour des backups **quotidiens** ou **incrÃ©mentaux**.

- Vous pouvez combiner avec `--delete` pour synchroniser exactement les deux arborescences (Ã  utiliser avec prÃ©caution).

- ComplÃ©mentaire Ã  `dd`/`partclone` : lâ€™un pour lâ€™aspect *systÃ¨me*, lâ€™autre pour lâ€™aspect *donnÃ©es*.

---

### ğŸ”¸ Backup dâ€™une partition LUKS (avancÃ©)

```bash
# Ouvre un volume chiffrÃ© LUKS
sudo cryptsetup luksOpen /dev/sda4 securedata

# Sauvegarde le systÃ¨me de fichiers dÃ©chiffrÃ© avec partclone
sudo partclone.ext4 \
  -c \
  -s /dev/mapper/securedata \
  -o /mnt/backup/securedata.img

# Referme le volume chiffrÃ©
sudo cryptsetup luksClose securedata
```

#### ğŸ§  Explications dÃ©taillÃ©es

- `cryptsetup luksOpen` : dÃ©verrouille la partition chiffrÃ©e et crÃ©e `/dev/mapper/securedata`.

- `partclone.ext4` : travaille sur la **vue dÃ©chiffrÃ©e** du systÃ¨me de fichiers.

- `luksClose` : referme proprement le conteneur chiffrÃ©.

#### ğŸ’¡ Astuces & conseils

- Toujours tester la procÃ©dure dâ€™ouverture/fermeture LUKS **avant** de lancer la sauvegarde.

- Ne laissez jamais un volume chiffrÃ© ouvert sans raison sur un environnement partagÃ©.

- Conservez les mots de passe/phrases secrÃ¨tes dans un gestionnaire de secrets, pas dans un simple fichier texte.

---

### ğŸ”¸ Montage dâ€™une image loop (lecture seule)

```bash
# Monte l'image en lecture seule pour Ã©viter toute modification accidentelle
sudo mount -o loop,ro /mnt/backup/sda2_backup.img /mnt/test_img
```

#### ğŸ§  Explications dÃ©taillÃ©es

- `ro` : *read-only* â†’ garantit quâ€™aucune Ã©criture ne sera faite sur lâ€™image.

- Parfait pour rÃ©aliser des **analyses forensiques** ou des vÃ©rifications sans risque.

#### ğŸ’¡ Astuces & conseils

- Pensez Ã  lâ€™option `ro` dÃ¨s que vous travaillez sur un backup que vous voulez garder comme **rÃ©fÃ©rence**.

- Pour les enquÃªtes (sÃ©curitÃ©, audit), travaillez toujours sur une copie en lecture seule de lâ€™image.

---

## 8ï¸âƒ£ SchÃ©ma visuel du processus

```mermaid
graph TD
A[Partition source /dev/sda2]:::blue -->|Sauvegarde brute| B[sda2_backup.img]:::gray
A -->|Sauvegarde optimisÃ©e| C[sda2_partclone.img]:::green
B -->|Restauration dd| D[/dev/sda2 restaurÃ©e]:::green
C -->|Restauration partclone -r| D
E[sfdisk table]:::orange -->|Structure restaurÃ©e| D
classDef blue fill:#cce5ff,stroke:#004085;
classDef green fill:#d4edda,stroke:#155724;
classDef gray fill:#e2e3e5,stroke:#383d41;
classDef orange fill:#fff3cd,stroke:#856404;
```

**Flux global** :  
Source â†’ Sauvegarde (`dd` / `partclone`) â†’ Restauration â†’ Validation.

---

## 9ï¸âƒ£ RÃ©fÃ©rences

- `man dd`

- `man partclone`

- `man sfdisk`

- Debian Wiki â€“ *BackupAndRecovery*
