# üß∞ Atelier 1 ‚Äì Explorer et comprendre le contenu de `/boot`

*(Version 2 ‚Äì am√©lior√©e et recentr√©e Debian)*

## üîñ Informations g√©n√©rales

- **Niveau** : interm√©diaire  
- **Syst√®me cibl√©** : Debian 12 / Debian 13 uniquement  
- **Objectif global** : explorer le r√©pertoire `/boot`, comprendre ses composants, et apprendre √† pr√©venir ou r√©parer les pannes li√©es au d√©marrage.  
- **Pr√©requis** :
  - Machine Debian avec `sudo`.  
  - Aucun autre syst√®me requis.  

## 1Ô∏è‚É£ Contexte & objectif

Sur Debian, `/boot` contient les fichiers critiques n√©cessaires avant le montage de la racine `/`.  
Le moindre incident (UUID, espace plein, noyau manquant, grub.cfg corrompu) peut rendre le syst√®me **inaccessible au d√©marrage**.  

> üéØ √Ä la fin de cet atelier, vous saurez :
> 
> - Identifier les fichiers essentiels (`vmlinuz`, `initrd`, `grub.cfg`).  
> - Comprendre le r√¥le de `/boot` dans la cha√Æne BIOS/UEFI ‚Üí GRUB ‚Üí noyau.  
> - Sauvegarder, v√©rifier et d√©panner `/boot` en toute s√©curit√©.  

## 2Ô∏è‚É£ Sauvegarde pr√©ventive avant exploration

```bash
sudo mkdir -p /root/boot_backup_$(date +%F)
sudo cp -a /boot/* /root/boot_backup_$(date +%F)/
```

‚úÖ Vous pouvez restaurer avec :

```bash
sudo cp -a /root/boot_backup_YYYY-MM-DD/* /boot/
sudo update-grub
```

## 3Ô∏è‚É£ Exploration et compr√©hension du contenu

### üß© Exercice 1 ‚Äì Lister le contenu

```bash
ls -lh /boot
```

| Fichier        | R√¥le                                  |
| -------------- | ------------------------------------- |
| `vmlinuz-*`    | noyau Linux compress√©                 |
| `initrd.img-*` | image initramfs pour monter `/`       |
| `config-*`     | configuration de compilation du noyau |
| `System.map-*` | symboles m√©moire du noyau             |
| `grub/`        | r√©pertoire du chargeur GRUB           |

### üß© Exercice 2 ‚Äì Identifier le noyau actif

```bash
uname -r
```

### üß© Exercice 3 ‚Äì Examiner GRUB

```bash
sudo grep "menuentry" /boot/grub/grub.cfg
sudo less /boot/grub/grub.cfg
```

### üß© Exercice 4 ‚Äì V√©rifier le mode de d√©marrage

```bash
[ -d /sys/firmware/efi ] && echo "UEFI mode" || echo "Legacy BIOS mode"
```

### üß© Exercice 5 ‚Äì Analyser le type de table de partitions

```bash
sudo parted -l | grep "Partition Table"
```

### üß© Exercice 6 ‚Äì V√©rifier l‚Äôespace disponible

```bash
df -h /boot
```

### üß© Exercice 7 ‚Äì Afficher les noyaux install√©s

```bash
dpkg --list | grep linux-image
sudo apt remove --purge linux-image-OLDVERSION
sudo update-grub
```

## 4Ô∏è‚É£ Cas particuliers : `/boot` avanc√©

| Situation                | D√©tails Debian                                                                            |
| ------------------------ | ----------------------------------------------------------------------------------------- |
| `/boot` sur **LVM**      | GRUB peut lire LVM, mais √©viter sur anciens BIOS.                                         |
| `/boot` chiffr√© (LUKS)** | GRUB2 ‚â• 2.06 supporte le chiffrement, mais la cl√© doit √™tre saisie au d√©marrage.          |
| **Secure Boot activ√©**   | Les binaires GRUB et noyaux sign√©s (shim, mokutil). V√©rifiez avec : `mokutil --sb-state`. |

## 5Ô∏è‚É£ Simulation d‚Äôun incident GRUB et d√©pannage

```bash
sudo mv /boot/grub/grub.cfg /boot/grub/grub.cfg.bak
sudo update-grub
```

En cas de vraie panne :

```bash
sudo mount /dev/sda2 /mnt
sudo mount /dev/sda1 /mnt/boot
sudo grub-install --root-directory=/mnt /dev/sda
sudo update-grub
```

## 6Ô∏è‚É£ V√©rifications et s√©curit√©

| V√©rification   | Commande             | Attendu                          |
| -------------- | -------------------- | -------------------------------- |
| Partition boot | `lsblk -f`           | `/boot` mont√©e ou int√©gr√©e √† `/` |
| Fichiers cl√©s  | `ls /boot`           | vmlinuz, initrd, grub/           |
| Noyau actif    | `uname -r`           | correspondance OK                |
| Espace libre   | `df -h /boot`        | > 100 Mo                         |
| Secure Boot    | `mokutil --sb-state` | SecureBoot enabled/disabled      |

## 7Ô∏è‚É£ Nettoyage et restauration

```bash
sudo apt autoremove --purge
sudo cp -a /root/boot_backup_YYYY-MM-DD/* /boot/
sudo update-grub
```

## 8Ô∏è‚É£ Astuces & bonnes pratiques Debian

| Cas                             | Commande utile                            |
|:------------------------------- |:----------------------------------------- |
| R√©installer GRUB                | `sudo grub-install /dev/sda`              |
| Recr√©er initramfs               | `sudo update-initramfs -u`                |
| Forcer la d√©tection des disques | `sudo update-grub`                        |
| V√©rifier EFI BootOrder          | `sudo efibootmgr -v`                      |
| Boot rapide sans menu           | `GRUB_TIMEOUT=0` dans `/etc/default/grub` |

## 9Ô∏è‚É£ R√©sum√© final

1. `/boot` h√©berge le noyau, initramfs et GRUB.  
2. Il peut √™tre une partition s√©par√©e.  
3. Sauvegardez-le avant toute mise √† jour noyau.  
4. Surveillez son espace libre.  
5. En cas de corruption : `update-grub` ou r√©installation depuis live.  
6. Taille recommand√©e Debian : **512 Mo √† 1 Go**.  
7. Compatible LVM/chiffrement, mais √† g√©rer prudemment.
