# üß∞ Atelier 1 ‚Äì D√©couverte du disque et de ses partitions *(Version 2 am√©lior√©e)*

### üîñ Informations g√©n√©rales

- **Dur√©e estim√©e** : 40 √† 50 minutes

- **Niveau** : d√©butant √† interm√©diaire

- **Objectif global** : comprendre la structure et la composition des disques sous Linux Debian, identifier les partitions, leur type, leur syst√®me de fichiers et leur point de montage.

- **Pr√©requis** : machine Debian 12/13 avec droits `sudo` et, si possible, un second disque virtuel (`sdb` d‚Äôenviron 2 Go).

---

## 1Ô∏è‚É£ Contexte et objectif

Un administrateur syst√®me vient de recevoir une machine Debian fra√Æchement install√©e.  
Avant de configurer des services ou d‚Äôajouter de nouveaux volumes, il doit **dresser un inventaire complet du stockage** : disques, partitions, syst√®mes de fichiers et points de montage.

> üéØ √Ä la fin de l‚Äôatelier, vous saurez :
> 
> - Identifier les disques visibles par le syst√®me.
> 
> - Lire une table de partitions (MBR/GPT).
> 
> - Associer chaque partition √† son syst√®me de fichiers et point de montage.
> 
> - Produire un inventaire synth√©tique exportable.

---

## 2Ô∏è‚É£ Pr√©paration de l‚Äôenvironnement

### √âtape 1 : V√©rifier la pr√©sence des disques

```bash
sudo ls /dev/sd*
```

- Si vous voyez `/dev/sda` et `/dev/sdb`, c‚Äôest parfait.

- Si vous √™tes dans un environnement cloud, les noms peuvent √™tre diff√©rents :
  
  - `/dev/vda` (VirtIO)
  
  - `/dev/nvme0n1` (disque NVMe)

### √âtape 2 : Nettoyer les montages r√©siduels

```bash
sudo umount -a 2>/dev/null || true
```

> üí° **Astuce :** Si vous venez d‚Äôajouter un disque virtuel dans VirtualBox, ex√©cutez :
> 
> ```bash
> sudo partprobe
> ```
> 
> pour que le noyau prenne en compte le nouveau disque sans red√©marrage.

---

## 3Ô∏è‚É£ √âtapes pas √† pas

### üîπ √âtape 1 ‚Äì Inspection du disque principal

```bash
lsblk
```

**R√©sultat attendu typique :**

```
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0   20G  0 disk 
‚îú‚îÄsda1   8:1    0   19G  0 part /
‚îî‚îÄsda2   8:2    0    1G  0 part [SWAP]
sdb      8:16   0    2G  0 disk
```

**Interpr√©tation :**

- `TYPE=disk` ‚Üí disque physique complet

- `TYPE=part` ‚Üí partition

- `MOUNTPOINTS` indique o√π elle est mont√©e

> üß† **Remarque :** les noms changent selon le type de disque (`sda`, `vda`, `nvme0n1`), mais la logique reste identique.

---

### üîπ √âtape 2 ‚Äì Lecture de la table de partition

```bash
sudo fdisk -l
```

**Exemple :**

```
Disk /dev/sda: 20 GiB, 21474836480 bytes, 41943040 sectors
Disklabel type: gpt
Device       Start      End  Sectors  Size Type
/dev/sda1     2048 39843839 39841792   19G Linux filesystem
/dev/sda2  39843840 41940991  2097152    1G Linux swap
```

**Analyse :**

- `Disklabel type` ‚Üí GPT

- `Start/End/Sectors` ‚Üí positions physiques

- `Type` ‚Üí type de partition

---

### üîπ √âtape 3 ‚Äì V√©rification via parted

```bash
sudo parted -l
```

**Extrait attendu :**

```
Model: ATA VBOX HARDDISK (scsi)
Disk /dev/sda: 21.5GB
Partition Table: gpt
Number  Start   End     Size    File system  Name  Flags
 1      1049kB  20.4GB  20.4GB  ext4
 2      20.4GB  21.5GB  1074MB  linux-swap
```

**Int√©r√™t :**  
`parted` g√®re mieux les disques GPT et affiche la table sous un format plus lisible.

---

### üîπ √âtape 4 ‚Äì Identifier les syst√®mes de fichiers

```bash
sudo blkid
```

**Exemple :**

```
/dev/sda1: UUID="32a7...bcd" TYPE="ext4" PARTLABEL="root"
/dev/sda2: UUID="9f3e...21b" TYPE="swap"
```

> `UUID` = identifiant unique du syst√®me de fichiers.  
> `TYPE` = nature du FS (ext4, xfs, swap, etc.).

---

### üîπ √âtape 5 ‚Äì Confirmer les points de montage

```bash
df -Th
```

**Exemple :**

```
Filesystem     Type  Size  Used Avail Use% Mounted on
/dev/sda1      ext4   19G  4.0G   15G  22% /
tmpfs          tmpfs 1.9G     0  1.9G   0% /dev/shm
```

---

### üîπ √âtape 6 ‚Äì Lecture bas niveau du noyau

```bash
cat /proc/partitions
```

**Extrait :**

```
major minor  #blocks  name
   8        0   20971520 sda
   8        1   19920896 sda1
   8        2    1048576 sda2
```

> Cette vue brute est utile pour diagnostiquer des probl√®mes bas niveau ou pour les scripts syst√®me.

---

### üîπ √âtape 7 ‚Äì D√©tection de type brut du contenu

```bash
sudo file -s /dev/sda1
```

**Exemple :**

```
/dev/sda1: Linux rev 1.0 ext4 filesystem data, UUID=32a7bcd1..., volume name "rootfs"
```

---

### üîπ √âtape 8 ‚Äì R√©sum√© global et export

```bash
lsblk -f
```

**R√©sultat :**

```
NAME   FSTYPE LABEL UUID                                 MOUNTPOINTS
sda                                                          
‚îú‚îÄsda1 ext4         32a7bcd1-...                            /
‚îî‚îÄsda2 swap         9f3e21b-...                             [SWAP]
sdb
```

Exporter le rapport :

```bash
lsblk -f > /tmp/inventaire_disques.txt
cat /tmp/inventaire_disques.txt
```

---

## 4Ô∏è‚É£ V√©rification & mini-exercice de synth√®se

üëâ **T√¢che :**  
Cr√©ez un petit tableau (papier ou √©diteur de texte) r√©capitulant vos observations :

| Nom du p√©riph√©rique | Taille | Type | Syst√®me de fichiers | Point de montage |
| ------------------- | ------ | ---- | ------------------- | ---------------- |
| `/dev/sda1`         | 19G    | part | ext4                | `/`              |
| `/dev/sda2`         | 1G     | part | swap                | `[SWAP]`         |
| `/dev/sdb`          | 2G     | disk | ‚Äî                   | ‚Äî                |

---

## 5Ô∏è‚É£ Nettoyage / Rollback

Aucune d√©sinstallation n√©cessaire.  
Si vous aviez ajout√© un disque virtuel `sdb` :

1. √âteignez la VM.

2. Retirez le disque depuis VirtualBox ou votre console cloud.

Optionnel : supprimer le fichier d‚Äôinventaire.

```bash
rm /tmp/inventaire_disques.txt
```

---

## 6Ô∏è‚É£ Astuces & pi√®ges courants

| Probl√®me                        | Cause probable                   | Solution                                         |
| ------------------------------- | -------------------------------- | ------------------------------------------------ |
| Le disque ajout√© n‚Äôappara√Æt pas | Le noyau n‚Äôa pas relu la table   | `sudo partprobe`                                 |
| Les noms `/dev/sda` changent    | Ordre de d√©tection du contr√¥leur | Identifier via `lsblk -S`                        |
| Pas de FS d√©tect√©               | Partition non format√©e           | √Ä traiter dans Atelier 2                         |
| UUID manquant                   | FS corrompu ou inexistant        | Recr√©er avec `mkfs.ext4 -U random`               |
| Affichage tronqu√©               | Terminal trop √©troit             | Utiliser `lsblk -o NAME,SIZE,FSTYPE,MOUNTPOINTS` |

---

## 7Ô∏è‚É£ Visualisation hi√©rarchique

+-------------------------------------------------+
|              DISQUE /dev/sda                 |
+-------------------+-----------------------------+
|    /dev/sda1      |         /dev/sda2     |
|    ext4                |         swap             |
|    /                      |    m√©moire swap |
+-------------------+-----------------------------+

## 8Ô∏è‚É£ Transition vers l‚Äôatelier suivant

> üîú **Atelier 2 : Cr√©ation et formatage d‚Äôune nouvelle partition**
> 
> Vous apprendrez √† cr√©er une partition sur le disque `sdb`, √† la formater en ext4 et √† la monter sur `/data`.
