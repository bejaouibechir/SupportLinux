# Exercices sur le partage du contenu NFS

### ğŸ”¹ **Exercice 1 â€“ CrÃ©er un partage NFS simple**

**ProblÃ©matique :**  
Vous Ãªtes administrateur dâ€™un serveur Ubuntu. Vous devez crÃ©er un dossier `/srv/nfs/data` et le partager avec tous les clients du rÃ©seau.

**DÃ©marche :**  
1. Installer le serveur NFS :
   ```bash
   sudo apt install nfs-kernel-server
   ```
2. CrÃ©er le dossier :
   ```bash
   sudo mkdir -p /srv/nfs/data
   sudo chown nobody:nogroup /srv/nfs/data
   sudo chmod 755 /srv/nfs/data
   ```
3. Ajouter la ligne suivante Ã  `/etc/exports` :
   ```
   /srv/nfs/data *(rw,sync,no_subtree_check)
   ```
4. RedÃ©marrer les services :
   ```bash
   sudo exportfs -ra
   sudo systemctl restart nfs-server
   ```

**Explication :**  
Le dossier est accessible en lecture/Ã©criture Ã  nâ€™importe quel client via NFS.

La sortie de `sudo systemctl status nfs-server` indique que le service **NFS Server** est bien activÃ© et **sâ€™est lancÃ© correctement**, mais quâ€™il est **dans lâ€™Ã©tat "exited"**. Cela signifie :

- Le service a dÃ©marrÃ© sans erreur (`status=0/SUCCESS`)
- Mais il **nâ€™a pas de processus en arriÃ¨re-plan actif en continu** (ce qui est normal pour certains services, comme `nfs-server`, qui lancent des sous-processus au besoin via `rpc.nfsd`)

### En rÃ©sumÃ© :
âœ… Service lancÃ© : **oui**  
âœ… Pas dâ€™erreurs au dÃ©marrage : **oui**  
ğŸ“¦ Mode actif : **"exited"**, ce qui est **normal pour NFS** si `nfsd` n'a pas encore reÃ§u de requÃªtes.

### Pour aller plus loin :
VÃ©rifier si les services associÃ©s tournent bien :

```bash
sudo systemctl status nfs-mountd
sudo systemctl status rpcbind
sudo systemctl status nfs-idmapd
```

Et tester le fonctionnement avec :

```bash
showmount -e localhost
```
**RÃ©sultat attendu :**  
Depuis un client, la commande suivante permet de monter le dossier :
```bash
sudo mount SERVER_IP:/srv/nfs/data /mnt
```

---

### ğŸ”¹ **Exercice 2 â€“ Partage restreint Ã  un sous-rÃ©seau**

**ProblÃ©matique :**  
Le dossier `/srv/secure_data` doit Ãªtre partagÃ© uniquement avec les machines du sous-rÃ©seau `192.168.1.0/24`.

**DÃ©marche :**  
1. CrÃ©er le dossier et configurer les permissions :
   ```bash
   sudo mkdir -p /srv/secure_data
   sudo chown nobody:nogroup /srv/secure_data
   ```
2. Modifier `/etc/exports` :
   ```
   /srv/secure_data 192.168.1.0/24(rw,sync,no_subtree_check)
   ```
3. Appliquer les modifications :
   ```bash
   sudo exportfs -ra
   ```

**Explication :**  
Seules les machines du sous-rÃ©seau spÃ©cifiÃ© auront accÃ¨s au dossier partagÃ©.

**RÃ©sultat attendu :**  
Un client situÃ© hors de `192.168.1.0/24` ne pourra pas monter le partage.

---

### ğŸ”¹ **Exercice 3 â€“ Monter un partage NFS au dÃ©marrage (client)**

**ProblÃ©matique :**  
Sur une machine cliente Ubuntu, vous souhaitez monter automatiquement le partage `/srv/nfs/data` dans `/mnt/data` au dÃ©marrage.

**DÃ©marche :**  
1. Installer le client NFS :
   ```bash
   sudo apt install nfs-common
   ```
2. CrÃ©er le point de montage :
   ```bash
   sudo mkdir -p /mnt/data
   ```
3. Ajouter cette ligne dans `/etc/fstab` :
   ```
   SERVER_IP:/srv/nfs/data /mnt/data nfs defaults 0 0
   ```
4. Tester sans redÃ©marrer :
   ```bash
   sudo mount -a
   ```

**Explication :**  
Le montage automatique via `fstab` Ã©vite une intervention manuelle Ã  chaque redÃ©marrage.

**RÃ©sultat attendu :**  
Le dossier distant est montÃ© automatiquement dans `/mnt/data` au boot.

---

### ğŸ”¹ **Exercice 4 â€“ DÃ©finir des permissions diffÃ©rentes selon lâ€™hÃ´te**

**ProblÃ©matique :**  
Vous voulez que la machine `192.168.1.10` ait un accÃ¨s **lecture-Ã©criture**, mais que `192.168.1.11` ait un accÃ¨s **lecture seule** sur `/srv/multi_access`.

**DÃ©marche :**  
1. CrÃ©er le dossier :
   ```bash
   sudo mkdir -p /srv/multi_access
   ```
2. Ajouter les lignes suivantes dans `/etc/exports` :
   ```
   /srv/multi_access 192.168.1.10(rw,sync,no_subtree_check)
   /srv/multi_access 192.168.1.11(ro,sync,no_subtree_check)
   ```
3. Appliquer :
   ```bash
   sudo exportfs -ra
   ```

**Explication :**  
La directive `/etc/exports` permet de dÃ©finir des droits spÃ©cifiques selon lâ€™IP du client.

**RÃ©sultat attendu :**  
Le client `192.168.1.11` peut lire les fichiers mais pas les modifier, contrairement Ã  `192.168.1.10`.

---

### ğŸ”¹ **Exercice 5 â€“ Diagnostiquer un problÃ¨me de montage NFS**

**ProblÃ©matique :**  
Sur une machine cliente, vous avez ajoutÃ© une entrÃ©e dans `/etc/fstab` pour monter un partage NFS, mais aprÃ¨s redÃ©marrage, le point de montage est vide.

**DÃ©marche :**  
1. VÃ©rifier le fichier `/etc/fstab` (erreurs de syntaxe, IP correcte).
2. Tester le montage manuellement :
   ```bash
   sudo mount -v -t nfs SERVER_IP:/srv/nfs/data /mnt/test
   ```
3. VÃ©rifier le statut du serveur NFS :
   ```bash
   sudo systemctl status nfs-server
   sudo exportfs -v
   ```
4. Regarder les logs :
   ```bash
   dmesg | grep nfs
   journalctl -xe
   ```

**Explication :**  
Les problÃ¨mes de montage peuvent venir dâ€™un rÃ©seau non prÃªt au boot, dâ€™une erreur de syntaxe ou de pare-feu.

**RÃ©sultat attendu :**  
Le montage manuel fonctionne, les erreurs sont corrigÃ©es dans `/etc/fstab` pour un montage correct au dÃ©marrage.
