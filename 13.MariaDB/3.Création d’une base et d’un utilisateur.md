# Atelier 1 — Création d’une base et d’un utilisateur

## But de l’atelier

Apprendre à :

1. Créer une base de données et y ajouter une table simple.

2. Créer un utilisateur avec un mot de passe.

3. Accorder à cet utilisateur uniquement les droits nécessaires sur cette base.

4. Vérifier que les permissions fonctionnent correctement.

Cet atelier montre le **principe du moindre privilège** : donner seulement ce qu’il faut à l’utilisateur.

---

## Étapes de l’atelier

1. Créer une base de données `gestion_stock`.

2. Créer une table simple `produits`.

3. Créer un utilisateur `stock_user` avec un mot de passe fort.

4. Lui donner uniquement les droits `SELECT`, `INSERT` et `UPDATE` sur `gestion_stock`.

5. Vérifier qu’il peut accéder à `gestion_stock` mais pas aux autres bases.

6. Vérifier qu’il ne peut pas exécuter d’actions interdites (ex : `DROP TABLE`).

---

## Démarches (commandes commentées)

> On exécute les commandes avec `sudo mysql` pour être en root.

### 1. Créer la base et la table

```sql
-- Création d'une base pour la démo
CREATE DATABASE gestion_stock;

-- On sélectionne la base
USE gestion_stock;

-- Création d'une table simple
CREATE TABLE produits (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    quantite INT NOT NULL,
    prix DECIMAL(10,2) NOT NULL
);

-- Insertion de quelques données
INSERT INTO produits (nom, quantite, prix) VALUES
('Stylo', 100, 1.50),
('Clavier', 10, 30.00),
('Écran', 5, 150.00);
```

---

### 2. Créer un utilisateur

```sql
-- Création d’un utilisateur 'stock_user' accessible uniquement en local
CREATE USER 'stock_user'@'localhost' IDENTIFIED BY 'MotDePasse!2025';
```

---

### 3. Donner les droits nécessaires

```sql
-- On accorde seulement SELECT, INSERT et UPDATE sur la base gestion_stock
GRANT SELECT, INSERT, UPDATE ON gestion_stock.* TO 'stock_user'@'localhost';

-- Appliquer les changements
FLUSH PRIVILEGES;
```

---

### 4. Vérification

```bash
# Se connecter avec le nouvel utilisateur
mysql -u stock_user -p
```

Dans MariaDB :

```sql
-- Vérifier l’accès à la base
USE gestion_stock;
SELECT * FROM produits;

-- Essayer une insertion (devrait marcher)
INSERT INTO produits (nom, quantite, prix) VALUES ('Souris', 20, 15.00);

-- Essayer une mise à jour (devrait marcher)
UPDATE produits SET quantite = 50 WHERE nom = 'Stylo';

-- Essayer une suppression (devrait échouer car pas de droit DELETE)
DELETE FROM produits WHERE nom = 'Écran';
```

---

## Résultats attendus

- `stock_user` peut consulter (`SELECT`), insérer (`INSERT`) et modifier (`UPDATE`) dans la base `gestion_stock`.

- `stock_user` **ne peut pas** supprimer (`DELETE`), créer ou supprimer des tables, ni accéder aux autres bases.

- Le test `DELETE` renvoie une erreur de type :
  
  ```
  ERROR 1142 (42000): DELETE command denied to user 'stock_user'@'localhost' for table 'produits'
  ```
