# Mise en place de rôles dans MariaDB

## But de l’atelier

Apprendre à :

1. Créer des rôles dans MariaDB.

2. Associer des privilèges à ces rôles.

3. Attribuer un ou plusieurs rôles à des utilisateurs.

4. Activer et vérifier les rôles en session.

Les rôles permettent de gérer les privilèges de manière plus simple et plus organisée, surtout dans des environnements avec beaucoup d’utilisateurs.

---

## Étapes de l’atelier

1. Créer une base et une table de démonstration.

2. Créer un rôle avec certains privilèges.

3. Créer des utilisateurs et leur attribuer ce rôle.

4. Activer le rôle et tester les privilèges.

5. Retirer un rôle et constater la différence.

---

### 1. Créer une base et une table de démonstration

```sql
CREATE DATABASE IF NOT EXISTS role_demo;
USE role_demo;

CREATE TABLE documents (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titre VARCHAR(100),
    contenu TEXT
);
```

---

### 2. Créer un rôle

```sql
-- Création d’un rôle appelé lecteur
CREATE ROLE lecteur;

-- Attribution de privilèges au rôle
GRANT SELECT ON role_demo.* TO lecteur;
```

---

### 3. Créer des utilisateurs et leur attribuer le rôle

```sql
CREATE USER 'alice'@'localhost' IDENTIFIED BY 'AlicePass!2025';
CREATE USER 'bob'@'localhost' IDENTIFIED BY 'BobPass!2025';

-- Attribution du rôle lecteur aux deux utilisateurs
GRANT lecteur TO 'alice'@'localhost';
GRANT lecteur TO 'bob'@'localhost';
```

Vérification :

```sql
SHOW GRANTS FOR 'alice'@'localhost';
```

Résultat attendu : il doit apparaître que `alice` possède le rôle `lecteur`.

---

### 4. Activer et tester le rôle

Par défaut, les rôles doivent être activés dans la session.

Connexion en tant qu’Alice :

```bash
mysql -u alice -p
```

Dans MariaDB :

```sql
-- Activer le rôle
SET ROLE lecteur;

-- Vérification des privilèges
SHOW GRANTS;

-- Test d’un SELECT (autorisé)
USE role_demo;
SELECT * FROM documents;

-- Test d’un INSERT (non autorisé)
INSERT INTO documents (titre, contenu) VALUES ('Doc1', 'Texte');
```

Résultat attendu :

- Le `SELECT` fonctionne.

- L’`INSERT` échoue avec une erreur de privilèges.

---

### 5. Retirer un rôle

```sql
REVOKE lecteur FROM 'bob'@'localhost';
```

Test en tant que Bob :

```bash
mysql -u bob -p
```

Puis :

```sql
SET ROLE lecteur;
```

Résultat attendu : erreur, le rôle n’est plus attribué.

---

## Résultats attendus

- Les rôles permettent de centraliser les privilèges.

- Les utilisateurs Alice et Bob héritent des droits du rôle `lecteur`.

- Alice peut lire mais pas écrire.

- Bob perd l’accès une fois que le rôle lui est retiré.

---
