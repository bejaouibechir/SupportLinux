# Atelier d'exploration MariaDB - Guide Pas-√†-Pas P√©dagogique

 

## üó∫Ô∏è √âTAPE 1 : D√©couverte des emplacements des binaires

Commen√ßons par comprendre o√π MariaDB est install√© sur votre syst√®me.

**Ex√©cutez cette commande :**

```bash
which mariadb
```

**Explication :**
La commande `which` nous montre o√π se trouve l'ex√©cutable `mariadb` dans le syst√®me de fichiers. Le r√©sultat devrait √™tre `/usr/bin/mariadb`, ce qui signifie que c'est l√† que le programme client MariaDB est install√©.

---

Maintenant, v√©rifions √©galement o√π se trouve la commande `mysql` :

**Ex√©cutez :**

```bash
which mysql
```

**Explication :**
Vous remarquerez probablement que `mysql` se trouve aussi dans `/usr/bin/`. C'est parce que MariaDB maintient la compatibilit√© avec MySQL. En fait, `mysql` est souvent un lien symbolique vers `mariadb`.

---

V√©rifions cela avec :

**Ex√©cutez :**

```bash
ls -l /usr/bin/mariadb /usr/bin/mysql
```

**Explication :**
La commande `ls -l` avec deux chemins nous montre les permissions et les liens. Vous verrez probablement que `/usr/bin/mysql` est un lien symbolique (fl√®che) pointant vers `/usr/bin/mariadb`. Cela signifie que quand vous tapez `mysql`, vous ex√©cutez en r√©alit√© `mariadb`.

---

## üîç √âTAPE 2 : Exploration des autres commandes MariaDB

D√©couvrons maintenant quelles autres commandes sont disponibles :

**Ex√©cutez :**

```bash
ls -la /usr/bin/mariadb*
```

**Explication :**
Le `*` est un caract√®re g√©n√©rique qui signifie "tout ce qui commence par mariadb". Vous verrez plusieurs commandes comme `mariadb`, `mariadb-check`, `mariadb-dump`, etc. Chacune a un r√¥le sp√©cifique dans l'administration de MariaDB.

---

Faisons la m√™me chose pour les commandes MySQL :

**Ex√©cutez :**

```bash
ls -la /usr/bin/mysql*
```

**Explication :**
Vous verrez un ensemble similaire de commandes. C'est normal car MariaDB est un fork de MySQL. Les d√©veloppeurs ont gard√© la m√™me interface pour faciliter la transition.

---

## üìÅ √âTAPE 3 : D√©couverte des fichiers de configuration

Les fichiers de configuration sont essentiels pour comprendre comment MariaDB fonctionne. Commen√ßons par trouver o√π ils sont stock√©s.

**Ex√©cutez :**

```bash
sudo find /etc -name "*mariadb*" -type f
```

**Explication :**
La commande `find` recherche dans `/etc` tous les fichiers (`-type f`) dont le nom contient "mariadb". Le `/etc` est le r√©pertoire standard pour les fichiers de configuration sur les syst√®mes Linux.

---

Si vous ne voyez pas beaucoup de r√©sultats, essayez aussi avec "mysql" :

**Ex√©cutez :**

```bash
sudo find /etc -name "*mysql*" -type f
```

**Explication :**
Parfois, MariaDB utilise encore des noms de fichiers avec "mysql" pour la compatibilit√©. Vous devriez voir plusieurs fichiers, dont probablement un dossier `/etc/mysql/`.

---

Explorons maintenant ce dossier `/etc/mysql/` s'il existe :

**Ex√©cutez :**

```bash
sudo ls -la /etc/mysql/
```

**Explication :**
Le `ls -la` nous montre tous les fichiers, m√™me ceux cach√©s (commen√ßant par un point), avec leurs permissions. Vous verrez probablement une structure organis√©e avec plusieurs sous-dossiers.

---

P√©n√©trez dans le dossier de configuration principal :

**Ex√©cutez :**

```bash
sudo ls -la /etc/mysql/mariadb.conf.d/
```

**Explication :**
Ce dossier contient les fichiers de configuration sp√©cifiques √† MariaDB. Les fichiers sont souvent nomm√©s avec des nombres comme `50-server.cnf`, `50-client.cnf`, etc. Les nombres indiquent l'ordre dans lequel ils sont charg√©s.

---

## üîß √âTAPE 4 : Comprendre la hi√©rarchie des fichiers de configuration

Voyons comment MariaDB charge ses configurations :

**Ex√©cutez :**

```bash
mariadb --verbose --help | grep -A 20 "Default options"
```

**Explication :**
Cette commande nous montre dans quel ordre MariaDB lit ses fichiers de configuration. Vous verrez qu'il commence par `/etc/my.cnf`, puis `/etc/mysql/my.cnf`, puis divers dossiers. C'est important car les derni√®res configurations lues √©crasent les premi√®res.

---

Examinons un fichier de configuration typique :

**Ex√©cutez :**

```bash
sudo head -30 /etc/mysql/mariadb.conf.d/50-server.cnf
```

**Explication :**
La commande `head -30` nous montre les 30 premi√®res lignes du fichier. Vous verrez qu'il est divis√© en sections entre crochets comme `[mysqld]`, `[client]`, etc. Chaque section contient des param√®tres sp√©cifiques.

---

## üìä √âTAPE 5 : D√©couverte des donn√©es MariaDB

Maintenant, d√©couvrons o√π MariaDB stocke ses donn√©es :

**Ex√©cutez :**

```bash
sudo ls -la /var/lib/mysql/
```

**Explication :**
Le dossier `/var/lib/mysql/` est l'emplacement par d√©faut des bases de donn√©es. Chaque base de donn√©es est un sous-dossier ici. Les fichiers avec les extensions `.ibd`, `.frm`, etc., contiennent les tables et les donn√©es.

---

V√©rifions si c'est bien l'emplacement configur√© :

**Ex√©cutez :**

```bash
sudo grep -r "datadir" /etc/mysql/
```

**Explication :**
La commande `grep -r` recherche r√©cursivement le mot "datadir" dans tous les fichiers de `/etc/mysql/`. C'est le param√®tre qui d√©finit o√π MariaDB stocke ses donn√©es.

---

## üìù √âTAPE 6 : V√©rification de la configuration actuelle

Connectons-nous √† MariaDB pour voir les param√®tres actuels :

**Ex√©cutez :**

```bash
sudo mariadb -e "SHOW VARIABLES LIKE 'datadir';"
```

**Explication :**
La commande `sudo mariadb -e` ex√©cute une commande SQL sans entrer dans l'interpr√©teur interactif. Ici, nous demandons la valeur de la variable `datadir`. Vous devriez voir `/var/lib/mysql/` confirm√©.

---

V√©rifions aussi d'autres param√®tres importants :

**Ex√©cutez :**

```bash
sudo mariadb -e "SHOW VARIABLES LIKE 'socket';"
```

**Explication :**
Le socket est un fichier sp√©cial qui permet aux processus locaux de communiquer avec MariaDB sans passer par le r√©seau. C'est plus rapide et plus s√©curis√© pour les connexions locales.

---

## üë§ √âTAPE 7 : Cr√©ation d'un administrateur non-root

Pour des raisons de s√©curit√©, il est recommand√© de ne pas utiliser le compte root. Cr√©ons un utilisateur administrateur.

**Ex√©cutez d'abord cette commande pour entrer dans l'interpr√©teur MariaDB :**

```bash
sudo mariadb
```

**Explication :**
Le `sudo` nous permet de nous connecter en tant que root sans mot de passe. Vous devriez voir le prompt `MariaDB [(none)]>`.

---

Maintenant, dans l'interpr√©teur MariaDB, cr√©ons notre utilisateur :

**Ex√©cutez dans MariaDB :**

```sql
CREATE USER 'sysadmin'@'localhost' IDENTIFIED VIA unix_socket;
```

**Explication :**
Nous cr√©ons un utilisateur `sysadmin` qui peut se connecter seulement depuis `localhost` (la machine elle-m√™me). `IDENTIFIED VIA unix_socket` signifie qu'il utilisera l'authentification du syst√®me d'exploitation via le socket Unix.

---

Donnons-lui tous les privil√®ges :

**Ex√©cutez dans MariaDB :**

```sql
GRANT ALL PRIVILEGES ON *.* TO 'sysadmin'@'localhost' WITH GRANT OPTION;
```

**Explication :**
`GRANT ALL PRIVILEGES` donne tous les droits. `ON *.*` signifie sur toutes les bases de donn√©es et toutes les tables. `WITH GRANT OPTION` permet √† cet utilisateur de donner ses droits √† d'autres.

---

N'oublions pas d'appliquer les changements :

**Ex√©cutez dans MariaDB :**

```sql
FLUSH PRIVILEGES;
```

**Explication :**
`FLUSH PRIVILEGES` recharge les tables de privil√®ges en m√©moire. Sans cette commande, les changements ne seraient effectifs qu'apr√®s un red√©marrage de MariaDB.

---

V√©rifions que notre utilisateur a √©t√© cr√©√© :

**Ex√©cutez dans MariaDB :**

```sql
SELECT user, host, plugin FROM mysql.user WHERE user = 'sysadmin';
```

**Explication :**
Nous interrogeons la table `user` de la base `mysql` (qui g√®re les utilisateurs). Vous devriez voir `sysadmin` avec le plugin `unix_socket`.

---

Quittons l'interpr√©teur :

**Ex√©cutez dans MariaDB :**

```sql
EXIT;
```

**Explication :**
`EXIT` ou `\q` ou `quit` permettent tous de quitter l'interpr√©teur MariaDB.

---

## üîç √âTAPE 8 : Test du nouvel utilisateur

Testons maintenant notre nouvel utilisateur :

**Ex√©cutez :**

```bash
sudo -u $USER mariadb -u sysadmin
```

**Explication :**
`sudo -u $USER` ex√©cute la commande en tant qu'utilisateur normal (pas root). `mariadb -u sysadmin` se connecte avec l'utilisateur `sysadmin`. Comme nous avons utilis√© l'authentification socket, aucun mot de passe n'est demand√©.

---

Dans le nouvel interpr√©teur, v√©rifions nos permissions :

**Ex√©cutez dans MariaDB :**

```sql
SELECT user(), current_user();
```

**Explication :**
`user()` montre l'utilisateur utilis√© pour la connexion, `current_user()` montre l'utilisateur avec lequel MariaDB nous a authentifi√©. Ils devraient √™tre identiques.

---

Testons nos privil√®ges en cr√©ant une base de test :

**Ex√©cutez dans MariaDB :**

```sql
CREATE DATABASE test_privileges;
```

**Explication :**
Si vous ne voyez pas d'erreur, c'est que vous avez bien les permissions de cr√©er une base de donn√©es.

---

Entrons dans cette base :

**Ex√©cutez dans MariaDB :**

```sql
USE test_privileges;
```

**Explication :**
`USE` change le contexte de travail. Maintenant toutes les commandes s'appliqueront √† la base `test_privileges`.

---

Cr√©ons une table simple :

**Ex√©cutez dans MariaDB :**

```sql
CREATE TABLE test (id INT, name VARCHAR(50));
```

**Explication :**
Nous cr√©ons une table avec deux colonnes : `id` (nombre entier) et `name` (cha√Æne de 50 caract√®res maximum).

---

Ins√©rons des donn√©es :

**Ex√©cutez dans MariaDB :**

```sql
INSERT INTO test VALUES (1, 'Premier test');
```

**Explication :**
`INSERT INTO` ajoute une ligne dans la table avec les valeurs sp√©cifi√©es.

---

Lisons les donn√©es :

**Ex√©cutez dans MariaDB :**

```sql
SELECT * FROM test;
```

**Explication :**
`SELECT *` s√©lectionne toutes les colonnes, `FROM test` sp√©cifie la table. Vous devriez voir la ligne que vous venez d'ins√©rer.

---

Nettoyons en supprimant la base de test :

**Ex√©cutez dans MariaDB :**

```sql
DROP DATABASE test_privileges;
```

**Explication :**
`DROP DATABASE` supprime compl√®tement la base de donn√©es et toutes ses tables. Soyez prudent avec cette commande en production !

---

Quittons l'interpr√©teur :

**Ex√©cutez dans MariaDB :**

```sql
EXIT;
```

---

## üìã √âTAPE 9 : Exploration des bases syst√®me

Reconnectons-nous pour explorer les bases syst√®me :

**Ex√©cutez :**

```bash
sudo mariadb -u root
```

---

Listons toutes les bases de donn√©es :

**Ex√©cutez dans MariaDB :**

```sql
SHOW DATABASES;
```

**Explication :**
Vous verrez plusieurs bases dont `mysql`, `information_schema`, `performance_schema`. Ce sont des bases syst√®me utilis√©es par MariaDB pour son fonctionnement interne.

---

Examinons la base `mysql` :

**Ex√©cutez dans MariaDB :**

```sql
USE mysql;
SHOW TABLES;
```

**Explication :**
La base `mysql` contient les tables de gestion des utilisateurs, des privil√®ges, et d'autres m√©tadonn√©es syst√®me. Chaque table a un r√¥le sp√©cifique.

---

Regardons la table `user` :

**Ex√©cutez dans MariaDB :**

```sql
DESCRIBE user;
```

**Explication :**
`DESCRIBE` montre la structure d'une table : les colonnes, leurs types, si elles peuvent √™tre nulles, etc. Vous verrez de nombreuses colonnes comme `User`, `Host`, `Password`, et divers privil√®ges.

---

Voyons quels utilisateurs existent :

**Ex√©cutez dans MariaDB :**

```sql
SELECT User, Host FROM user ORDER BY User;
```

**Explication :**
Cette requ√™te s√©lectionne seulement les colonnes `User` et `Host` de la table `user`, tri√©es par nom d'utilisateur. Vous verrez `root`, votre `sysadmin`, et peut-√™tre d'autres.

---

Explorons maintenant `information_schema` :

**Ex√©cutez dans MariaDB :**

```sql
USE information_schema;
SELECT table_name, table_comment FROM tables WHERE table_schema = 'information_schema' LIMIT 10;
```

**Explication :**
`information_schema` est une base de donn√©es virtuelle qui fournit des m√©tadonn√©es sur toutes les autres bases. C'est tr√®s utile pour l'administration.

---

Quittons l'interpr√©teur :

**Ex√©cutez dans MariaDB :**

```sql
EXIT;
```

---

## üó∫Ô∏è √âTAPE 10 : D√©couverte des fichiers de journaux

Voyons o√π MariaDB stocke ses journaux :

**Ex√©cutez :**

```bash
sudo ls -la /var/log/mysql/ 2>/dev/null || echo "Dossier non trouv√©, cherchons ailleurs..."
```

**Explication :**
`2>/dev/null` redirige les erreurs vers le n√©ant (pour √©viter les messages si le dossier n'existe pas). `||` signifie "ou alors" - si la premi√®re commande √©choue, ex√©cute la seconde.

---

Cherchons les fichiers de log ailleurs :

**Ex√©cutez :**

```bash
sudo find /var/log -name "*mariadb*" -o -name "*mysql*" 2>/dev/null
```

**Explication :**
Nous cherchons dans `/var/log` tous les fichiers dont le nom contient "mariadb" ou (`-o`) "mysql".

---

Si nous trouvons un dossier, examinons son contenu :

**Ex√©cutez (si vous avez trouv√© /var/log/mysql/) :**

```bash
sudo ls -la /var/log/mysql/
```

---

Voyons la fin du journal d'erreurs (s'il existe) :

**Ex√©cutez :**

```bash
sudo tail -10 /var/log/mysql/error.log 2>/dev/null || echo "Fichier non trouv√©"
```

**Explication :**
`tail -10` montre les 10 derni√®res lignes d'un fichier. C'est utile pour voir les erreurs r√©centes.

---

## ‚öôÔ∏è √âTAPE 11 : V√©rification de la configuration des journaux

Voyons comment les journaux sont configur√©s :

**Ex√©cutez :**

```bash
sudo mariadb -e "SHOW VARIABLES LIKE '%log%';" | grep -E "(log_error|slow_query_log|general_log)"
```

**Explication :**
Nous cherchons les variables qui contiennent "log" et filtrons pour ne garder que celles concernant les journaux d'erreurs, les requ√™tes lentes et le journal g√©n√©ral.

---

Si le journal des requ√™tes lentes est activ√©, v√©rifions son emplacement :

**Ex√©cutez :**

```bash
sudo mariadb -e "SHOW VARIABLES LIKE 'slow_query_log_file';"
```

**Explication :**
Cette variable nous dit o√π sont enregistr√©es les requ√™tes qui prennent plus de temps que `long_query_time` secondes.

---

## üîÑ √âTAPE 12 : Red√©marrage et v√©rification du service

Voyons comment MariaDB fonctionne comme service syst√®me :

**Ex√©cutez :**

```bash
sudo systemctl status mariadb
```

**Explication :**
`systemctl status` montre l'√©tat d'un service syst√®me. Vous verrez si MariaDB est en cours d'ex√©cution, depuis combien de temps, et les derniers messages du journal.

---

Si vous voulez voir plus de d√©tails :

**Ex√©cutez :**

```bash
sudo systemctl status mariadb --no-pager
```

**Explication :**
`--no-pager` d√©sactive la pagination - tout le contenu s'affiche d'un coup.

---

Essayons de red√©marrer le service pour voir le processus :

**Ex√©cutez :**

```bash
sudo systemctl restart mariadb
```

**Explication :**
`restart` arr√™te puis relance le service. C'est n√©cessaire apr√®s certaines modifications de configuration.

---

V√©rifions qu'il est bien reparti :

**Ex√©cutez :**

```bash
sudo systemctl is-active mariadb
```

**Explication :**
`is-active` retourne simplement "active" si le service fonctionne, ou "inactive" sinon.

---

## üìä √âTAPE 13 : Analyse des performances de base

Connectons-nous pour voir quelques m√©triques :

**Ex√©cutez :**

```bash
sudo mariadb -u root
```

---

Voyons les connexions actives :

**Ex√©cutez dans MariaDB :**

```sql
SHOW PROCESSLIST;
```

**Explication :**
Cette commande montre toutes les connexions actives √† MariaDB, avec ce qu'elles sont en train de faire. C'est utile pour diagnostiquer des probl√®mes de performance.

---

V√©rifions l'utilisation m√©moire :

**Ex√©cutez dans MariaDB :**

```sql
SHOW VARIABLES LIKE 'innodb_buffer_pool_size';
```

**Explication :**
Le buffer pool InnoDB est la m√©moire utilis√©e pour cacher les donn√©es et index. C'est l'un des param√®tres de performance les plus importants.

---

Voyons quelques statistiques :

**Ex√©cutez dans MariaDB :**

```sql
SHOW STATUS LIKE 'Innodb_buffer_pool_pages%';
```

**Explication :**
Ces statistiques nous montrent comment le buffer pool est utilis√© : combien de pages sont libres, sales (modifi√©es mais pas encore √©crites sur disque), etc.

---

Quittons l'interpr√©teur :

**Ex√©cutez dans MariaDB :**

```sql
EXIT;
```

---

## üéØ √âTAPE 14 : Cr√©ation d'un script de diagnostic rapide

Cr√©ons un script utile pour l'avenir :

**Ex√©cutez :**

```bash
cat > ~/check_mariadb.sh << 'EOF'
#!/bin/bash
echo "=== V√©rification rapide MariaDB ==="
echo "Date: $(date)"
echo ""
echo "1. Service status:"
sudo systemctl is-active mariadb
echo ""
echo "2. Derni√®res erreurs:"
sudo tail -5 /var/log/mysql/error.log 2>/dev/null || echo "Log non trouv√©"
echo ""
echo "3. Connexions actives:"
sudo mariadb -e "SHOW PROCESSLIST;" | wc -l | xargs echo "Nombre: "
echo ""
echo "=== Fin de la v√©rification ==="
EOF
```

**Explication :**
Nous cr√©ons un script bash qui rassemble plusieurs v√©rifications utiles. `<< 'EOF'` est un "here-doc" qui permet de cr√©er un fichier avec du contenu multiligne.

---

Rendons-le ex√©cutable :

**Ex√©cutez :**

```bash
chmod +x ~/check_mariadb.sh
```

**Explication :**
`chmod +x` ajoute le permission d'ex√©cution au fichier.

---

Testons notre script :

**Ex√©cutez :**

```bash
./check_mariadb.sh
```

---

## üìù √âTAPE 15 : Cr√©ation d'un fichier de notes personnelles

Cr√©ons un fichier pour garder une trace de ce que nous avons appris :

**notes_mariadb.md**

```bash
# Mes notes MariaDB

## Emplacements importants
- Binaires: /usr/bin/mariadb, /usr/bin/mysql
- Configuration: /etc/mysql/
- Donn√©es: /var/lib/mysql/
- Journaux: /var/log/mysql/

## Commandes utiles
- Connexion: sudo mariadb, mariadb -u utilisateur
- Voir les bases: SHOW DATABASES;
- Voir les tables: SHOW TABLES;
- Voir les utilisateurs: SELECT User, Host FROM mysql.user;

## Mon utilisateur admin
- Nom: sysadmin
- M√©thode d'authentification: unix_socket
- Cr√©√© avec: CREATE USER 'sysadmin'@'localhost' IDENTIFIED VIA unix_socket;

## Prochaines √©tapes √† explorer
1. Configuration avanc√©e dans 50-server.cnf
2. Gestion des sauvegardes avec mysqldump
3. Surveillance des performances
4. R√©plication MariaDB
```

---

## üéâ CONCLUSION

Vous avez maintenant explor√© les bases de MariaDB en tant qu'administrateur syst√®me. Vous savez :

1. O√π se trouvent les fichiers importants
2. Comment cr√©er un administrateur non-root
3. Comment v√©rifier l'√©tat du service
4. O√π sont les journaux
5. Comment explorer les bases syst√®me

Pour continuer votre exploration, vous pouvez :

1. Examiner en d√©tail le fichier `/etc/mysql/mariadb.conf.d/50-server.cnf`
2. Tester diff√©rentes m√©thodes d'authentification
3. Explorer les outils comme `mysqldump` et `mysqlcheck`
4. Configurer la journalisation avanc√©e

N'h√©sitez pas √† revenir sur ces √©tapes et √† exp√©rimenter par vous-m√™me. Chaque syst√®me peut avoir ses particularit√©s, et c'est en pratiquant que vous deviendrez √† l'aise avec MariaDB.
