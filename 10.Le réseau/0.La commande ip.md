# Niveau 1 â€” Fondamentaux et bases pratiques (Debian)

## Notion principale : Interfaces rÃ©seau & configuration IP (statique/dynamique)

> Objectif : savoir inventorier les interfaces, tester lâ€™Ã©tat Â« up/down Â», attribuer une IP temporaire, configurer une IP statique **persistante**, basculer en **DHCP**, vÃ©rifier **passerelle** et **DNS**, et dÃ©panner les cas courants.

---

### DÃ©mo 1 â€” Inventorier les interfaces et leur Ã©tat

**Pourquoi** : avant toute action, savoir Â« ce quâ€™il y a Â» et lâ€™Ã©tat de chaque lien.

**Commande (introduite)** : `ip link` (outil moderne qui remplace `ifconfig`).

**Ã‰tapes**

1. Lister les interfaces

```bash
ip link show
```

**RÃ©sultat attendu** : une liste `1: lo: ...` (boucle locale), `2: enp0s3: ...` (ou `enp0s3`/`ens33` selon la machine), avec `state UP` ou `state DOWN`.

2. Voir une interface prÃ©cise

```bash
ip link show dev enp0s3
```

**RÃ©sultat attendu** : ligne unique de lâ€™interface, avec son Ã©tat (UP/DOWN) et son adresse MAC.

---

### DÃ©mo 2 â€” Mettre une interface Â« down Â», la remonterâ€¦ et gÃ©rer le **piÃ¨ge SSH** proprement

**Pourquoi** : comprendre lâ€™impact de `up/down` et **Ã©viter de se couper** lors dâ€™une session distante.

**Commandes (introduites)** : `ip link set dev â€¦ up|down`, `sleep`, exÃ©cution en arriÃ¨re-plan.

**Ã‰tapes (sÃ©curisÃ©es)**

> Faites ceci **depuis la console locale** ou, si vous Ãªtes en SSH, **programmez la remontÃ©e automatique** avant de couper :

1. Programmer la remontÃ©e automatique dans 10 s (sÃ©curitÃ©) :

```bash
(sh -c 'sleep 10; sudo ip link set dev enp0s3 up') &
```

2. **Simuler le piÃ¨ge** : couper lâ€™interface rÃ©seau active :

```bash
sudo ip link set dev enp0s3 down
```

**RÃ©sultat attendu** : si vous Ãªtes en SSH, la session se coupe (perte rÃ©seau). Au bout dâ€™environ 10 s, lâ€™interface remonte et lâ€™accÃ¨s redevient possible.  
**Solution si besoin** : accÃ¨s console locale â†’ `sudo ip link set dev enp0s3 up`.

> Cette dÃ©mo **met en scÃ¨ne** le piÃ¨ge et fournit **la parade automatisÃ©e**.

---

### DÃ©mo 3 â€” Attribuer une **IP temporaire** (non persistante) et tester la connectivitÃ©

**Pourquoi** : valider rapidement une config sans toucher aux fichiers systÃ¨me.

**Commandes (introduites)** : `ip addr add/del`, `ip addr show`, `ping`.

**Ã‰tapes**

1. Ajouter une IP temporaire sur `enp0s3`

```bash
sudo ip addr add 192.168.1.100/24 dev enp0s3
```

2. VÃ©rifier

```bash
ip addr show dev enp0s3
```

**RÃ©sultat attendu** : on voit `inet 192.168.1.100/24` sur `enp0s3`.

3. Tester la passerelle locale (adaptez lâ€™IP)

```bash
ping -c 4 192.168.1.1
```

**RÃ©sultat attendu** : 4 rÃ©ponses `icmp_seq` avec `time=â€¦ ms`.

4. Nettoyer (retirer lâ€™IP temporaire)

```bash
sudo ip addr del 192.168.1.100/24 dev enp0s3
```

---

### DÃ©mo 4 â€” DÃ©finir/valider la **passerelle par dÃ©faut** (temporaire)

**Pourquoi** : sans passerelle valide, pas dâ€™Internet hors du sous-rÃ©seau.

**Commandes (introduites)** : `ip route add/del`, `ip route show`.

**Ã‰tapes**

1. Afficher la table de routage

```bash
ip route show
```

2. Ajouter une passerelle (adaptez)

```bash
sudo ip route add default via 192.168.1.1 dev enp0s3
```

3. Tester Internet (par IP dâ€™abord)

```bash
ping -c 3 8.8.8.8
```

**RÃ©sultat attendu** : rÃ©ponses OK.  
4) (Optionnel) Retirer la route par dÃ©faut (pour test)

```bash
sudo ip route del default
```

> **Astuce mise en dÃ©mo** : quand lâ€™IP vers Internet rÃ©pond (`8.8.8.8`) mais pas les noms de domaine, **le DNS** est en cause (voir DÃ©mo 7).

---

### ğŸ§ª DÃ©mo 5 â€” Configurer une **IP statique persistante** (Debian)

**Pourquoi** : rendre la configuration **durable** (redÃ©marrage/service).

**Fichiers/Services (introduits)** : `/etc/network/interfaces`, service `networking`.

**Ã‰tapes**

1. Ouvrir le fichier

```bash
sudo nano /etc/network/interfaces
```

2. Ajouter (exemple Ã  adapter au vÃ´tre)

```
auto enp0s3
ifacenp0s3h0 inet static
   address 192.168.1.100
   netmask 255.255.255.0
   gateway 192.168.1.1
```

3. Appliquer

```bash
sudo systemctl restart networking
```

4. VÃ©rifier

```bash
ip addr show dev enp0s3
ip route show
```

**RÃ©sultat attendu** : lâ€™IP et la route par dÃ©faut **persistent** (mÃªme aprÃ¨s reboot).

> **Conseil mis en scÃ¨ne** : avant de recharger, gardez **un accÃ¨s console** prÃªt (si erreur de conf, vous pouvez corriger le fichier).

---

### DÃ©mo 6 â€” Basculer en **DHCP** (IP dynamique) et valider le bail

**Pourquoi** : obtenir une IP automatiquement depuis un serveur DHCP.

**Commandes/Composants (introduits)** : `dhclient` (client DHCP), `/etc/network/interfaces`.

**Ã‰tapes**

1. Configurer lâ€™interface en DHCP

```bash
sudo nano /etc/network/interfaces
```

Remplacez le bloc par :

```
auto enp0s3
ifacenp0s3h0 inet dhcp
```

2. RedÃ©marrer le service rÃ©seau

```bash
sudo systemctl restart networking
```

3. (Optionnel) Forcer une requÃªte DHCP verbeuse

```bash
sudo dhclient -v enp0s3
```

4. VÃ©rifier lâ€™IP obtenue et la passerelle

```bash
ip addr show dev enp0s3
ip route show
```

**RÃ©sultat attendu** : une IP du pool DHCP + une route par dÃ©faut fournie par le serveur.

> **Mini-dÃ©mo dÃ©pannage** : si aucune IP nâ€™arrive, ouvrez les logs rÃ©cents rÃ©seau :

```bash
journalctl -u networking --since "5 min ago"
```

(et/ou `sudo tail -n 100 /var/log/syslog` selon votre configuration)

---

### DÃ©mo 7 â€” **DNS** : diagnostiquer Â« IP OK, noms KO Â» et corriger

**Pourquoi** : cas classique â†’ on pingue `8.8.8.8` mais `google.com` Ã©choue.

**Commandes/Fichiers (introduits)** : `ping`, `/etc/resolv.conf`.

**Ã‰tapes**

1. VÃ©rifier IP vs nom

```bash
ping -c 2 8.8.8.8
ping -c 2 google.com
```

**RÃ©sultat attendu** : le 1er passe, le 2e Ã©choue â†’ **DNS en cause**.  
2) Ouvrir/ajuster le DNS **temporairement**

```bash
sudo nano /etc/resolv.conf
```

Ajoutez une ligne (exemple) :

```
nameserver 8.8.8.8
```

3. Re-tester

```bash
ping -c 2 google.com
```

**RÃ©sultat attendu** : rÃ©solution OK.

> **Conseil** : la gestion de `resolv.conf` peut Ãªtre prise en charge par dâ€™autres composants (ex. `systemd-resolved`, `NetworkManager`). La mÃ©thode ci-dessus est **temporaire** ; pour du **persistant**, configurez le DNS dans la **strophe de lâ€™interface** (ex. via `dns-nameservers` quand vous utilisez `ifupdown`) ou via lâ€™outil rÃ©seau que vous utilisez.

---

## ğŸ§° Troubleshooting guidÃ© (mise en scÃ¨ne rapide)

1. **Plus de rÃ©seau aprÃ¨s changement dâ€™IP statique**
- **SymptÃ´me** : `ping 8.8.8.8` Ã©choue.

- **DÃ©marche** :
  
  - VÃ©rifiez lâ€™IP : `ip addr show dev enp0s3`
  
  - VÃ©rifiez la passerelle : `ip route show`
  
  - Si la passerelle manque â†’ `sudo ip route add default via 192.168.1.1 dev enp0s3` (adaptez)
  
  - Testez Ã  nouveau.
2. **SSH inaccessible aprÃ¨s restart rÃ©seau**
- **SymptÃ´me** : coupure SSH.

- **DÃ©marche** (prÃ©vention dÃ©montrÃ©e en DÃ©mo 2) : programmer `sleep 10; ip link set â€¦ up` **avant** de couper, ou passer par **console locale** pour remonter lâ€™interface.
3. **DHCP ne donne pas dâ€™IP**
- **SymptÃ´me** : `dhclient` tourne mais lâ€™IP reste absente.

- **DÃ©marche** :
  
  - Logs : `sudo dhclient -v enp0s3` (voir Ã©changes), `journalctl -u networking --since "10 min ago"`
  
  - CÃ¢blage/VLAN/port switch ? Interface **UP** ? `ip link show dev enp0s3`
  
  - Test en IP **statique temporaire** (DÃ©mo 3) pour isoler le problÃ¨me cÃ´tÃ© serveur DHCP.

---

## ğŸ“š RÃ©capitulatif â€” Commandes Debian du Niveau 1 (avec options utiles)

> (TriÃ©es par **frÃ©quence dâ€™usage** dans ce niveau, des plus courantes aux plus spÃ©cifiques.)

### `ip addr`

- `ip addr show` â€” afficher les adresses

- `ip addr show dev <if>` â€” filtrer une interface

- `ip addr add <IP/MASK> dev <if>` â€” **ajouter** une IP

- `ip addr del <IP/MASK> dev <if>` â€” **retirer** une IP

### `ip link`

- `ip link show` â€” lister les interfaces

- `ip link show dev <if>` â€” dÃ©tails dâ€™une interface

- `ip link set dev <if> up|down` â€” activer/dÃ©sactiver

- `ip link set dev <if> mtu <N>` â€” rÃ©gler la MTU (moins frÃ©quent, utile en cas de fragmentation)

### `ip route`

- `ip route show` â€” afficher la table de routage

- `ip route add default via <GW> dev <if>` â€” **dÃ©finir la passerelle**

- `ip route del default` â€” retirer la route par dÃ©faut

- `ip route add <CIDR> via <GW> dev <if>` â€” route spÃ©cifique (moins frÃ©quent)

### `ping`

- `ping <hÃ´te|IP>` â€” test basique

- `-c <n>` â€” nombre de paquets (frÃ©quent)

- `-i <sec>` â€” intervalle (utile pour tests prolongÃ©s)

- `-s <octets>` â€” taille du paquet (diagnostic MTU)

### `dhclient`

- `dhclient <if>` â€” demander un bail DHCP

- `-v` â€” verbeux (diagnostic)

- `-r <if>` â€” libÃ©rer le bail (moins frÃ©quent)

### Services/Logs (Debian)

- `systemctl restart networking` â€” appliquer la conf ifupdown

- `systemctl status networking` â€” statut du service

- `journalctl -u networking --since "5 min ago"` â€” logs rÃ©cents

- `sudo nano /etc/network/interfaces` â€” IP statique/DHCP persistants

- `sudo nano /etc/resolv.conf` â€” DNS **temporaire** (voir note DÃ©mo 7)
