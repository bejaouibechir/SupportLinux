# Intégrer une Debian dans un Active Directory



## Objectifs

- Comprendre le rôle d’**Active Directory** : annuaire LDAP + authentification Kerberos.

- Joindre une machine Debian au domaine AD.

- Permettre aux utilisateurs AD de se connecter sur la Debian.

- Vérifier et dépanner l’intégration.

- Nettoyer et revenir à l’état initial.

---

## Préparation

### Côté Active Directory (contrôleur de domaine Windows)

- Vous devez avoir un domaine existant, ex : **mon-domaine.local**

- Vérifiez que le serveur AD fournit :
  
  - **DNS** (résolution des machines du domaine)
  
  - **Kerberos** (port 88)
  
  - **LDAP** (port 389/636)

---

### Côté Debian

Vérifiez que la machine Debian utilise le **DNS du contrôleur AD** :

```bash
cat /etc/resolv.conf
```

Exemple attendu :

```
nameserver 192.168.1.10   # IP du contrôleur AD
search mon-domaine.local
```

---

## Installation des paquets nécessaires

```bash
sudo apt update
sudo apt install realmd sssd sssd-tools libnss-sss libpam-sss adcli samba-common-bin oddjob oddjob-mkhomedir packagekit -y
```

---

## Découverte du domaine

```bash
realm discover mon-domaine.local
```

✅ Doit afficher les infos du domaine (realm, serveur KDC, serveur LDAP).

---

## Joindre la machine au domaine

```bash
sudo realm join --user=Administrateur mon-domaine.local
```

- Le système demande le mot de passe de l’utilisateur AD “Administrateur”.

- Si tout est OK, Debian est ajouté comme **ordinateur membre du domaine**.

---

## Vérifications

### Vérifier l’intégration

```bash
realm list
```

✅ Doit afficher le domaine, le contrôleur AD et les options d’authentification.

### Vérifier Kerberos

```bash
kinit Administrateur@MON-DOMAINE.LOCAL
klist
```

✅ Doit afficher un **ticket Kerberos** valide.

### Vérifier un utilisateur du domaine

```bash
id utilisateur@mon-domaine.local
```

✅ Doit afficher les groupes AD de cet utilisateur.

---

## Configurer la création automatique des répertoires home

Éditer le fichier PAM :

```bash
sudo pam-auth-update
```

Activer : **Create home directory on login**.

---

## Tester la connexion

Déconnectez-vous et connectez-vous avec un utilisateur AD :

```bash
ssh utilisateur@mon-domaine.local@debian
```

✅ L’utilisateur AD doit pouvoir ouvrir une session.

---

## Nettoyage (rollback)

Si vous souhaitez retirer la machine du domaine :

```bash
sudo realm leave mon-domaine.local
```

Supprimer paquets liés si nécessaire :

```bash
sudo apt purge realmd sssd adcli samba-common-bin -y
sudo apt autoremove -y
```

Vérifiez que Debian n’est plus joint :

```bash
realm list
```

✅ Ne doit rien afficher.

-


