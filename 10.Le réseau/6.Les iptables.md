# Exercice 6 (version enrichie) : iptables

## Objectifs

1. MaÃ®triser lâ€™ajout et la suppression de rÃ¨gles.

2. Apprendre Ã  jongler entre diffÃ©rents types de filtres (ICMP, TCP, IP source).

3. Utiliser `iptables -F` pour remettre les compteurs Ã  zÃ©ro (astuce indispensable).

---

## Cas pratiques

### ğŸ”¹ 1. Bloquer et dÃ©bloquer le ping

Sur **Machine2** :

```bash
sudo iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
```

Depuis **Machine1** :

```bash
ping -c 4 10.10.10.2
```

ğŸ‘‰ RÃ©sultat : aucune rÃ©ponse.

**Restauration** :

```bash
sudo iptables -F
```

Testez Ã  nouveau â†’ le ping refonctionne âœ…

---

### ğŸ”¹ 2. Bloquer tout le trafic venant dâ€™une IP prÃ©cise

Sur **Machine2** :

```bash
sudo iptables -A INPUT -s 10.10.10.1 -j DROP
```

Depuis **Machine1** :

```bash
ping -c 4 10.10.10.2
```

ğŸ‘‰ RÃ©sultat : bloquÃ©, car lâ€™IP source est rejetÃ©e.

**Restauration** :

```bash
sudo iptables -F
```

---

### ğŸ”¹ 3. Autoriser seulement SSH et bloquer tout le reste

Sur **Machine2** :

```bash
sudo iptables -P INPUT DROP
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```

Depuis **Machine1** :

- **Ping** â†’ bloquÃ©.

- **SSH** (`ssh user@10.10.10.2`) â†’ passe.

**Restauration** :

```bash
sudo iptables -P INPUT ACCEPT
sudo iptables -F
```

---

### ğŸ”¹ 4. Bloquer un port spÃ©cifique (ex: HTTP/80)

Sur **Machine2** :

```bash
sudo iptables -A INPUT -p tcp --dport 80 -j REJECT
```

Depuis **Machine1** :

```bash
curl http://10.10.10.2
```

ğŸ‘‰ RÃ©sultat : connexion refusÃ©e.

**Restauration** :

```bash
sudo iptables -F
```

---

### ğŸ”¹ 5. Compter les paquets ICMP

Sur **Machine2** :

```bash
sudo iptables -A INPUT -p icmp -j ACCEPT
```

Puis, lancez un ping depuis Machine1 :

```bash
ping -c 4 10.10.10.2
```

Observez les compteurs :

```bash
sudo iptables -L -v -n
```

ğŸ‘‰ Vous verrez le nombre de paquets ICMP acceptÃ©s.

**Restauration** :

```bash
sudo iptables -F
```

---

# âœ… RÃ©sultats attendus

- Vous avez appris Ã  manipuler plusieurs scÃ©narios de filtrage.

- Vous savez utiliser `iptables -F` pour nettoyer rapidement et revenir Ã  zÃ©ro.

- Vous avez vu les options importantes :
  
  - `-A` (append, ajouter une rÃ¨gle)
  
  - `-D` (delete, supprimer une rÃ¨gle prÃ©cise)
  
  - `-P` (policy par dÃ©faut : ACCEPT/DROP)
  
  - `-L -v -n` (lister les rÃ¨gles en dÃ©tail)
  
  - `-F` (flush : astuce pour repartir de zÃ©ro ğŸ¯).
