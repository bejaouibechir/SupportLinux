# Exercice 6 (version enrichie) : iptables

## Objectifs

1. Maîtriser l’ajout et la suppression de règles.

2. Apprendre à jongler entre différents types de filtres (ICMP, TCP, IP source).

3. Utiliser `iptables -F` pour remettre les compteurs à zéro (astuce indispensable).

---

## Cas pratiques

### 🔹 1. Bloquer et débloquer le ping

Sur **Machine2** :

```bash
sudo iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
```

Depuis **Machine1** :

```bash
ping -c 4 10.10.10.2
```

👉 Résultat : aucune réponse.

**Restauration** :

```bash
sudo iptables -F
```

Testez à nouveau → le ping refonctionne ✅

---

### 🔹 2. Bloquer tout le trafic venant d’une IP précise

Sur **Machine2** :

```bash
sudo iptables -A INPUT -s 10.10.10.1 -j DROP
```

Depuis **Machine1** :

```bash
ping -c 4 10.10.10.2
```

👉 Résultat : bloqué, car l’IP source est rejetée.

**Restauration** :

```bash
sudo iptables -F
```

---

### 🔹 3. Autoriser seulement SSH et bloquer tout le reste

Sur **Machine2** :

```bash
sudo iptables -P INPUT DROP
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```

Depuis **Machine1** :

- **Ping** → bloqué.

- **SSH** (`ssh user@10.10.10.2`) → passe.

**Restauration** :

```bash
sudo iptables -P INPUT ACCEPT
sudo iptables -F
```

---

### 🔹 4. Bloquer un port spécifique (ex: HTTP/80)

Sur **Machine2** :

```bash
sudo iptables -A INPUT -p tcp --dport 80 -j REJECT
```

Depuis **Machine1** :

```bash
curl http://10.10.10.2
```

👉 Résultat : connexion refusée.

**Restauration** :

```bash
sudo iptables -F
```

---

### 🔹 5. Compter les paquets ICMP

Sur **Machine2** :

```bash
sudo iptables -A INPUT -p icmp -j ACCEPT
```

Puis, lancez un ping depuis Machine1 :

```bash
ping -c 4 10.10.10.2
```

Observez les compteurs :

```bash
sudo iptables -L -v -n
```

👉 Vous verrez le nombre de paquets ICMP acceptés.

**Restauration** :

```bash
sudo iptables -F
```

---

# ✅ Résultats attendus

- Vous avez appris à manipuler plusieurs scénarios de filtrage.

- Vous savez utiliser `iptables -F` pour nettoyer rapidement et revenir à zéro.

- Vous avez vu les options importantes :
  
  - `-A` (append, ajouter une règle)
  
  - `-D` (delete, supprimer une règle précise)
  
  - `-P` (policy par défaut : ACCEPT/DROP)
  
  - `-L -v -n` (lister les règles en détail)
  
  - `-F` (flush : astuce pour repartir de zéro 🎯).
