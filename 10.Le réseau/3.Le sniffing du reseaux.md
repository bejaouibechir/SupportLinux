# Exercice 2 : Network sniffing (tcpdump)

## Objectifs

1. Utiliser `tcpdump` pour capturer du trafic ICMP (ping) entre Machine1 et Machine2.

2. Comprendre comment filtrer les paquets selon le protocole ou l’adresse.

3. (optionnel) Exporter la capture et l’ouvrir dans Wireshark pour analyse graphique.

---

## Étapes à suivre

### 1. Installer tcpdump (si absent)

Sur chaque machine :

```bash
sudo apt update
sudo apt install tcpdump -y
```

---

### 2. Lancer une capture sur Machine1

```bash
sudo tcpdump -i enp0s8 icmp
```

- `-i enp0s8` → interface à écouter.

- `icmp` → filtre pour ne montrer que les paquets ICMP (ping).

👉 La commande affiche en temps réel les paquets ICMP capturés.

---

### 3. Générer du trafic depuis Machine2

Depuis Machine2, envoyez un ping vers Machine1 :

```bash
ping -c 4 10.10.10.1
```

👉 Pendant ce temps, regardez l’écran de Machine1 (où tourne tcpdump). Vous verrez défiler les lignes indiquant chaque requête et réponse ICMP.

---

### 4. Capturer vers un fichier (optionnel)

Toujours sur Machine1 :

```bash
sudo tcpdump -i enp0s8 -w ping_capture.pcap
```

Puis générez du trafic (ping).  
Ensuite, stoppez avec `Ctrl+C`.  
Le fichier `ping_capture.pcap` pourra être ouvert avec Wireshark :

```bash
wireshark ping_capture.pcap
```

---

### 5. Filtrages supplémentaires (bonus)

- Capturer seulement les paquets en provenance de Machine2 :
  
  ```bash
  sudo tcpdump -i enp0s8 src host 10.10.10.2
  ```

- Capturer tout le trafic TCP port 22 (SSH) :
  
  ```bash
  sudo tcpdump -i enp0s8 tcp port 22
  ```

---

# ✅ Résultat attendu

- Avec `ping`, `tcpdump` montre bien les requêtes **ICMP echo request** et les réponses **ICMP echo reply**.

- En exportant avec `-w`, vous pouvez relire la capture avec Wireshark et observer les en-têtes IP et ICMP.

- Vous savez filtrer le trafic par protocole (`icmp`), par hôte (`src host …`) ou par port (`tcp port …`).

Parfait 👍 On enrichit donc **l’Exercice 2 – Network sniffing** avec un **complément comparatif** entre `tcpdump` et `ip monitor`.  
Cela permet de bien ancrer la différence de philosophie entre **capture de paquets** et **surveillance d’événements système**.

---

# tcpdump vs ip monitor

## Objectif du complément

Montrer, à travers un même scénario simple (ping), que :

- `tcpdump` affiche les **paquets échangés** entre les machines.

- `ip monitor` affiche les **événements système internes** (ajout/suppression d’adresses, routes, changements d’état d’interface).

---

## Étapes pratiques

### 1. Préparer une capture avec tcpdump

Sur **Machine1**, dans un terminal :

```bash
sudo tcpdump -i enp0s8 icmp
```

Laissez tourner.

---

### 2. Préparer une surveillance avec ip monitor

Ouvrez un **deuxième terminal** sur la même Machine1 et tapez :

```bash
ip monitor address
```

Puis dans un autre :

```bash
ip monitor route
```

👉 Ces deux commandes vont “écouter” les changements système en direct.

---

### 3. Générer du trafic (ping)

Depuis **Machine2** :

```bash
ping -c 4 10.10.10.1
```

👉 Observez les sorties :

- **tcpdump** : affiche **chaque paquet ICMP** (request/reply).

- **ip monitor** : ne montre **rien**, car le ping ne modifie ni adresse ni route.

---

### 4. Provoquer un événement réseau

Toujours sur Machine1, ajoutez une nouvelle IP sur `enp0s8` :

```bash
sudo ip addr add 10.10.10.100/24 dev enp0s8
```

👉 Observez :

- **tcpdump** : pas d’affichage (car aucun paquet généré).

- **ip monitor address** : affiche immédiatement l’ajout de `10.10.10.100/24`.

Puis supprimez-la :

```bash
sudo ip addr del 10.10.10.100/24 dev enp0s8
```

Vous verrez la suppression dans `ip monitor address`.

---

## ✅ Résultat attendu

- **tcpdump** réagit uniquement au **trafic circulant** (ping = paquets ICMP).

- **ip monitor** réagit uniquement aux **changements de configuration** (ajout/suppression IP, routes, interface up/down).

- Les deux outils sont complémentaires :
  
  - `tcpdump` pour analyser la communication réseau,
  
  - `ip monitor` pour diagnostiquer la dynamique de configuration système.
