# Exercice 2 : Network sniffing (tcpdump)

## Objectifs

1. Utiliser `tcpdump` pour capturer du trafic ICMP (ping) entre Machine1 et Machine2.

2. Comprendre comment filtrer les paquets selon le protocole ou lâ€™adresse.

3. (optionnel) Exporter la capture et lâ€™ouvrir dans Wireshark pour analyse graphique.

---

## Ã‰tapes Ã  suivre

### 1. Installer tcpdump (si absent)

Sur chaque machine :

```bash
sudo apt update
sudo apt install tcpdump -y
```

---

### 2. Lancer une capture sur Machine1

```bash
sudo tcpdump -i enp0s8 icmp
```

- `-i enp0s8` â†’ interface Ã  Ã©couter.

- `icmp` â†’ filtre pour ne montrer que les paquets ICMP (ping).

ğŸ‘‰ La commande affiche en temps rÃ©el les paquets ICMP capturÃ©s.

---

### 3. GÃ©nÃ©rer du trafic depuis Machine2

Depuis Machine2, envoyez un ping vers Machine1 :

```bash
ping -c 4 10.10.10.1
```

ğŸ‘‰ Pendant ce temps, regardez lâ€™Ã©cran de Machine1 (oÃ¹ tourne tcpdump). Vous verrez dÃ©filer les lignes indiquant chaque requÃªte et rÃ©ponse ICMP.

---

### 4. Capturer vers un fichier (optionnel)

Toujours sur Machine1 :

```bash
sudo tcpdump -i enp0s8 -w ping_capture.pcap
```

Puis gÃ©nÃ©rez du trafic (ping).  
Ensuite, stoppez avec `Ctrl+C`.  
Le fichier `ping_capture.pcap` pourra Ãªtre ouvert avec Wireshark :

```bash
wireshark ping_capture.pcap
```

---

### 5. Filtrages supplÃ©mentaires (bonus)

- Capturer seulement les paquets en provenance de Machine2 :
  
  ```bash
  sudo tcpdump -i enp0s8 src host 10.10.10.2
  ```

- Capturer tout le trafic TCP port 22 (SSH) :
  
  ```bash
  sudo tcpdump -i enp0s8 tcp port 22
  ```

---

# âœ… RÃ©sultat attendu

- Avec `ping`, `tcpdump` montre bien les requÃªtes **ICMP echo request** et les rÃ©ponses **ICMP echo reply**.

- En exportant avec `-w`, vous pouvez relire la capture avec Wireshark et observer les en-tÃªtes IP et ICMP.

- Vous savez filtrer le trafic par protocole (`icmp`), par hÃ´te (`src host â€¦`) ou par port (`tcp port â€¦`).

Parfait ğŸ‘ On enrichit donc **lâ€™Exercice 2 â€“ Network sniffing** avec un **complÃ©ment comparatif** entre `tcpdump` et `ip monitor`.  
Cela permet de bien ancrer la diffÃ©rence de philosophie entre **capture de paquets** et **surveillance dâ€™Ã©vÃ©nements systÃ¨me**.

---

# tcpdump vs ip monitor

## Objectif du complÃ©ment

Montrer, Ã  travers un mÃªme scÃ©nario simple (ping), que :

- `tcpdump` affiche les **paquets Ã©changÃ©s** entre les machines.

- `ip monitor` affiche les **Ã©vÃ©nements systÃ¨me internes** (ajout/suppression dâ€™adresses, routes, changements dâ€™Ã©tat dâ€™interface).

---

## Ã‰tapes pratiques

### 1. PrÃ©parer une capture avec tcpdump

Sur **Machine1**, dans un terminal :

```bash
sudo tcpdump -i enp0s8 icmp
```

Laissez tourner.

---

### 2. PrÃ©parer une surveillance avec ip monitor

Ouvrez un **deuxiÃ¨me terminal** sur la mÃªme Machine1 et tapez :

```bash
ip monitor address
```

Puis dans un autre :

```bash
ip monitor route
```

ğŸ‘‰ Ces deux commandes vont â€œÃ©couterâ€ les changements systÃ¨me en direct.

---

### 3. GÃ©nÃ©rer du trafic (ping)

Depuis **Machine2** :

```bash
ping -c 4 10.10.10.1
```

ğŸ‘‰ Observez les sorties :

- **tcpdump** : affiche **chaque paquet ICMP** (request/reply).

- **ip monitor** : ne montre **rien**, car le ping ne modifie ni adresse ni route.

---

### 4. Provoquer un Ã©vÃ©nement rÃ©seau

Toujours sur Machine1, ajoutez une nouvelle IP sur `enp0s8` :

```bash
sudo ip addr add 10.10.10.100/24 dev enp0s8
```

ğŸ‘‰ Observez :

- **tcpdump** : pas dâ€™affichage (car aucun paquet gÃ©nÃ©rÃ©).

- **ip monitor address** : affiche immÃ©diatement lâ€™ajout de `10.10.10.100/24`.

Puis supprimez-la :

```bash
sudo ip addr del 10.10.10.100/24 dev enp0s8
```

Vous verrez la suppression dans `ip monitor address`.

---

## âœ… RÃ©sultat attendu

- **tcpdump** rÃ©agit uniquement au **trafic circulant** (ping = paquets ICMP).

- **ip monitor** rÃ©agit uniquement aux **changements de configuration** (ajout/suppression IP, routes, interface up/down).

- Les deux outils sont complÃ©mentaires :
  
  - `tcpdump` pour analyser la communication rÃ©seau,
  
  - `ip monitor` pour diagnostiquer la dynamique de configuration systÃ¨me.
