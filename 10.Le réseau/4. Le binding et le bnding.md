

# Exercice 3 Binding et Bonding

## Objectifs

1. Ajouter deux interfaces r√©seau VirtualBox pour le lab (ne pas toucher `enp0s3`).

2. Configurer un bond (`bond0`) entre `enp0s8` et `enp0s9`.

3. Tester la redondance (active-backup).

4. Restaurer la configuration initiale.

---

# Binding

## Pr√©sentation

Le **binding** consiste √† *lier* une application ou un service r√©seau √† une **interface sp√©cifique** ou √† une **adresse IP pr√©cise** d‚Äôune machine.



# Bonding

## Pr√©sentation

Le **bonding** (aussi appel√© *NIC teaming*) consiste √† regrouper plusieurs interfaces r√©seau physiques pour en cr√©er **une seule interface logique** (`bond0`).

## √Ä quoi √ßa sert ?

1. **Tol√©rance de panne (HA)**
   
   - Mode *active-backup* : si une carte tombe, une autre prend le relais sans interruption.

2. **Agr√©gation de bande passante (load balancing)**
   
   - Mode *balance-rr*, *802.3ad (LACP)* : r√©partir le trafic sur plusieurs cartes pour augmenter le d√©bit.

3. **Simplicit√© d‚Äôadministration**
   
   - Une seule IP √† g√©rer, m√™me si plusieurs cartes sont pr√©sentes.

## √âtapes pratiques

### 1. Ajouter les interfaces VirtualBox

- √âteignez vos deux VMs.

- Dans VirtualBox ‚Üí **Param√®tres** ‚Üí **R√©seau**.

- Ajoutez :
  
  - **Adaptateur 2** : mode *Internal Network* (nom : `labnet`).
  
  - **Adaptateur 3** : mode *Internal Network* (m√™me nom : `labnet`).

- Red√©marrez vos VMs.  
  üëâ Elles verront maintenant `enp0s8` et `enp0s9` en plus de `enp0s3`.

---

### 2. Installer bonding et ifenslave

Sur chaque VM :

```bash
sudo apt update
sudo apt install ifenslave -y
sudo modprobe bonding
```

---

### 3. Configurer le bond (Machine1)

√âditez `/etc/network/interfaces` :

```ini
# Boucle locale
auto lo
iface lo inet loopback

# Interface principale (ne pas toucher)
auto enp0s3
iface enp0s3 inet dhcp

# Bonding
auto bond0
iface bond0 inet static
    address 10.20.20.1
    netmask 255.255.255.0
    bond-slaves enp0s8 enp0s9
    bond-mode active-backup
    bond-miimon 100
```

---

### 4. Configurer le bond (Machine2)

```ini
# Boucle locale
auto lo
iface lo inet loopback

# Interface principale (ne pas toucher)
auto enp0s3
iface enp0s3 inet dhcp

# Bonding
auto bond0
iface bond0 inet static
    address 10.20.20.2
    netmask 255.255.255.0
    bond-slaves enp0s8 enp0s9
    bond-mode active-backup
    bond-miimon 100
```

---

### 5. Red√©marrer le r√©seau

```bash
sudo systemctl restart networking
```

V√©rifier :

```bash
ip -brief addr show bond0
```

üëâ Vous devez voir `10.20.20.1` et `10.20.20.2`.

---

### 6. Tester la connectivit√©

Depuis Machine1 :

```bash
ping -c 4 10.20.20.2
```

Ensuite, d√©sactivez `enp0s8` :

```bash
sudo ip link set enp0s8 down
ping -c 4 10.20.20.2
```

üëâ Le ping doit toujours passer via `enp0s9`.

---

### 7. Restaurer le syst√®me (rollback)

Une fois la d√©mo finie, restaurez `/etc/network/interfaces` comme suit :

**Machine1 et Machine2 (√©tat initial) :**

```ini
# Boucle locale
auto lo
iface lo inet loopback

# Interface principale pour SSH/Internet
auto enp0s3
iface enp0s3 inet dhcp

# Interface labo (Lab0)
auto enp0s8
iface enp0s8 inet static
    address 10.10.10.1   # Machine1
    netmask 255.255.255.0

# Pour Machine2, adaptez l‚Äôadresse :
# address 10.10.10.2
```

Puis :

```bash
sudo systemctl restart networking
```

---

# ‚úÖ R√©sultat attendu

- Le bond (`bond0`) fonctionne sur les deux interfaces de labo.

- Votre connexion SSH via `enp0s3` **reste intacte**.

- Apr√®s rollback, retour √† la config **Lab0 stable**.


