

# Atelier : Manipulation des VLAN sous Debian

---

## Objectifs

- Comprendre la logique VLAN (IEEE 802.1Q).

- Cr√©er des VLAN virtuels sur les interfaces `enp0s8` de vos deux machines.

- V√©rifier la communication intra-VLAN.

- Bloquer la communication inter-VLAN (isolation).

- Nettoyer et revenir √† l‚Äô√©tat initial.

---

## Pr√©paration

### Installation du paquet VLAN

Sur les deux machines Debian :

```bash
sudo apt update
sudo apt install vlan -y
```

Activer le module kernel 802.1Q :

```bash
sudo modprobe 8021q
```

V√©rifier :

```bash
lsmod | grep 8021q
```

---

## Cr√©ation de VLAN sur les interfaces

Nous allons cr√©er **deux VLAN** (10 et 20) sur les deux machines.

- VLAN 10 ‚Üí r√©seau `10.10.10.x/24`

- VLAN 20 ‚Üí r√©seau `10.20.20.x/24`

---

### Sur Machine 1

Cr√©er VLAN 10 et 20 sur `enp0s8` :

```bash
sudo ip link add link enp0s8 name enp0s8.10 type vlan id 10
sudo ip link add link enp0s8 name enp0s8.20 type vlan id 20
```

Attribuer adresses IP :

```bash
sudo ip addr add 10.10.10.1/24 dev enp0s8.10
sudo ip addr add 10.20.20.1/24 dev enp0s8.20
```

Activer :

```bash
sudo ip link set enp0s8.10 up
sudo ip link set enp0s8.20 up
```

---

### Sur Machine 2

Cr√©er VLAN 10 et 20 :

```bash
sudo ip link add link enp0s8 name enp0s8.10 type vlan id 10
sudo ip link add link enp0s8 name enp0s8.20 type vlan id 20
```

Attribuer adresses IP :

```bash
sudo ip addr add 10.10.10.2/24 dev enp0s8.10
sudo ip addr add 10.20.20.2/24 dev enp0s8.20
```

Activer :

```bash
sudo ip link set enp0s8.10 up
sudo ip link set enp0s8.20 up
```

---

## V√©rifications

### VLAN 10

Depuis Machine 1 :

```bash
ping -c 3 10.10.10.2
```

‚úÖ Doit r√©pondre ‚Üí communication VLAN 10 OK.

### VLAN 20

Depuis Machine 1 :

```bash
ping -c 3 10.20.20.2
```

‚úÖ Doit r√©pondre ‚Üí communication VLAN 20 OK.

### Isolation

Depuis Machine 1 VLAN 10, essayez de pinger VLAN 20 de Machine 2 :

```bash
ping -c 3 10.20.20.2 -I enp0s8.10
```

‚ö†Ô∏è R√©sultat attendu : **pas de r√©ponse**, car VLANs sont isol√©s.

---

## Option : Ajouter une 3e carte VirtualBox

üëâ Si vous voulez simuler un **routeur inter-VLAN** (qui connecte VLAN 10 et VLAN 20), ajoutez une **3e carte r√©seau** √† une machine et configurez `iptables` ou `nftables` pour router entre les VLAN.  
(utile si vous voulez montrer que seuls les routeurs/switchs de niveau 3 permettent la communication inter-VLAN).

---

## Nettoyage (rollback)

Sur **les deux machines** :

```bash
sudo ip link delete enp0s8.10
sudo ip link delete enp0s8.20
```

V√©rifier :

```bash
ip link show
```

‚úÖ Les interfaces VLAN ne doivent plus appara√Ætre.

Votre config initiale (`enp0s3` pour MobaXterm et `enp0s8` en 10.10.10.x) est intacte.


