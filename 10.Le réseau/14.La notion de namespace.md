# Atelier â€“ Isolation rÃ©seau avec Namespaces

## 1. Contexte & objectif

Un **network namespace** est un mÃ©canisme du noyau Linux permettant dâ€™isoler complÃ¨tement une pile rÃ©seau :



- Par dÃ©faut, deux namespaces ne communiquent pas entre eux, sauf si on configure des **veth pairs** et/ou un **bridge**.

- 

ğŸ‘‰ Lâ€™objectif de cet atelier est de :

- CrÃ©er deux namespaces rÃ©seau isolÃ©s (`ns1` et `ns2`).

- Les relier via un **bridge local** (`br0`).

- Leur attribuer des adresses IP et vÃ©rifier la communication (ping).

- Tester lâ€™isolation avec le namespace par dÃ©faut (celui du systÃ¨me).

---

## 2. PrÃ©paration du terrain

### 2.1. VÃ©rification du support namespaces

Le noyau Linux inclut les namespaces, mais certains outils sont nÃ©cessaires :

```bash
sudo apt update
sudo apt install -y iproute2 net-tools
```

La commande suivante doit fonctionner :

```bash
ip netns list
```

(sans rÃ©sultat au dÃ©part).

---

## 3. DÃ©roulement de lâ€™exercice (Ã©tapes progressives)

### Ã‰tape 1 â€“ CrÃ©ation des namespaces

```bash
sudo ip netns add ns1
sudo ip netns add ns2
```

VÃ©rifier :

```bash
ip netns list
```

ğŸ‘‰ RÃ©sultat attendu :

```
ns2
ns1
```

---

### Ã‰tape 2 â€“ CrÃ©ation des interfaces virtuelles (veth pairs)

Un **veth pair** agit comme un cÃ¢ble rÃ©seau virtuel : ce qui sort dâ€™une extrÃ©mitÃ© entre dans lâ€™autre.

CrÃ©er un couple dâ€™interfaces :

```bash
sudo ip link add veth1 type veth peer name veth2
```

- `veth1` ira dans `ns1`.

- `veth2` ira dans `ns2`.

---

### Ã‰tape 3 â€“ Attacher les interfaces aux namespaces

```bash
sudo ip link set veth1 netns ns1
sudo ip link set veth2 netns ns2
```

VÃ©rifier dans `ns1` :

```bash
sudo ip netns exec ns1 ip link
```

ğŸ‘‰ Vous devez voir `veth1` dans `ns1`.

---

### Ã‰tape 4 â€“ Attribution des adresses IP

Attribuer les IP :

```bash
sudo ip netns exec ns1 ip addr add 10.200.1.1/24 dev veth1
sudo ip netns exec ns2 ip addr add 10.200.1.2/24 dev veth2
```

Activer les interfaces :

```bash
sudo ip netns exec ns1 ip link set veth1 up
sudo ip netns exec ns2 ip link set veth2 up
```

Activer les boucles locales :

```bash
sudo ip netns exec ns1 ip link set lo up
sudo ip netns exec ns2 ip link set lo up
```

---

### Ã‰tape 5 â€“ Test de connectivitÃ© directe

Depuis `ns1`, tester le ping vers `ns2` :

```bash
sudo ip netns exec ns1 ping -c 3 10.200.1.2
```

ğŸ‘‰ RÃ©ponse attendue : ping rÃ©ussi.

---

### Ã‰tape 6 â€“ Ajout dâ€™un bridge pour Ã©tendre le rÃ©seau

Jusquâ€™ici, ns1 et ns2 communiquent en direct.  
Simulons maintenant un switch partagÃ© (`br0`) pour accueillir plusieurs namespaces.

1. CrÃ©er un bridge :

```bash
sudo ip link add br0 type bridge
sudo ip addr add 10.200.1.254/24 dev br0
sudo ip link set br0 up
```

2. CrÃ©er un nouveau namespace `ns3` :

```bash
sudo ip netns add ns3
```

3. CrÃ©er un nouveau veth pair pour connecter `ns3` au bridge :

```bash
sudo ip link add veth3 type veth peer name veth3-br
sudo ip link set veth3 netns ns3
sudo ip link set veth3-br master br0
sudo ip link set veth3-br up
```

4. Attribuer IP Ã  `ns3` :

```bash
sudo ip netns exec ns3 ip addr add 10.200.1.3/24 dev veth3
sudo ip netns exec ns3 ip link set veth3 up
sudo ip netns exec ns3 ip link set lo up
```

5. Test ping entre `ns3` et le bridge :

```bash
sudo ip netns exec ns3 ping -c 3 10.200.1.254
```

ğŸ‘‰ RÃ©ponse attendue : succÃ¨s.

---

### Ã‰tape 7 â€“ VÃ©rification dâ€™isolation avec le systÃ¨me hÃ´te

Depuis lâ€™hÃ´te Debian (namespace par dÃ©faut) :

```bash
ping -c 3 10.200.1.1
```

ğŸ‘‰ Par dÃ©faut, Ã©chec car les namespaces sont isolÃ©s.  
Pour permettre lâ€™accÃ¨s, il faudrait ajouter des veth pairs connectÃ©s au bridge cÃ´tÃ© hÃ´te.

---

## 4. Nettoyage

Pour supprimer toutes les ressources crÃ©Ã©es :

```bash
# Supprimer les namespaces
sudo ip netns delete ns1
sudo ip netns delete ns2
sudo ip netns delete ns3

# Supprimer le bridge
sudo ip link delete br0
```

VÃ©rification :

```bash
ip netns list   # doit Ãªtre vide
ip link show    # ne doit plus contenir veth* ni br0
```

---

ğŸ‘‰ Cet atelier illustre comment **simuler un mini-rÃ©seau isolÃ©** directement dans une machine.  
Souhaitez-vous que je dÃ©veloppe le mÃªme style dâ€™atelier structurÃ© pour **lâ€™idÃ©e 21 (Syslog centralisÃ© rÃ©seau)** afin de complÃ©ter votre progression ?
