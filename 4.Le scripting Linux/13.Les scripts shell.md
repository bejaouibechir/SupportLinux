# Exercices Script Shell

---

### üü¢ **Exercice 1 ‚Äî Cr√©er un dossier d‚Äôarchive avec datestamp**

#### üéØ Probl√©matique :
Comment conserver des fichiers journaliers sans les √©craser ?  
Ce script permet de cr√©er automatiquement un dossier de backup unique bas√© sur la date du jour.

#### ‚öôÔ∏è Explication :
Le script utilise la commande `date` pour g√©n√©rer une date, puis `mkdir` pour cr√©er un r√©pertoire de la forme `backup_YYYY-MM-DD` dans un dossier `~/backups`.

#### üß© Script :
```bash
#!/bin/bash
DATE=$(date +"%Y-%m-%d")
mkdir -p ~/backups/backup_$DATE
echo "Dossier cr√©√© : ~/backups/backup_$DATE"
```

#### üìò Commandes utilis√©es :
- `date +"%Y-%m-%d"` : g√©n√®re la date au format ISO.
- `mkdir -p` : cr√©e un dossier m√™me si certains r√©pertoires parents n'existent pas.
- `echo` : affiche une confirmation.

---

### üü¢ **Exercice 2 ‚Äî Supprimer les fichiers `.log` de plus de 7 jours**

#### üéØ Probl√©matique :
Nettoyage automatique des anciens logs pour √©viter l‚Äôencombrement des disques, tr√®s utile en monitoring DevOps.

#### ‚öôÔ∏è Explication :
Le script utilise `find` pour chercher tous les fichiers `.log` modifi√©s il y a plus de 7 jours et les supprimer avec `rm`.

#### üß© Script :
```bash
#!/bin/bash
find /var/log -name "*.log" -mtime +7 -exec rm -f {} \;
```

#### üìò Commandes utilis√©es :
- `find` : recherche de fichiers.
- `-name "*.log"` : cible les fichiers avec extension `.log`.
- `-mtime +7` : modifi√©s il y a plus de 7 jours.
- `-exec rm -f {}` : ex√©cute la commande `rm` sur chaque fichier trouv√©.

---

### üü¢ **Exercice 3 ‚Äî Renommer tous les fichiers avec un pr√©fixe de date**

#### üéØ Probl√©matique :
Renommer automatiquement tous les fichiers d‚Äôun dossier pour y ajouter une date, utile pour tracer des fichiers g√©n√©r√©s automatiquement.

#### ‚öôÔ∏è Explication :
Le script parcourt tous les fichiers du r√©pertoire courant avec `for`, et les renomme avec la date courante en pr√©fixe.

#### üß© Script :
```bash
#!/bin/bash
for f in *; do
  [ -f "$f" ] && mv "$f" "$(date +%F)-$f"
done
```

#### üìò Commandes utilis√©es :
- `for f in *` : boucle sur tous les fichiers.
- `[ -f "$f" ]` : v√©rifie que c‚Äôest un fichier (pas un dossier).
- `mv` : renomme le fichier.
- `date +%F` : retourne la date format√©e `YYYY-MM-DD`.

---

### Exercice 4 ‚Äî Lister r√©cursivement les fichiers + leur taille totale

**Probl√©matique :**  
Identifier les fichiers les plus lourds dans une arborescence pour optimiser l‚Äôespace disque, utile dans le diagnostic DevOps.

**Explication :**  
Le script utilise `du` pour calculer la taille, `sort` pour classer par taille, et `head` pour ne garder que les 10 premiers.

**Script :**
```bash
#!/bin/bash
du -ah . | sort -rh | head -n 10
```

**Commandes utilis√©es :**
- `du -ah` : calcule la taille des fichiers et dossiers.
- `sort -rh` : trie en ordre d√©croissant.
- `head -n 10` : affiche les 10 premiers r√©sultats.

---

### Exercice 5 ‚Äî Archiver un dossier et v√©rifier l‚Äôint√©grit√©

**Probl√©matique :**  
Cr√©er une archive `.tar.gz` d‚Äôun dossier et s‚Äôassurer qu‚Äôelle est exploitable, indispensable pour des sauvegardes automatis√©es.

**Explication :**  
Le script cr√©e une archive avec `tar` puis v√©rifie qu‚Äôelle est lisible avec une extraction test.

**Script :**
```bash
#!/bin/bash
read -p "Dossier √† archiver : " dir
tar -czf "$dir.tar.gz" "$dir"
tar -tzf "$dir.tar.gz" &> /dev/null && echo "Archive OK" || echo "Erreur"
```

**Commandes utilis√©es :**
- `tar -czf` : archive + compression gzip.
- `tar -tzf` : teste l‚Äôarchive sans l‚Äôextraire.
- `read` : input utilisateur.

---

### Exercice 6 ‚Äî Copier un dossier en gardant les droits

**Probl√©matique :**  
Dupliquer un dossier tout en conservant les permissions, utile lors de migrations ou duplications de configurations.

**Explication :**  
Le script utilise l‚Äôoption `-a` de `cp` pour pr√©server la structure et les droits.

**Script :**
```bash
#!/bin/bash
read -p "R√©pertoire source : " src
read -p "R√©pertoire destination : " dest
cp -a "$src" "$dest"
```

**Commandes utilis√©es :**
- `cp -a` : copie compl√®te avec droits et structure.
- `read` : lecture de l‚Äôutilisateur.

---

### Exercice 7 ‚Äî Trouver les fichiers r√©cents dans /etc

**Probl√©matique :**  
Identifier rapidement les fichiers de configuration r√©cemment modifi√©s.

**Explication :**  
Le script scanne les fichiers de `/etc` modifi√©s dans les 48 derni√®res heures.

**Script :**
```bash
#!/bin/bash
find /etc -type f -mtime -2
```

**Commandes utilis√©es :**
- `find` : recherche r√©cursive.
- `-mtime -2` : modifi√©s dans les 2 derniers jours.

---

### Exercice 8 ‚Äî Cr√©er une arborescence projet DevOps

**Probl√©matique :**  
Standardiser la cr√©ation des dossiers pour un nouveau projet DevOps.

**Explication :**  
Cr√©e une arborescence contenant `scripts`, `logs`, `configs`, `tmp`.

**Script :**
```bash
#!/bin/bash
mkdir -p myproject/{scripts,logs,configs,tmp}
```

**Commandes utilis√©es :**
- `mkdir -p` : cr√©ation r√©cursive avec sous-dossiers.
- `{}` : expansion bash.

---

### Exercice 9 ‚Äî Ajouter un alias √† `.bashrc` si absent

**Probl√©matique :**  
Automatiser l‚Äôajout d‚Äôun alias utile dans la configuration utilisateur.

**Explication :**  
Ajoute `alias gs='git status'` √† `.bashrc` s‚Äôil n‚Äôexiste pas d√©j√†.

**Script :**
```bash
#!/bin/bash
grep -q "alias gs=" ~/.bashrc || echo "alias gs='git status'" >> ~/.bashrc
source ~/.bashrc
```

**Commandes utilis√©es :**
- `grep -q` : recherche silencieuse.
- `echo >>` : ajout de ligne.
- `source` : recharge `.bashrc`.


### Exercice 10 ‚Äî Cr√©er un groupe et ajouter des utilisateurs

**Probl√©matique :**  
Automatiser la cr√©ation d'un groupe et l'ajout de plusieurs utilisateurs √† ce groupe.

**Explication :**  
Cr√©er un groupe appel√© `devops` et ajouter les utilisateurs `user1`, `user2`, et `user3` √† ce groupe.

**Script :**

```bash
#!/bin/bash
groupadd devops
for user in user1 user2 user3; do
  usermod -aG devops $user
done
```

**Commandes utilis√©es :**
- `groupadd` : cr√©e un groupe.
- `usermod -aG` : ajoute un utilisateur √† un groupe sans le retirer d'autres groupes.

---

### Exercice 11 ‚Äî Changer les permissions d'un fichier

**Probl√©matique :**  
Modifier les permissions d‚Äôun fichier pour le rendre accessible uniquement au propri√©taire et au groupe.

**Explication :**  
Changer les permissions du fichier `script.sh` pour qu‚Äôil soit en lecture-√©criture pour le propri√©taire et le groupe, et inaccessible pour les autres.

**Script :**

```bash
#!/bin/bash
chmod 660 script.sh
```

**Commandes utilis√©es :**
- `chmod` : modifie les permissions des fichiers.

---

### Exercice 12 ‚Äî V√©rifier si un utilisateur existe

**Probl√©matique :**  
V√©rifier si un utilisateur donn√© existe sur le syst√®me.

**Explication :**  
Le script demande un nom d'utilisateur et v√©rifie s'il existe. Si l'utilisateur n'existe pas, il affiche un message d'erreur.

**Script :**

```bash
#!/bin/bash
read -p "Nom d'utilisateur : " username
if id "$username" &>/dev/null; then
  echo "L'utilisateur $username existe."
else
  echo "L'utilisateur $username n'existe pas."
fi
```

**Commandes utilis√©es :**
- `id` : v√©rifie l'existence d'un utilisateur.
- `&>/dev/null` : redirige les sorties vers /dev/null pour supprimer les messages inutiles.

---

### Exercice 13 ‚Äî Sauvegarder un fichier avec un timestamp

**Probl√©matique :**  
Sauvegarder un fichier en ajoutant un timestamp au nom du fichier.

**Explication :**  
Cr√©er une copie du fichier `data.txt` avec un suffixe de date et heure.

**Script :**

```bash
#!/bin/bash
cp data.txt "data_$(date +%Y%m%d_%H%M%S).txt"
```

**Commandes utilis√©es :**
- `cp` : copie le fichier.
- `date` : g√©n√®re un timestamp.

---

### Exercice 14 ‚Äî Ajouter un utilisateur avec un r√©pertoire personnel

**Probl√©matique :**  
Ajouter un utilisateur avec un r√©pertoire personnel sp√©cifique.

**Explication :**  
Le script demande un nom d'utilisateur et cr√©e ce dernier avec un r√©pertoire personnel situ√© dans `/home/custom`.

**Script :**

```bash
#!/bin/bash
read -p "Nom d'utilisateur : " username
useradd -m -d "/home/custom/$username" $username
```

**Commandes utilis√©es :**
- `useradd -m` : cr√©e un utilisateur avec un r√©pertoire personnel.
- `-d` : sp√©cifie le r√©pertoire personnel.

---

### Exercice 15 ‚Äî Personnaliser .bashrc pour autocompl√©tion

**Probl√©matique :**  
Ajouter un param√®tre √† `.bashrc` pour activer l'autocompl√©tion d‚Äôun programme personnalis√©.

**Explication :**  
Ajoute une ligne √† `.bashrc` pour activer l‚Äôautocompl√©tion pour un programme appel√© `monapp`.

**Script :**

```bash
#!/bin/bash
echo "if type monapp &>/dev/null; then" >> ~/.bashrc
echo "  complete -F _monapp monapp" >> ~/.bashrc
echo "fi" >> ~/.bashrc
source ~/.bashrc
```

**Commandes utilis√©es :**
- `echo` : ajoute une ligne dans `.bashrc`.
- `source` : recharge `.bashrc`.

---

### Exercice 16 ‚Äî Lister les groupes d‚Äôun utilisateur

**Probl√©matique :**  
Lister tous les groupes auxquels un utilisateur appartient.

**Explication :**  
Le script demande un nom d'utilisateur et affiche les groupes associ√©s.

**Script :**

```bash
#!/bin/bash
read -p "Nom d'utilisateur : " username
groups $username
```

**Commandes utilis√©es :**
- `groups` : affiche les groupes de l'utilisateur.

---

### Exercice 17 ‚Äî Supprimer un fichier apr√®s confirmation

**Probl√©matique :**  
Demander une confirmation avant de supprimer un fichier.

**Explication :**  
Demander une confirmation √† l'utilisateur avant de supprimer un fichier nomm√© `temp.txt`.

**Script :**

```bash
#!/bin/bash
read -p "√ätes-vous s√ªr de vouloir supprimer temp.txt ? (y/n) : " confirm
if [ "$confirm" == "y" ]; then
  rm temp.txt
  echo "Le fichier a √©t√© supprim√©."
else
  echo "Suppression annul√©e."
fi
```

**Commandes utilis√©es :**
- `rm` : supprime un fichier.

---

### Exercice 18 ‚Äî Ajouter une variable d'environnement √† .profile

**Probl√©matique :**  
Ajouter une variable d'environnement personnalis√©e √† `.profile`.

**Explication :**  
Ajouter une variable `MY_VAR='devops'` √† `.profile` si elle n‚Äôest pas d√©j√† pr√©sente.

**Script :**

```bash
#!/bin/bash
grep -q "MY_VAR=" ~/.profile || echo "export MY_VAR='devops'" >> ~/.profile
source ~/.profile
```

**Commandes utilis√©es :**
- `grep -q` : recherche silencieuse.
- `echo` : ajoute la ligne dans `.profile`.
- `source` : recharge `.profile`.

---

### Exercice 19 ‚Äî V√©rifier l‚Äôespace disque avant une sauvegarde

**Probl√©matique :**  
V√©rifier l‚Äôespace disque disponible avant de lancer une sauvegarde.

**Explication :**  
V√©rifier si l‚Äôespace disque est suffisant pour effectuer une sauvegarde de `data.txt` dans `/backup`.

**Script :**

```bash
#!/bin/bash
space=$(df / | tail -1 | awk '{print $4}')
if [ $space -gt 1000000 ]; then
  cp data.txt /backup/
  echo "Sauvegarde r√©ussie."
else
  echo "Espace disque insuffisant."
fi
```

**Commandes utilis√©es :**
- `df` : affiche l‚Äôespace disque disponible.
- `awk` : extrait la quantit√© d‚Äôespace disponible.

---

### Exercice 20 ‚Äî Cr√©er un utilisateur avec un mot de passe temporaire

**Probl√©matique :**  
Cr√©er un utilisateur avec un mot de passe temporaire que l‚Äôutilisateur doit changer √† la premi√®re connexion.

**Explication :**  
Cr√©er un utilisateur avec un mot de passe `temp123`, puis forcer le changement de mot de passe √† la premi√®re connexion.

**Script :**

```bash
#!/bin/bash
read -p "Nom d'utilisateur : " username
useradd $username
echo "$username:temp123" | chpasswd
chage -d 0 $username
```

**Commandes utilis√©es :**
- `useradd` : cr√©e un utilisateur.
- `chpasswd` : d√©finit un mot de passe.
- `chage -d 0` : force le changement de mot de passe √† la premi√®re connexion.

