# ğŸ§© Atelier 3 â€” Inspection approfondie dâ€™un paquet `.deb` (version amÃ©liorÃ©e)

---

## ğŸ¯ 1. Contexte \& Objectif

Avant toute installation, un administrateur systÃ¨me doit **auditer un paquet `.deb` inconnu ou tÃ©lÃ©chargÃ© manuellement** pour vÃ©rifier :

* sa structure interne,

* ses dÃ©pendances et scripts,

* son intÃ©gritÃ© et son innocuitÃ©.

**Objectif de lâ€™atelier :**

* Comprendre la structure dâ€™un paquet `.deb` (control/data).

* Lire et interprÃ©ter ses mÃ©tadonnÃ©es.

* Identifier ses fichiers rÃ©els et scripts internes.

* DÃ©tecter une anomalie ou une corruption avant installation.

---

## ğŸ§° 2. PrÃ©paration de lâ€™environnement

### âš™ï¸ Conditions minimales

* Debian 12 / Ubuntu 22.04

* AccÃ¨s `sudo`

* Aucun paquet nâ€™a besoin dâ€™Ãªtre installÃ©

* Dossier de travail isolÃ© :

&nbsp; ```bash

&nbsp; mkdir -p ~/lab\_dpkg\_inspect \&\& cd ~/lab\_dpkg\_inspect

&nbsp; ```

### ğŸ“¦ TÃ©lÃ©chargement dâ€™un paquet pour audit

```bash
sudo apt update

apt download nano
```

> âœ… Vous obtenez un fichier du type `nano\_7.2-1\_amd64.deb`.

---

## ğŸªœ 3. Ã‰tapes pas Ã  pas

---

### ğŸ” Ã‰tape 1 : Identifier le type et la structure du paquet

#### ğŸ’» Action

```bash
file nano\_*.deb
```

#### ğŸ§  Observation

> `Debian binary package (format 2.0)`

Les paquets `.deb` sont des **archives ar** contenant :

1\. `debian-binary` â€“ version du format

2\. `control.tar.xz` â€“ mÃ©tadonnÃ©es et scripts

3\. `data.tar.xz` â€“ fichiers Ã  installer

#### ğŸ’¡ VÃ©rification

```bash
ar t nano\_*.deb
```

> âœ… RÃ©sultat attendu :

> 

> ```
> 
> ```

> debian-binary

> control.tar.xz

> data.tar.xz

> ```
> 
> ```

#### ğŸ§© InterprÃ©tation

Cette commande prouve que le `.deb` est complet.

Sâ€™il manque lâ€™un de ces trois fichiers, lâ€™installation Ã©chouera.

---

### ğŸ“‚ Ã‰tape 2 : Extraction et exploration interne

#### ğŸ’» Actions

```bash
mkdir extrait \&\& cd extrait

ar x ../nano\_*.deb

ls -1
```

> Observation : vous voyez les trois composants.

#### ğŸ§  Explication

`ar` extrait mais ne dÃ©compresse pas ; il faut ensuite ouvrir `control.tar.xz` et `data.tar.xz`.

---

### ğŸ§¾ Ã‰tape 3 : Lecture dÃ©taillÃ©e du fichier `control`

#### ğŸ’» Extraction

```bash
mkdir control \&\& tar -xf control.tar.* -C control

ls control
```

> âœ… RÃ©sultat typique : `control`, `md5sums`, `postinst`, `prerm`, `triggers`.

#### ğŸ’» Lecture du fichier de contrÃ´le

```bash
cat control/control
```

#### ğŸ§  Analyse du contenu

* `Package:` nom du paquet

* `Version:` numÃ©ro complet

* `Architecture:` type du binaire

* `Depends:` dÃ©pendances minimales

* `Description:` texte explicatif

#### ğŸ’¡ Observation

RepÃ©rez par exemple :

```
Depends: libc6 (>=2.34), libncursesw6 (>=6)
```

Cela indique que `nano` ne peut Ãªtre installÃ© sans ces bibliothÃ¨ques.

---

### ğŸ” Ã‰tape 4 : VÃ©rifier les sommes et fichiers internes

#### ğŸ’» Actions

```bash
cat control/md5sums | head -n 5
```

#### ğŸ§  Explication

Chaque ligne contient une somme MD5 et le chemin du fichier dans `data.tar.xz`.

Cela permet Ã  `dpkg` de vÃ©rifier lâ€™intÃ©gritÃ© aprÃ¨s installation.

ğŸ’¡ **Exercice express** :

Comparer une somme :

```bash
grep bin/nano control/md5sums
```

> Cela montre la signature du binaire principal.

---

### ğŸ§© Ã‰tape 5 : Explorer les fichiers installables (`data.tar.xz`)

#### ğŸ’» Action

```bash
mkdir data \&\& tar -xf data.tar.* -C data

tree -L 2 data
```

#### ğŸ§  Observation

Vous verrez typiquement :

```
data/

â”œâ”€â”€ etc/

â”‚   â””â”€â”€ nanorc

â”œâ”€â”€ usr/

â”‚   â”œâ”€â”€ bin/nano

â”‚   â”œâ”€â”€ share/

â”‚   â””â”€â”€ man/
```

#### ğŸ’¡ Mini-scenario pratique

VÃ©rifiez la prÃ©sence du fichier de configuration :

```bash
ls data/etc/nanorc
```

> âœ… Ce fichier sera copiÃ© vers `/etc/nanorc` lors de lâ€™installation.

---

### âš™ï¸ Ã‰tape 6 : Lire et interprÃ©ter les scripts internes

#### ğŸ’» Action

```bash
cat control/postinst | head -n 10
```

#### ğŸ§  Observation

Souvent : mise Ã  jour du cache man-page ou crÃ©ation dâ€™un lien symbolique.

#### ğŸ’¬ InterprÃ©tation

RepÃ©rez toute commande risquÃ©e (`rm`, `chown`, `chmod`) :

> Ce sont des **indicateurs de script potentiellement dangereux**.

---

### ğŸ“Š Ã‰tape 7 : Utiliser `dpkg-deb` pour audit rapide

#### ğŸ’» Commandes

```bash
cd ..

dpkg-deb --info nano\_*.deb
```

> âœ… Sortie :

> 

> ```
> 
> ```

> new debian package, version 2.0

> Package: nano

> Version: 7.2-1

> Architecture: amd64

> Depends: libc6, libncursesw6

> ```
> 
> ```

```bash
dpkg-deb --contents nano\_*.deb | head -n 5
```

> Liste abrÃ©gÃ©e des fichiers embarquÃ©s.

#### ğŸ” Observation

`dpkg-deb` offre le mÃªme rÃ©sultat que lâ€™extraction manuelle â€” mais plus rapidement.

Comparer avec votre rÃ©pertoire `data/` pour valider la cohÃ©rence.

---

### ğŸ§¨ Ã‰tape 8 : Simuler une corruption et la dÃ©tecter

#### ğŸ¬ ScÃ©nario

Le fichier `.deb` a Ã©tÃ© interrompu pendant un transfert.

#### ğŸ’» Commandes

```bash
cp nano\_*.deb test\_corrupt.deb

truncate -s 50k test\_corrupt.deb

dpkg-deb --info test\_corrupt.deb
```

> âš ï¸ Erreur attendue :

> 

> ```
> 
> ```

> dpkg-deb: error: archive 'test\_corrupt.deb' has premature member 'control.tar.xz' before 'debian-binary'

> ```
> 
> ```

#### ğŸ§© Analyse

Ce message confirme une incohÃ©rence du format : `debian-binary` nâ€™est pas trouvÃ© au bon emplacement.

ğŸ’¡ VÃ©rifiez avant lâ€™erreur :

```bash
ar p test\_corrupt.deb debian-binary | cat
```

> Vous verrez une lecture tronquÃ©e â€” preuve de corruption rÃ©elle.

---

### ğŸ§¾ Ã‰tape 9 : VÃ©rification dâ€™intÃ©gritÃ© complÃ¨te

#### ğŸ’» Action

```bash
dpkg-deb --showformat='${Package} ${Version} ${Installed-Size}\\n' --show nano\_*.deb
```

> Observation : cette commande montre un rÃ©sumÃ© formatÃ©.

> Ajoutez un contrÃ´le de taille :

```bash
stat -c%s nano\_*.deb
```

Comparez la taille annoncÃ©e et rÃ©elle.

---

### ğŸ§  Ã‰tape 10 : SynthÃ¨se visuelle de la structure

RÃ©affichez lâ€™arborescence finale :

```bash
tree -L 1 extrait
```

> âœ… RÃ©sumÃ© clair :

> 

> * `control/` â†’ mÃ©tadonnÃ©es + scripts

> * `data/` â†’ fichiers installÃ©s

> * `debian-binary` â†’ version du format

---

##âœ… 4. VÃ©rification des rÃ©sultats

1\. Vous pouvez lire et interprÃ©ter le contenu dâ€™un `.deb`.

2\. Vous savez repÃ©rer les dÃ©pendances et scripts internes.

3\. Vous avez validÃ© la cohÃ©rence et lâ€™intÃ©gritÃ© du paquet.

4\. Vous savez reconnaÃ®tre les signes dâ€™un paquet corrompu.

---

## ğŸ§¹ 5. Nettoyage / Restauration

```bash
cd ~

rm -rf ~/lab\_dpkg\_inspect
```

---

## ğŸ’¡ 6. Astuces \& PiÃ¨ges pÃ©dagogiques

| Type      | Description                                                                             |

| --------- | --------------------------------------------------------------------------------------- |

| ğŸ’¡ Astuce | `dpkg-deb --info` = lecture des mÃ©tadonnÃ©es ; `--contents` = inventaire des fichiers.   |

| ğŸ’¡ Astuce | VÃ©rifiez les scripts (`postinst`, `prerm`) avant dâ€™installer un paquet inconnu.         |

| ğŸ’¡ Astuce | `md5sums` permet de comparer chaque fichier aprÃ¨s extraction.                           |

| âš ï¸ PiÃ¨ge  | Ne jamais exÃ©cuter un script extrait manuellement.                                      |

| âš ï¸ PiÃ¨ge  | Une taille trop faible du `.deb` (quelques Ko) est souvent signe de transfert corrompu. |

| âš ï¸ PiÃ¨ge  | Si le fichier `debian-binary` est absent, le paquet est invalide, mÃªme sâ€™il sâ€™extrait.  |
