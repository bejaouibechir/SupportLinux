TrÃ¨s bien ğŸ‘¨â€ğŸ«  
Voici lâ€™**Atelier 1 â€“ DÃ©couvrir `dpkg` et sa base locale**, rÃ©digÃ© intÃ©gralement au **format â€œrecette pÃ©dagogique complÃ¨teâ€** selon votre protocole.  
Lâ€™ensemble est exÃ©cutable directement sur une **machine Debian ou Ubuntu Server minimale** sans dÃ©pendance prÃ©alable.

---

# ğŸ§© Atelier 1 â€” DÃ©couvrir `dpkg` et sa base locale

---

## ğŸ¯ 1. Contexte & Objectif

Lâ€™objectif de cet atelier est de **comprendre les fondations du gestionnaire de paquets `dpkg`**, utilisÃ© par `apt` et `apt-get`.  
Ã€ la fin de lâ€™exercice, le participant saura :

- interroger la base locale de `dpkg`,

- distinguer les fichiers `status`, `available`, `info/`,

- identifier les Ã©tats dâ€™un paquet (`ii`, `rc`, `un`, etc.),

- et rÃ©parer un Ã©tat incohÃ©rent simulÃ©.

---

## ğŸ§° 2. PrÃ©paration de lâ€™environnement

Toutes les manipulations se font **sur une machine Debian ou Ubuntu** avec un accÃ¨s `sudo`.  
Aucune installation supplÃ©mentaire nâ€™est requise.

VÃ©rification initiale :

```bash
lsb_release -a
which dpkg
dpkg --version
```

Si la commande `dpkg` nâ€™est pas trouvÃ©e, exÃ©cutez :

```bash
sudo apt update && sudo apt install dpkg -y
```

---

## ğŸªœ 3. Ã‰tapes pas Ã  pas

### ğŸ§¾ Ã‰tape 1 â€” Explorer la base locale de `dpkg`

Afficher la liste complÃ¨te des paquets installÃ©s :

```bash
dpkg -l | less
```

> âœ… RÃ©sultat attendu : liste des paquets avec 5 colonnes (Ã©tat, nom, version, architecture, description).

Lister uniquement les premiers 10 paquets :

```bash
dpkg -l | head -n 10
```

---

### ğŸ“‚ Ã‰tape 2 â€” Observer la structure interne de `/var/lib/dpkg/`

Explorer les fichiers critiques :

```bash
cd /var/lib/dpkg
ls -l
```

> Vous devez voir :  
> `status`, `available`, `lock`, et le dossier `info/`.

Analyser la taille du fichier `status` :

```bash
sudo du -h status
```

---

### ğŸ§© Ã‰tape 3 â€” Identifier les fichiers associÃ©s Ã  un paquet

Exemple avec le paquet `bash` :

```bash
dpkg -L bash
```

> âœ… RÃ©sultat attendu : liste complÃ¨te des fichiers installÃ©s par le paquet `bash`.

DÃ©couvrir Ã  quel paquet appartient un fichier systÃ¨me :

```bash
dpkg -S /bin/bash
```

---

### âš™ï¸ Ã‰tape 4 â€” Lire les mÃ©tadonnÃ©es dâ€™un paquet

Afficher les mÃ©tadonnÃ©es :

```bash
dpkg -s bash
```

> Examinez les champs : *Package, Status, Maintainer, Architecture, Description.*

---

### ğŸ§¨ Ã‰tape 5 â€” Simuler une incohÃ©rence et la rÃ©parer

On va **simuler une corruption du fichier `status`** (exercice de diagnostic).

Sauvegarder le fichier :

```bash
sudo cp /var/lib/dpkg/status /var/lib/dpkg/status.bak
```

Simuler une erreur :

```bash
sudo sed -i '1s/^/#CASSÃ‰ /' /var/lib/dpkg/status
```

Essayer dâ€™exÃ©cuter :

```bash
dpkg -l
```

> âš ï¸ Vous devriez obtenir une erreur du type :
> 
> ```
> dpkg: error: parsing file '/var/lib/dpkg/status' near line 1
> ```

Restaurer et vÃ©rifier :

```bash
sudo mv /var/lib/dpkg/status.bak /var/lib/dpkg/status
dpkg -l | head -n 5
```

> âœ… Le problÃ¨me est corrigÃ©. Câ€™est ainsi que se rÃ©pare une base corrompue.

---

### ğŸ§  Ã‰tape 6 â€” Comprendre les Ã©tats des paquets

Lister tous les Ã©tats :

```bash
dpkg -l | awk '{print $1}' | sort | uniq -c
```

> Les codes les plus frÃ©quents :
> 
> - `ii` â†’ installÃ©,
> 
> - `rc` â†’ supprimÃ© mais configuration prÃ©sente,
> 
> - `un` â†’ jamais installÃ©.

---

## ğŸ” 4. VÃ©rification / RÃ©sultats attendus

1. `dpkg -l` fonctionne sans erreur.

2. `dpkg -s bash` retourne les mÃ©tadonnÃ©es du paquet.

3. Le fichier `/var/lib/dpkg/status` a Ã©tÃ© restaurÃ©.

4. Vous Ãªtes capable dâ€™expliquer la signification des codes dâ€™Ã©tat.

---

## ğŸ§¹ 5. Nettoyage / Restauration

Rien Ã  dÃ©sinstaller, mais on sâ€™assure dâ€™avoir un Ã©tat sain :

```bash
sudo dpkg --audit
sudo dpkg --configure -a
sudo apt update
```

---

## ğŸ’¡ 6. Astuces & PiÃ¨ges

| Type      | Description                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------------- |
| ğŸ’¡ Astuce | Vous pouvez afficher uniquement les paquets â€œcassÃ©sâ€ avec `dpkg --audit`.                               |
| ğŸ’¡ Astuce | Le fichier `/var/lib/dpkg/info/` contient un fichier `.list` et un fichier `.md5sums` par paquet.       |
| âš ï¸ PiÃ¨ge  | Ne jamais supprimer manuellement le fichier `status`, le systÃ¨me ne pourra plus gÃ©rer ses paquets.      |
| âš ï¸ PiÃ¨ge  | `dpkg` ne tÃ©lÃ©charge **jamais** les dÃ©pendances â€” il faut passer par `apt -f install` aprÃ¨s une erreur. |

---

## ğŸ“ˆ 7. DurÃ©e estimÃ©e (rÃ©aliste terrain)

ğŸ•’ **30 minutes** (manipulations incluses)

- 10 min : exploration et explications

- 10 min : tests `dpkg -l`, `dpkg -s`, `dpkg -L`

- 10 min : simulation et rÃ©paration dâ€™erreur

---

Souhaitez-vous que je poursuive avec **Atelier 2 â€” Installation manuelle dâ€™un paquet `.deb`** dans le mÃªme format â€œrecette complÃ¨teâ€ ?


