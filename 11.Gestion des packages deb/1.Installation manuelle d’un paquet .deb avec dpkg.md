

# ğŸ“¦ Atelier 2 â€” Installation manuelle dâ€™un paquet `.deb` avec `dpkg`

---

## ğŸ¯ 1. Contexte & Objectif

`dpkg` est capable dâ€™installer directement un paquet `.deb` sans passer par `apt`.  
Cet atelier montre **comment installer manuellement un paquet tÃ©lÃ©chargÃ©**, **diagnostiquer une erreur de dÃ©pendance**, et **corriger lâ€™installation** Ã  lâ€™aide de `dpkg` et des outils associÃ©s.

**Objectifs pÃ©dagogiques :**

- TÃ©lÃ©charger et inspecter un fichier `.deb`.

- Lâ€™installer manuellement avec `dpkg -i`.

- Identifier et rÃ©parer une erreur de dÃ©pendances.

- VÃ©rifier lâ€™installation et la suppression propre.

---

## ğŸ§° 2. PrÃ©paration de lâ€™environnement

### âš™ï¸ PrÃ©requis systÃ¨me

- Debian 12 / Ubuntu 22.04

- AccÃ¨s `sudo`

- Connexion Internet active

### ğŸ“‚ PrÃ©paration du rÃ©pertoire de travail

```bash
mkdir -p ~/lab_dpkg_install && cd ~/lab_dpkg_install
```

### ğŸ” VÃ©rifier la disponibilitÃ© de `wget`

```bash
which wget || sudo apt install wget -y
```

---

## ğŸªœ 3. Ã‰tapes pas Ã  pas

---

### ğŸ§© Ã‰tape 1 â€” TÃ©lÃ©charger un paquet `.deb`

#### ğŸ¬ ScÃ©nario

Vous souhaitez installer `htop`, mais sans utiliser `apt`, uniquement avec `dpkg`.

#### ğŸ’» Action

```bash
wget http://ftp.de.debian.org/debian/pool/main/h/htop/htop_3.2.2-2_amd64.deb
```

#### ğŸ§  Observation

Le fichier `.deb` est un **archive ar** contenant les donnÃ©es du paquet.

VÃ©rifiez :

```bash
file htop_3.2.2-2_amd64.deb
```

> âœ… RÃ©sultat attendu : `Debian binary package (format 2.0)`

---

### ğŸ“¦ Ã‰tape 2 â€” Installer le paquet avec `dpkg`

#### ğŸ’» Action

```bash
sudo dpkg -i htop_3.2.2-2_amd64.deb
```

#### ğŸ§  Observation

Si toutes les dÃ©pendances sont prÃ©sentes :

> ```
> Setting up htop (3.2.2-2) ...
> Processing triggers for man-db ...
> ```

Si des dÃ©pendances manquent :

> âš ï¸ Erreur :
> 
> ```
> dpkg: dependency problems prevent configuration of htop
> ```

---

### ğŸ©¹ Ã‰tape 3 â€” Corriger une erreur de dÃ©pendances

#### ğŸ¬ ScÃ©nario

Lâ€™installation a Ã©chouÃ© car `libncursesw6` est absente (exemple simulÃ©).  
`dpkg` ne rÃ©sout pas les dÃ©pendances automatiquement.

#### ğŸ’» Diagnostic

```bash
sudo dpkg --audit
```

> âœ… RÃ©sultat attendu : indique un paquet en Ã©tat â€œhalf-installedâ€.

#### ğŸ’¡ Solution corrective

Utilisez `apt` pour rÃ©parer les dÃ©pendances cassÃ©es :

```bash
sudo apt -f install
```

> Explication :  
> `-f` (fix) dÃ©tecte les paquets partiellement installÃ©s via `dpkg` et complÃ¨te les dÃ©pendances manquantes.

#### ğŸ§ª Test

RÃ©pÃ©tez :

```bash
dpkg -l | grep htop
```

> âœ… RÃ©sultat attendu : ligne `ii htop â€¦ installed`.

---

### ğŸ” Ã‰tape 4 â€” VÃ©rifier lâ€™installation rÃ©elle

#### ğŸ’» Action

```bash
dpkg -s htop
```

> VÃ©rifiez le champ `Status: install ok installed`.

Lister les fichiers placÃ©s par le paquet :

```bash
dpkg -L htop | head -n 10
```

#### ğŸ§  Explication

Cette Ã©tape confirme la prÃ©sence physique des fichiers et leur intÃ©gration Ã  la base locale de `dpkg`.

---

### ğŸ§¨ Ã‰tape 5 â€” Simuler une mauvaise manipulation et rÃ©parer

#### ğŸ¬ ScÃ©nario

Supposons quâ€™un utilisateur supprime le binaire Ã  la main :

```bash
sudo rm /usr/bin/htop
```

#### ğŸ’» Diagnostic

```bash
dpkg --verify htop
```

> âœ… RÃ©sultat attendu : indique le fichier manquant.  
> Exemple :
> 
> ```
> ??5?????? /usr/bin/htop
> ```

#### ğŸ©¹ RÃ©paration

RÃ©installer proprement le paquet :

```bash
sudo dpkg -i htop_3.2.2-2_amd64.deb
```

> Lâ€™outil dÃ©tecte le paquet dÃ©jÃ  installÃ© et rÃ©pare le contenu.

---

### ğŸ§° Ã‰tape 6 â€” DÃ©sinstaller le paquet proprement

#### ğŸ’» Action

```bash
sudo dpkg -r htop
```

> Supprime les fichiers binaires, mais garde la configuration.

VÃ©rifier :

```bash
dpkg -l | grep htop
```

> Ã‰tat attendu : `rc` â†’ removed, config-files remain.

#### ğŸ§¹ Suppression complÃ¨te

```bash
sudo dpkg -P htop
```

> Ã‰tat attendu : plus aucune trace dans la base `dpkg`.

---

## ğŸ” 4. VÃ©rification des rÃ©sultats

1. Le paquet `.deb` est installÃ© manuellement.

2. Une erreur de dÃ©pendance a Ã©tÃ© rÃ©parÃ©e.

3. Les fichiers du paquet ont Ã©tÃ© listÃ©s et vÃ©rifiÃ©s.

4. La suppression complÃ¨te a Ã©tÃ© testÃ©e avec succÃ¨s.

---

## ğŸ§¹ 5. Nettoyage final

```bash
cd ~
rm -rf ~/lab_dpkg_install
sudo apt autoremove -y && sudo apt clean
sudo dpkg --audit
```

> VÃ©rifiez quâ€™aucun paquet nâ€™est en Ã©tat â€œhalf-installedâ€.

---

## ğŸ’¡ 6. Astuces & PiÃ¨ges pÃ©dagogiques

| Type      | Description                                                                                                   |
| --------- | ------------------------------------------------------------------------------------------------------------- |
| ğŸ’¡ Astuce | `dpkg --get-selections                                                                                        |
| ğŸ’¡ Astuce | `dpkg --configure -a` achÃ¨ve toute installation interrompue.                                                  |
| ğŸ’¡ Astuce | `dpkg-deb --info *.deb` affiche les mÃ©tadonnÃ©es sans installer le paquet.                                     |
| âš ï¸ PiÃ¨ge  | Installer un `.deb` non signÃ© peut casser la cohÃ©rence du systÃ¨me (Ã©viter les paquets externes non vÃ©rifiÃ©s). |
| âš ï¸ PiÃ¨ge  | Lâ€™option `-i` Ã©crase sans confirmation ; toujours sauvegarder les fichiers critiques                          |


