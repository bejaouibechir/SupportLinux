# Partie 4 â€” Utilisateurs & sÃ©curitÃ©

---

## Exercice 12 : DiffÃ©rence entre crontab utilisateur et crontab systÃ¨me

**1. Contexte & objectif**  
Un job CRON peut Ãªtre crÃ©Ã© :

- via la crontab utilisateur (`crontab -e`), exÃ©cutÃ© dans le contexte de lâ€™utilisateur.

- via le fichier systÃ¨me `/etc/crontab`, qui permet de spÃ©cifier lâ€™utilisateur exÃ©cutant.  
  Objectif : comparer les deux et voir la diffÃ©rence dâ€™exÃ©cution.

---

**2. PrÃ©paration du terrain**

- CrÃ©er deux utilisateurs de test :
  
  ```bash
  sudo useradd -m user1
  sudo useradd -m user2
  ```

- CrÃ©er un script de test accessible par tous :
  
  ```bash
  sudo nano /usr/local/bin/userjob.sh
  ```
  
  Contenu :
  
  ```bash
  #!/bin/bash
  echo "Job exÃ©cutÃ© par $(whoami) Ã  $(date)" >> /tmp/userjob.log
  ```
  
  Rendre exÃ©cutable :
  
  ```bash
  sudo chmod +x /usr/local/bin/userjob.sh
  ```

---

**3. Ã‰tapes de lâ€™exercice**

- **Ã‰tape 1 :** Connectez-vous en `user1` et Ã©ditez sa crontab :
  
  ```bash
  su - user1
  crontab -e
  ```
  
  Ajouter :
  
  ```
  * * * * * /usr/local/bin/userjob.sh
  ```

- **Ã‰tape 2 :** Attendre 2 minutes et vÃ©rifier :
  
  ```bash
  tail -n 5 /tmp/userjob.log
  ```
  
  ðŸ‘‰ On voit `Job exÃ©cutÃ© par user1`.

- **Ã‰tape 3 :** Ajouter la mÃªme tÃ¢che dans `/etc/crontab` mais pour `user2` :
  
  ```bash
  sudo nano /etc/crontab
  ```
  
  Ajouter :
  
  ```
  * * * * * user2 /usr/local/bin/userjob.sh
  ```

- **Ã‰tape 4 :** VÃ©rifier Ã  nouveau `/tmp/userjob.log` â†’ on voit `Job exÃ©cutÃ© par user1` **et** `Job exÃ©cutÃ© par user2`.

---

**4. Nettoyage**

```bash
sudo crontab -r -u user1
sudo deluser --remove-home user1
sudo deluser --remove-home user2
sudo sed -i '/user2 \/usr\/local\/bin\/userjob.sh/d' /etc/crontab
sudo rm /usr/local/bin/userjob.sh /tmp/userjob.log
```

---

## Exercice 13 : Utiliser cron.allow et cron.deny

**1. Contexte & objectif**  
La sÃ©curitÃ© de CRON peut Ãªtre renforcÃ©e en limitant les utilisateurs autorisÃ©s.  
Objectif : montrer comment `cron.allow` et `cron.deny` influencent lâ€™accÃ¨s.

---

**2. PrÃ©paration du terrain**

- CrÃ©er deux utilisateurs de test :
  
  ```bash
  sudo useradd -m alice
  sudo useradd -m bob
  ```

---

**3. Ã‰tapes de lâ€™exercice**

- **Ã‰tape 1 :** CrÃ©er `/etc/cron.allow` et nâ€™y mettre quâ€™`alice` :
  
  ```bash
  echo "alice" | sudo tee /etc/cron.allow
  ```

- **Ã‰tape 2 :** Connectez-vous en `alice` et testez `crontab -e` â†’ doit fonctionner.

- **Ã‰tape 3 :** Connectez-vous en `bob` et testez `crontab -e` â†’ doit Ã©chouer avec `user not allowed`.

- **Ã‰tape 4 :** Supprimer `cron.allow` et tester `cron.deny` :
  
  ```bash
  sudo rm /etc/cron.allow
  echo "bob" | sudo tee /etc/cron.deny
  ```
  
  â†’ Cette fois, `alice` peut accÃ©der, mais `bob` est bloquÃ©.

---

**4. Nettoyage**

```bash
sudo deluser --remove-home alice
sudo deluser --remove-home bob
sudo rm -f /etc/cron.allow /etc/cron.deny
```

---

## Exercice 14 : DiffÃ©rence entre job CRON root et user normal

**1. Contexte & objectif**  
Un job lancÃ© par root peut exÃ©cuter des actions interdites aux utilisateurs normaux.  
Objectif : comparer un job simple exÃ©cutÃ© par user normal vs root.

---

**2. PrÃ©paration du terrain**  
CrÃ©er un script nÃ©cessitant des droits root :

```bash
sudo nano /usr/local/bin/rootjob.sh
```

Contenu :

```bash
#!/bin/bash
echo "==== $(date) ====" >> /var/log/rootjob.log
ls /root >> /var/log/rootjob.log 2>&1
```

Rendre exÃ©cutable :

```bash
sudo chmod +x /usr/local/bin/rootjob.sh
```

---

**3. Ã‰tapes de lâ€™exercice**

- **Ã‰tape 1 :** En tant quâ€™utilisateur normal, ajouter dans sa crontab :
  
  ```
  * * * * * /usr/local/bin/rootjob.sh
  ```

- **Ã‰tape 2 :** Attendre 2 minutes et constater dans `/var/log/rootjob.log` que lâ€™accÃ¨s Ã©choue (`Permission denied`).

- **Ã‰tape 3 :** Supprimer la tÃ¢che de lâ€™utilisateur, et ajouter le mÃªme job dans la crontab root :
  
  ```bash
  sudo crontab -e
  ```
  
  ```
  * * * * * /usr/local/bin/rootjob.sh
  ```

- **Ã‰tape 4 :** VÃ©rifier aprÃ¨s 2 minutes que cette fois le contenu de `/root` est bien listÃ©.

---

**4. Nettoyage**

```bash
sudo crontab -r
sudo rm /usr/local/bin/rootjob.sh /var/log/rootjob.log
```
