

# 1) `nice -n valeur commande` — Lancer avec une priorité donnée

## Script

**Titre** : `cpu_stress.py`  
**Intro** : génère une charge CPU pendant 60 s → parfait pour observer l’effet du nice.

```python
# cpu_stress.py
import time, math
end = time.time() + 60
while time.time() < end:
    _ = math.sqrt(12345.6789)
```

### Préparation

Enregistre le script, puis :

```bash
python3 cpu_stress.py &   # processus normal (nice=0)
```

## Scénarios

- **Scénario A : lancer avec priorité basse (nice=10)**
  
  ```bash
  nice -n 10 python3 cpu_stress.py &
  ```
  
  **À observer** : dans `ps -l` ou `htop`, la colonne **NI** = 10.

- **Scénario B : lancer avec priorité haute (nice=-5)** *(root requis)*
  
  ```bash
  sudo nice -n -5 python3 cpu_stress.py &
  ```
  
  **À observer** : NI = -5 → ce process sera privilégié par l’ordonnanceur.

## Expériences & Pièges

- **Expérience “compétition”** : lance deux `cpu_stress.py`, l’un avec `nice 10`, l’autre avec `nice -5`.  
  Vérifie avec `htop` → observe `%CPU` : le -5 prend plus de CPU.

- **Piège** : seul **root** peut donner une priorité **négative** (haute). Teste en user normal → erreur.

---

# 2) `renice -n valeur -p PID` — Modifier la priorité d’un processus existant

## Script

On réutilise `cpu_stress.py`.

### Préparation

```bash
python3 cpu_stress.py &
echo $! > cpu.pid
```

## Scénarios

- **Scénario A : augmenter le nice (baisser la priorité)**
  
  ```bash
  renice -n 15 -p $(cat cpu.pid)
  ```
  
  **À observer** : avec `ps -l -p $(cat cpu.pid)` ou `htop`, la colonne NI passe à 15.

- **Scénario B : diminuer le nice (élever la priorité)** *(root requis)*
  
  ```bash
  sudo renice -n -10 -p $(cat cpu.pid)
  ```
  
  **À observer** : NI devient -10 → le process prend plus de CPU.

## Expériences & Pièges

- **Expérience “effet visible”** : lance deux charges CPU : une en `nice 15`, une en `nice -5`. Sur une machine à 1 seul cœur, observe que celle en priorité haute domine.

- **Expérience “ajustement en live”** : commence avec nice=10, puis `renice` à -5 → observe dans `htop` que le NI change instantanément.

- **Piège** : tu ne peux **pas augmenter tes propres privilèges**. Exemple : user normal → `renice -n -10` échoue. Teste et lis le message d’erreur.

---

# Récapitulatif des valeurs

- **Échelle** : `-20` (priorité max, root) → `+19` (priorité min).

- Par défaut : `0`.

- **Plus la valeur est haute** → moins le process est favorisé.

- **Plus la valeur est basse** → plus le process est favorisé.

---

# Nettoyage

```bash
pkill -f cpu_stress.py 2>/dev/null || true
rm -f cpu.pid
```


