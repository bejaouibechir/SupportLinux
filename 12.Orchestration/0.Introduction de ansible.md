# Introduction de Ansible pour l'orchestration

![Architecture ansible](https://www.interviewbit.com/blog/wp-content/uploads/2022/06/Ansible-Architecture-1024x560.png)

# ConcrÃ¨tement, Ansible permet de :

1. **Automatiser la configuration**
   
   - Installer des paquets, configurer des fichiers, gÃ©rer des utilisateurs, ajuster des permissionsâ€¦ 
     Exemple : installer et activer `nginx` sur 100 serveurs en une seule commande.

2. **DÃ©ployer des applications**
   
   - DÃ©ployer une application web (PHP, Python, Java, etc.) sur plusieurs serveurs en assurant la cohÃ©rence.  
     Exemple : copier le code, installer les dÃ©pendances, redÃ©marrer le service.

3. **Orchestrer des environnements**
   
   - Coordonner plusieurs services qui doivent fonctionner ensemble (exemple : base de donnÃ©es + backend + frontend).  
     Ansible gÃ¨re lâ€™ordre des opÃ©rations (dâ€™abord la base, ensuite lâ€™appli, puis le load balancer).

4. **GÃ©rer la configuration en continu**
   
   - DÃ©finir lâ€™Ã©tat souhaitÃ© dâ€™un systÃ¨me (par exemple : tel paquet doit Ãªtre installÃ©, tel service doit Ãªtre dÃ©marrÃ©).
   
   - Si quelquâ€™un change la config manuellement, Ansible peut la remettre en conformitÃ©.

### Ses avantages :

- **Sans agent** : rien Ã  installer sur les machines gÃ©rÃ©es, Ansible utilise SSH.

Parfait ! Je vais vous prÃ©parer une **dÃ©marche pÃ©dagogique, claire et progressive** pour installer Ansible sur une machine Linux Debian (Debian 12/13).  
Chaque Ã©tape sera expliquÃ©e avec les **commandes et leur rÃ´le**, afin que vous puissiez lâ€™utiliser en formation.

---

# ðŸ”¹ Installation Ansible

## 1. VÃ©rifier lâ€™Ã©tat du systÃ¨me

Avant dâ€™installer quoi que ce soit, on met Ã  jour les paquets existants.  
Cela garantit que lâ€™on ne mÃ©lange pas des versions obsolÃ¨tes avec des nouvelles.

```bash
sudo apt update && sudo apt upgrade -y
```

- `apt update` â†’ met Ã  jour la liste des paquets disponibles.

- `apt upgrade` â†’ installe les derniÃ¨res versions des paquets dÃ©jÃ  installÃ©s.

- `-y` â†’ rÃ©pond automatiquement â€œyesâ€ aux confirmations.

---

## 2. Installer les dÃ©pendances de base

Ansible utilise **Python** et quelques bibliothÃ¨ques. On installe donc les paquets requis.

```bash
sudo apt install -y software-properties-common python3 python3-pip sshpass
```

- `software-properties-common` â†’ permet dâ€™ajouter facilement de nouveaux dÃ©pÃ´ts.

- `python3` et `python3-pip` â†’ nÃ©cessaires, car Ansible est Ã©crit en Python.

- `sshpass` â†’ utile pour les connexions SSH sans clÃ© (utile en formation pour les tests rapides).

---

## 3. Ajouter le dÃ©pÃ´t officiel Ansible

La version dâ€™Ansible disponible dans Debian peut Ãªtre ancienne.  
Pour avoir la **derniÃ¨re version stable**, on ajoute le dÃ©pÃ´t officiel.

```bash
sudo add-apt-repository --yes --update ppa:ansible/ansible
```

âš ï¸ Sur Debian, si `add-apt-repository` nâ€™est pas reconnu, on peut **ajouter le dÃ©pÃ´t manuellement** en Ã©ditant le fichier `/etc/apt/sources.list.d/ansible.list`.

Exemple :

```bash
echo "deb http://ppa.launchpad.net/ansible/ansible/ubuntu jammy main" | sudo tee /etc/apt/sources.list.d/ansible.list
sudo apt update
```

---

## 4. Installer Ansible

Une fois le dÃ©pÃ´t ajoutÃ©, on installe Ansible :

```bash
sudo apt install -y ansible
```

- Cette commande installe le cÅ“ur dâ€™Ansible ainsi que ses modules de base.

- Cela met en place la commande `ansible` et `ansible-playbook`.

---

## 5. VÃ©rifier lâ€™installation

On confirme quâ€™Ansible est bien installÃ© et quâ€™il fonctionne.

```bash
ansible --version
```

Exemple de sortie attendue :

```
ansible [core 2.17.0]
  config file = /etc/ansible/ansible.cfg
  python version = 3.11.2
```

---

## 6. (Optionnel) CrÃ©er un inventaire de test

Par dÃ©faut, Ansible utilise un fichier `/etc/ansible/hosts` pour savoir quelles machines gÃ©rer.  
On peut tester directement sur **localhost**.

```bash
sudo nano /etc/ansible/hosts
```

Ajouter :

```
[local]
127.0.0.1
```

Puis tester :

```bash
ansible all -m ping
```

RÃ©sultat attendu :

```
127.0.0.1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}**
```

---

## ProcÃ©dure de dÃ©sinstallation de Ansible

1. sudo apt remove --purge -y ansible

2. sudo apt autoremove â€“y

3. sudo add-apt-repository --remove ppa:ansible/ansible â€“y

4. sudo rm -rf /etc/ansible
