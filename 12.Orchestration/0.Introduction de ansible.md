# Introduction de Ansible pour l'orchestration

![Architecture ansible](https://www.interviewbit.com/blog/wp-content/uploads/2022/06/Ansible-Architecture-1024x560.png)

# Concrètement, Ansible permet de :

1. **Automatiser la configuration**
   
   - Installer des paquets, configurer des fichiers, gérer des utilisateurs, ajuster des permissions… 
     Exemple : installer et activer `nginx` sur 100 serveurs en une seule commande.

2. **Déployer des applications**
   
   - Déployer une application web (PHP, Python, Java, etc.) sur plusieurs serveurs en assurant la cohérence.  
     Exemple : copier le code, installer les dépendances, redémarrer le service.

3. **Orchestrer des environnements**
   
   - Coordonner plusieurs services qui doivent fonctionner ensemble (exemple : base de données + backend + frontend).  
     Ansible gère l’ordre des opérations (d’abord la base, ensuite l’appli, puis le load balancer).

4. **Gérer la configuration en continu**
   
   - Définir l’état souhaité d’un système (par exemple : tel paquet doit être installé, tel service doit être démarré).
   
   - Si quelqu’un change la config manuellement, Ansible peut la remettre en conformité.

### Ses avantages :

- **Sans agent** : rien à installer sur les machines gérées, Ansible utilise SSH.

Parfait ! Je vais vous préparer une **démarche pédagogique, claire et progressive** pour installer Ansible sur une machine Linux Debian (Debian 12/13).  
Chaque étape sera expliquée avec les **commandes et leur rôle**, afin que vous puissiez l’utiliser en formation.

---

# 🔹 Installation Ansible

## 1. Vérifier l’état du système

Avant d’installer quoi que ce soit, on met à jour les paquets existants.  
Cela garantit que l’on ne mélange pas des versions obsolètes avec des nouvelles.

```bash
sudo apt update && sudo apt upgrade -y
```

- `apt update` → met à jour la liste des paquets disponibles.

- `apt upgrade` → installe les dernières versions des paquets déjà installés.

- `-y` → répond automatiquement “yes” aux confirmations.

---

## 2. Installer les dépendances de base

Ansible utilise **Python** et quelques bibliothèques. On installe donc les paquets requis.

```bash
sudo apt install -y software-properties-common python3 python3-pip sshpass
```

- `software-properties-common` → permet d’ajouter facilement de nouveaux dépôts.

- `python3` et `python3-pip` → nécessaires, car Ansible est écrit en Python.

- `sshpass` → utile pour les connexions SSH sans clé (utile en formation pour les tests rapides).

---

## 3. Ajouter le dépôt officiel Ansible

La version d’Ansible disponible dans Debian peut être ancienne.  
Pour avoir la **dernière version stable**, on ajoute le dépôt officiel.

```bash
sudo add-apt-repository --yes --update ppa:ansible/ansible
```

⚠️ Sur Debian, si `add-apt-repository` n’est pas reconnu, on peut **ajouter le dépôt manuellement** en éditant le fichier `/etc/apt/sources.list.d/ansible.list`.

Exemple :

```bash
echo "deb http://ppa.launchpad.net/ansible/ansible/ubuntu jammy main" | sudo tee /etc/apt/sources.list.d/ansible.list
sudo apt update
```

---

## 4. Installer Ansible

Une fois le dépôt ajouté, on installe Ansible :

```bash
sudo apt install -y ansible
```

- Cette commande installe le cœur d’Ansible ainsi que ses modules de base.

- Cela met en place la commande `ansible` et `ansible-playbook`.

---

## 5. Vérifier l’installation

On confirme qu’Ansible est bien installé et qu’il fonctionne.

```bash
ansible --version
```

Exemple de sortie attendue :

```
ansible [core 2.17.0]
  config file = /etc/ansible/ansible.cfg
  python version = 3.11.2
```

---

## 6. (Optionnel) Créer un inventaire de test

Par défaut, Ansible utilise un fichier `/etc/ansible/hosts` pour savoir quelles machines gérer.  
On peut tester directement sur **localhost**.

```bash
sudo nano /etc/ansible/hosts
```

Ajouter :

```
[local]
127.0.0.1
```

Puis tester :

```bash
ansible all -m ping
```

Résultat attendu :

```
127.0.0.1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}**
```

---

## Procédure de désinstallation de Ansible

1. sudo apt remove --purge -y ansible

2. sudo apt autoremove –y

3. sudo add-apt-repository --remove ppa:ansible/ansible –y

4. sudo rm -rf /etc/ansible
